var wma_highzoom_activated=true;var wma_highzoom_purge=false;var bldg3d,bldg3dc=null,bldg3dtimer=null;var update3dBuildings;var credit;var wmaNews=[];var wma_imgbase="tiles/";var wma_database="label.php";var wma_tilebase=".www.toolserver.org/~dschwen/wma/tiles/";var wma_maxlabel=13;var i,wma_zoomsize=[3];for(i=1;i<40;i++){wma_zoomsize[i]=2*wma_zoomsize[i-1]}var lc={};var wma_tilesets=[{name:"mapFull",globe:"Earth",credit:' / Map data Â© <a href="http://www.openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://www.opendatacommons.org/licenses/odbl">License</a>',getTileURL:function(d,a,c,b){me=wma_tilesets[0];if(b||document.location.protocol=="https:"){if(c>=7){return wma_imgbase+"mapnik/"+c+"/"+d+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}else{return wma_imgbase+"mapnik/"+c+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}}else{if(c>=7){return"//"+((a+d)%16)+wma_tilebase+"mapnik/"+c+"/"+d+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}else{return"//"+((a+d)%16)+wma_tilebase+"mapnik/"+c+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}}},linkcolor:["#2255aa","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:40075,maxzoom:20,minzoom:0},{name:"mapPhysical",globe:"Earth",getTileURL:function(c,a,b){return wma_imgbase+"relief/"+b+"/"+c+"_"+(a%(wma_zoomsize[b]*2))+".png"},linkcolor:["#2255aa","white 0pt 0pt 2pt"],equator:40075,maxzoom:5,minzoom:0},{name:"mapLandsat",globe:"Earth",getTileURL:function(e,a,d,c){var b=a%(wma_zoomsize[d]*2);if(b<0){b+=(wma_zoomsize[d]*2)}if(c||document.location.protocol=="https:"){return wma_imgbase+"mapnik/sat/"+d+"/"+e+"/"+e+"_"+(b%(wma_zoomsize[d]*2))+".png"}else{return"//"+((b+e)%8)+wma_tilebase+"mapnik/sat/"+d+"/"+e+"/"+e+"_"+(b%(wma_zoomsize[d]*2))+".png"}},linkcolor:["white","black 0pt 0pt 2pt"],equator:40075,maxzoom:13,minzoom:0},{name:"mapCoastline",globe:"Earth",getTileURL:function(c,a,b){return wma_imgbase+"plain/"+b+"/tile_"+c+"_"+(a%(wma_zoomsize[b]*2))+".png"},linkcolor:["#2255aa","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:40075,maxzoom:7,minzoom:0},{name:"mapPhysical",globe:"Moon",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"lro_moon/lromoon_"+("00"+(5-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:10940.475,maxzoom:5,minzoom:0},{name:"mapLandsat",globe:"Moon",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"moon/"+c+"/"+d+"_"+b+".jpg"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:10940.475,maxzoom:7,minzoom:0},{name:"mapLandsat",globe:"Mars",getTileURL:function(d,a,c){var b=(a+wma_zoomsize[c])%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"mars/mars_"+("00"+(5-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["white","black 0pt 0pt 2pt"],equator:21359.975,maxzoom:5,minzoom:0},{name:"mapPhysical",globe:"Venus",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"venus/venus_"+("00"+(3-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:38024.6,maxzoom:3,minzoom:0},{name:"mapLandsat",globe:"Mercury",getTileURL:function(e,a,d){var b=(a+1*wma_zoomsize[d])%(wma_zoomsize[d]*2);if(b<0){b+=(wma_zoomsize[d]*2)}var c=6-d;return wma_imgbase+"mercury/"+((c<3)?(c+"/"):"")+((c==0)?(Math.floor(b/100)+"/"):"")+"merc_"+("00"+c)+"_"+("000"+b).substr(-3)+"_"+("000"+e).substr(-3)+".png"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:15329.1,maxzoom:6,minzoom:0},{name:"mapLandsat",globe:"Io",getTileURL:function(d,a,c){var b=(a+wma_zoomsize[c])%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"io/io_"+("00"+(4-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:11443.6,maxzoom:4,minzoom:0},{name:"mapLandsat",globe:"Titan",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"titan/titan_"+("00"+(3-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:16190.3,maxzoom:3,minzoom:0}];function parseParams(a){var d={},c,b,e=a.substr(a.indexOf("?")+1).split("&");for(b=0;b<e.length;++b){c=e[b].split("=");d[c[0]]=c[1]}return d}function isRTL(a){return($.inArray(a,["ar","he","fa"])>=0)}function wikiminiatlasInstall(ac,ai){var M="";var aT=500;var af=300;var B=null;var n=false;var v;var u;var l;var aj=[];var Q=null;var K={x:-1,y:-1};var D=0;var C=0;var X=1;var U=0;var N={obj:null,lat:0,lon:0};var H=[];var at=true;var t=null;var z=null;var G=false;var aG=false;var aN="de";var ar="";var e="en";var aO=false;var ay=0;var p=128,o=128;var x=null;var c=null;var Y=null;var f=null;var ah=null;var am=null;var ax={shown:false,panel:null,image:null,link:null};ai=ai||parseParams(window.location.href);var aM={},aP={shown:false,drawn:false,canvas:null,c:null,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity};var aS={};var aA=false;var aD=null;var aa="HTMLCanvasElement" in window;var y,h=null;function aQ(){var a3;var a0=ai.wma||(window.location.search).substr(1),a4=ai.page,aW=ai.lang,aU="";Y=ai.globe||"Earth";if(a4&&aa){$.ajax({url:"//toolserver.org/~master/osmjson/getGeoJSON.php?lang="+aW+"&article="+a4,dataType:"json",success:a})}$.getScript("/~para/geoip.fcgi",function(){});aD=(function(){if(!aa){return function(){}}var ba=$("<canvas></canvas>").attr({width:6*128*4/3,height:3*128*4/3}).css({display:"none"}),a7=$("<canvas></canvas>").attr({width:6*128,height:3*128}).css({display:"none"}),a9=$("<canvas></canvas>").attr({width:6*128,height:3*128}).css({display:"none"}),bc=$("<div></div>").css({position:"absolute",width:"80px",height:"80px",bottom:"20px",right:"5px",zIndex:50,display:"none",borderRadius:"40px","-moz-border-radius":"40px",boxShadow:"5px 5px 25px rgba(0,0,0,0.3)"}),bb=$("<canvas></canvas>").attr({width:160,height:160}).css({position:"absolute",width:"80px",height:"80px",bottom:"20px",right:"5px",zIndex:51,display:"none"});function a8(){var bg,bf,be=0,bh=a7[0].getContext("2d"),bd=ba[0].getContext("2d");bh.clearRect(0,0,6*128,3*128);for(bg=0;bg<6;++bg){for(bf=0;bf<3;++bf){(function(bi,bk){var bj=new Image;$(bj).load(function(){bh.drawImage(bj,bi*128,bk*128);be++;if(be==3*6){bd.drawImage(a7[0],0,0,6*128*4/3,3*128*4/3);if(!aA){aA=wmaGlobe3d(bb[0],ba[0]);if(!aA){return}aA.setLatLon(N.lat,N.lon);bc.fadeIn(200);bb.fadeIn(200);aA.mapContext=bd;aA.tmap=a7[0];aA.tmapContext=bh;aA.omap=a9[0];aA.omapContext=a9[0].getContext("2d");aA.updateTiles=function(){aA.mapContext.clearRect(0,0,6*128*4/3,3*128*4/3);aA.mapContext.drawImage(aA.tmap,0,0,6*128*4/3,3*128*4/3);aA.updateTexture();aA.draw()};aA.updateKML=function(){aA.mapContext.clearRect(0,0,6*128*4/3,3*128*4/3);aA.mapContext.drawImage(aA.tmap,0,0,6*128*4/3,3*128*4/3);aA.mapContext.save();aA.mapContext.globalAlpha=0.5;ad(3*128,0,0,6*128,3*128,aA.omapContext);aA.mapContext.drawImage(aA.omap,0,0,6*128*4/3,3*128*4/3);aA.mapContext.restore();aA.updateTexture();aA.draw()}}if(aP.canvas){aA.updateKML()}else{aA.updateTiles()}}}).attr("src",wma_tilesets[ay].getTileURL(bk,bi,0,true))})(bg,bf)}}}$("body").append(bb).append(ba).append(bc);return a8})();var aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)/;if(aV.test(a0)){aV.exec(a0);N.lat=parseFloat(RegExp.$1);N.lon=parseFloat(RegExp.$2);aT=$(window).width();af=$(window).height();aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)/;if(aV.test(a0)){aV.exec(a0);ar=RegExp.$5}aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)/;if(aV.test(a0)){aV.exec(a0);U=parseInt(RegExp.$6,10);X=U;X=Math.min(X,(ay!=0?wma_tilesets[ay].maxzoom:((aa&&wma_highzoom_activated)?15:12)));X=Math.max(X,wma_tilesets[ay].minzoom)}aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)_([a-z]+)/;if(aV.test(a0)){aV.exec(a0);aN=RegExp.$7}else{aN=ar}aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)_([a-z]+)_([\d+-.]+)_([\d+-.]+)/;if(aV.test(a0)){a3=P(RegExp.$8,RegExp.$9);at=false;n=true}else{a3=P(N.lat,N.lon);at=true}D=a3.x-aT/2;C=a3.y-af/2}e=aN;if(e=="co"||e=="commons"){e="en"}aO=isRTL(e);for(a1 in strings){if(!strings[a1][e]){strings[a1][e]=strings[a1].en}}a6='<div class="bsprite" id="button_plus" title="'+strings.zoomIn[e]+'"></div><div class="bsprite" id="button_minus" title="'+strings.zoomOut[e]+'"></div><div class="bsprite" id="button_target" title="'+strings.center[e]+'"></div><div class="bsprite" id="button_kml" title="'+strings.kml[e]+'"></div><div class="bsprite" id="button_menu" title="'+strings.settings[e]+'"></div>';if(n){a6+='<img id="button_hide" src="'+wma_imgbase+'button_hide.png" title="'+strings.close[e]+'" onclick="window.close()">'}else{a6+='<img id="button_fs" src="'+wma_imgbase+'button_fs.png" title="'+strings.fullscreen[e]+'">'}a6+='<div id="wma_map" style="position:absolute; width:'+aT+"px; height:"+af+'px; cursor: move; background-color: #aaaaaa;"></div>';a6+='<div id="scalebox"><div id="scalebar"></div><div id="scalelabel">null</div></div>';a6+='<div id="synopsis"><p id="synopsistext"></p></div>';a6+='<div id="wma_settings"><h4>'+strings.settings[e]+'</h4><p class="option">Size Comparison <select id="wmaSetSizeOverlay">';aY=strings.sover[e].list;a6+='<option value="-" class="bg" selected="selected">-</option>';a6+='<option value="+" class="bg">'+strings.other[e]+"</option>";a6+='<option value="*" class="bg">'+decodeURIComponent(a4)+"</option>";for(a1 in aY){a6+='<option value="'+aY[a1]+'">'+aY[a1]+"</option>"}a6+='</select></p><a href="//wiki.toolserver.org/" target="_top"><img src="//toolserver.org/images/wikimedia-toolserver-button.png" border="0"></a></div>';ac.html(a6).append($("<span></span>",{id:"wmacredit"}).append($("<a></a>",{href:"//meta.wikimedia.org/wiki/WikiMiniAtlas/"+aN,target:"_top"}).text("WikiMiniAtlas")).append(credit=$("<span></span>")));var aX=new wmaMenu(aO);(function(){var ba,a9,a8=[],bb;aX.addTitle(strings.labelSet[e],aO);a6='<select id="wmaLabelSet">';for(ba in wikiminiatlas_sites){if(ba!=="commons"){a6+='<option value="'+ba+'"';if(ba==ar){a6+='selected="selected"'}a6+=">"+wikiminiatlas_sites[ba]+"</option>"}}a6+="</select>";bb=aX.addGroup([["LANG",a6],["commons",strings.commons[e]]],function(bd){if(bd=="LANG"){bd=bb.items.LANG.find("select option:selected").val()}az(bd)},ar=="commons"?"commons":"LANG",aO);bb.items.LANG.find("select").click(function(bd){bd.stopPropagation()}).change(function(bd){bb.items.LANG.click()});aX.addSep();var bc={};for(ba=0;ba<wma_tilesets.length;ba++){a9=wma_tilesets[ba].globe;bc[a9]=bc[a9]||[];bc[a9].push([ba,strings[wma_tilesets[ba].name][e]||""])}a6='<select id="wmaGlobeSet">';for(ba in bc){a6+='<option value="'+ba+'"';if(ba==Y){a6+='selected="selected"'}a6+=">"+strings["map"+ba][e]+"</option>"}a6+="</select>";aX.addTitle(strings.solarSystem[e],aO);var a7=aX.addItem(a6,undefined,aO);a7.find("select").click(function(bd){bd.stopPropagation()}).change(function(bd){var be=$(this).find("option:selected").val();bc[Y].hide();bc[be].show();Y=be;a7.click();aE(bc[be].current())});aX.addSep();aX.addTitle(strings.mode[e],aO);for(ba in bc){bc[ba]=aX.addGroup(bc[ba],aE,bc[ba][0][0],aO);if(ba!==Y){bc[ba].hide()}aX.addSep()}aX.addItem(strings.sizeRef[e],b)})();$("#button_menu").click(function(){aX.toggle()});$("#button_fs").click(ak);$("#wma_widget").append(aX.div.css({right:"40px",top:"26px"}));aY=strings.dyk[e];var a5=$("<div></div>").html(aY[Math.floor(Math.random()*aY.length)]).addClass("news");y=$("<div></div>").css({position:"absolute",top:"30px",left:"60px",zIndex:100,fontSize:"40px",color:"white",textShadow:"1px 1px 5px black",fontWeight:"bold"}).appendTo("#wma_widget");wmaNews[0]=function(){aE(4)};wmaNews[1]=function(){if(aa){D=19039255;C=3363704;X=15;aE(0)}else{a5.text("Sorry, your browser does not support the canvas element! Try FireFox or Google Chrome.")}};$("#wma_widget").append(a5);a5.click(function(){a5.fadeOut()});setTimeout(function(){a5.fadeOut()},10*1000);x=$("#scalelabel");c=$("#scalebar");t=document.getElementById("button_target");z=document.getElementById("wma_settings");$("#wmaLabelSet").change(function(){az(this.value)});$("#wmaSetSizeOverlay").change(function(){aq(strings.sover[e].site,this.value)});$("#button_plus").bind("mousedown",ab);$("#button_minus").bind("mousedown",R);$("#button_target").click(ag);$("#button_kml").click(ap);$(document).keydown(L);$(document).bind("contextmenu",function(){return false});$("body").bind("dragstart",function(){return false});$("#wma_map").click(function(a8){var a7=aL(a8.originalEvent);if(a7.x!=K.x||a7.y!=K.y){return false}});S();bldg3d=$('<canvas class="wmakml"></canvas>').attr({width:aT,height:af}).css({zIndex:19,opacity:0.75}).appendTo($(B));if(aa){try{console.log("WebGL ...");bldg3dc=bldg3d[0].getContext("experimental-webgl");console.log("WebGL context");update3dBuildings=aC(bldg3dc);console.log("WebGL buildings!")}catch(a2){bldg3dc=null;bldg3d.remove();bldg3d=$('<canvas class="wmakml"></canvas>').attr({width:aT,height:af}).css({zIndex:19,opacity:0.75}).appendTo($(B))}if(!bldg3dc||update3dBuildings===false){bldg3dc=bldg3d[0].getContext("2d");update3dBuildings=q}}$(window).resize(W);var a6,a1,aY;for(a1=0;a1<wma_tilesets.length&&wma_tilesets[a1].globe!=Y;++a1){}aE(a1,true);aI();d();ah=/https?:\/\/([a-z-]+)\.wikipedia\.org\/wiki\/(.*)/;$("#wma_widget").mouseover(function(a9){var a7,a8;if(a9.metaKey){if(a9.target.href&&ah.test(a9.target.href)){a7=RegExp.$1;a8=RegExp.$2;$("#synopsistext").load("/~dschwen/synopsis/?l="+a7+"&t="+a8,function(){$("#synopsistext").css("direction",isRTL(a7)?"rtl":"ltr").find("a").attr("target","_top");$("#synopsis").fadeIn("slow");setTimeout(function(){var bb=$("#synopsistext").outerHeight(true),ba=af/2;$("#synopsis").animate({height:bb<ba?bb:ba})},500)})}else{$("#synopsis").fadeOut("fast")}}});$("#synopsis").click(function(a7){if(a7.target==this){$("#synopsis").fadeOut("fast")}});if(window.postMessage){$(window).bind("message",ao);if(window!=window.top){try{window.parent.postMessage("request","*")}catch(aZ){}}}}function aJ(){if(ac.css("visibility")!="visible"){ac.css("visibility","visible")}else{ac.css("visibility","hidden")}return false}function b(){if(z.style.visibility!="visible"){z.style.visibility="visible"}else{z.style.visibility="hidden"}return false}function ae(){var aW=$("<div></div>").addClass("wmatile").mousedown(an).click(function(aZ){var aX,aY=aL(aZ.originalEvent);if(aY.x!=K.x||aY.y!=K.y||!aU.csrender){return true}aX=wmajt.detectPointer(aZ,aU);if(aX){au(aX)}}),aV=null,aU={div:aW,img:$("<img>").load(function(aX){$(this).fadeIn(100)}).error(function(aX){aV=setTimeout(function(){aU.img.attr("src",aU.img.attr("src")+"?"+Math.random())},1000)}).appendTo(aW),can:$("<canvas></canvas>").appendTo(aW),ctx:null,csrender:false,csx:0,csy:0,csz:20,lx:0,ly:0,lz:20,span:$("<span></span>").appendTo(aW),debug:$("<span></span>").addClass("wmadbg").css("display","none").appendTo(aW),url:"",xhr:null};if(aa){aU.can.attr({width:128,height:128});aU.ctx=aU.can[0].getContext("2d")}$(B).append(aU.div);return aU}function S(){var aV,aU;if(B===null){$(document).mousemove(aF).mouseup(function(){Q=null});$("#wma_map").dblclick(V).mousedown(an);B=document.getElementById("wma_map");v=Math.floor(aT/p)+2;u=Math.floor(af/o)+2;l=[];for(var aU=0;aU<u;aU++){for(var aV=0;aV<v;aV++){l.push(ae())}}N.obj=$('<div id="wmamarker"></div>');$(B).append(N.obj)}}function W(){var aV=$(window).width(),aX=$(window).height(),aU=Math.floor(aV/p)+2,aY=Math.floor(aX/o)+2,aW;aT=aV;af=aX;if(aa){if(aP.canvas!==null){aP.canvas.attr({width:aV,height:aX})}bldg3d.attr({width:aV,height:aX});if(bldg3dc.viewport){bldg3dc.viewport(0,0,aV,aX)}}if(aU!=v||aY!=u){v=aU;u=aY;while(l.length<aU*aY){l.push(ae())}for(aW=0;aW<l.length;++aW){if(aW<aU*aY){l[aW].div.show()}else{l[aW].div.hide()}}aI();$(B).width(aV).height(aX)}else{if(aP.shown){ad()}}}function ap(){if(aP.shown){aP.canvas.fadeOut(200)}else{aP.canvas.fadeIn(200)}aP.shown=!aP.shown}function I(aW){var aY,aX,aV,aZ=aM.c,a2=aM.ways,a0=aM.areas,aU,a4=D,a3=C;function a1(a5){var a7,ba,a8,a6,a9;if(a5.length>0){a9=a5[0].lat+aW.lat;ba=aw(a9,a5[0].lon/Math.cos(a9/180*Math.PI)+aW.lon);a8=ba.x;aZ.moveTo(ba.x-a4,ba.y-a3);for(a7=1;a7<a5.length;++a7){a9=a5[a7].lat+aW.lat;ba=aw(a9,a5[a7].lon/Math.cos(a9/180*Math.PI)+aW.lon);aZ.lineTo(ba.x-a4,ba.y-a3)}}}if(aZ!==null){aZ.clearRect(0,0,aM.canvas[0].width,aM.canvas[0].height);if(a0!==null){aZ.fillStyle="rgb(0,255,0)";for(aY=0;aY<a0.length;aY++){aZ.globalCompositeOperation="source-over";for(aX=0;aX<a0[aY].outer.length;++aX){aZ.beginPath();a1(a0[aY].outer[aX]);aZ.closePath();aZ.fill()}aZ.globalCompositeOperation="destination-out";for(aX=0;aX<a0[aY].inner.length;++aX){aZ.beginPath();a1(a0[aY].inner[aX]);aZ.closePath();aZ.fill()}}}if(a2!==null){aZ.globalCompositeOperation="source-over";aZ.lineWidth=4;aZ.strokeStyle="rgb(0,255,0)";aZ.beginPath();for(aY=0;aY<a2.length;++aY){a1(a2[aY])}aZ.stroke()}}}function ad(a1,aW,aV,aY,a7,a2){var a0,aZ,aX,a5=aP.ways,a3=aP.areas,aU,a8,a6,a9;a1=a1||wma_zoomsize[X]*p;aW=(aW!==undefined)?aW:D;aV=(aV!==undefined)?aV:C;a2=a2||aP.c;a9=aW;function a4(ba){var bc,bf,be=0,bd,bb;if(ba[0].lon<aP.minlon){be=2*a1}if(ba.length>0){bf=aw(ba[0].lat,ba[0].lon,a1);bd=bf.x;a2.moveTo(bf.x-a9+be,bf.y-aV);for(bc=1;bc<ba.length;++bc){bf=P(ba[bc].lat,ba[bc].lon,a1);bb=bf.x-bd;if(Math.abs(bb)>a1){be-=Math.round(bb/(2*a1))*2*a1}bd=bf.x;a2.lineTo(bf.x-a9+be,bf.y-aV)}}}if(a2!==null){aY=aY||aP.canvas[0].width;a7=a7||aP.canvas[0].height;a2.clearRect(0,0,aY,a7);for(aX=-2;aX<=2;++aX){a9=aW+aX*2*a1;a8=aw(0,aP.minlon,a1);a6=aw(0,aP.maxlon,a1);if(a6.x-a9<0||a8.x-a9>aY){continue}if(a3!==null){a2.fillStyle="rgb(255,0,0)";a2.strokeStyle="rgb(0,0,0)";a2.lineWidth=2;for(a0=0;a0<a3.length;a0++){a2.globalCompositeOperation="source-over";for(aZ=0;aZ<a3[a0].outer.length;++aZ){a2.beginPath();a4(a3[a0].outer[aZ]);a2.closePath();a2.fill();a2.stroke()}a2.globalCompositeOperation="destination-out";for(aZ=0;aZ<a3[a0].inner.length;++aZ){a2.beginPath();a4(a3[a0].inner[aZ]);a2.closePath();a2.fill();a2.stroke()}}}if(a5!==null){a2.globalCompositeOperation="source-over";a2.lineWidth=4;a2.strokeStyle="rgb(0,0,255)";a2.beginPath();for(a0=0;a0<a5.length;++a0){a4(a5[a0])}a2.stroke()}}}}function aI(){function aZ(bm,bk){var bj,bi,bl,bn,bh=[0,0,5,0,0,2,3,4,5,6,6],bg=[0,0,8,0,0,2,3,4,5,6,6];bm.text("");for(bl=0;bl<bk.length;++bl){bi=$("<a></a>");if("img" in bk[bl]){(function(br,bo,bp,bq){bi.click(function(bt){var bs=aL(bt.originalEvent);if(bs.x!=K.x||bs.y!=K.y){bt.preventDefault()}else{if(bt.which==1){m(br,bo,bp,bq);bt.preventDefault()}}}).attr("href","//commons.wikimedia.org/wiki/Image:"+bk[bl].img)})(bk[bl].img,bk[bl].w,bk[bl].h,bk[bl].m5);bj=(parseInt(bk[bl].w)>parseInt(bk[bl].h))?(bk[bl].style==-2?24:48):Math.floor((bk[bl].style==-2?24:48)*bk[bl].w/bk[bl].h);bi.addClass("cthumb").append($("<img/>",{title:decodeURIComponent(bk[bl].img)}).error(function(){$(this).parent().hide()}).attr("src",F(bk[bl].img,bj,bk[bl].m5)));if(bk[bl].head<18){bi.addClass("dir dir"+bk[bl].head);bn=8}else{bn=6}bi.css({top:(bk[bl].ty-bn)+"px",left:(bk[bl].tx-bn)+"px"})}else{bi.addClass("label").addClass("label"+bk[bl].style).css(aS).attr({href:"//"+bk[bl].lang+".wikipedia.org/wiki/"+bk[bl].page,target:"_top"}).css({top:(bk[bl].ty-bg[bk[bl].style])+"px",left:(bk[bl].tx-bh[bk[bl].style])+"px",direction:isRTL(bk[bl].lang)?"rtl":"ltr"}).text(bk[bl].name)}bm.append(bi)}}function a9(bn,bi){var br=bn.lx,bq=bn.ly,bp=bn.lz,bm=1<<(bp-wma_maxlabel),bt,bs,bo,bl,bj,bh=[],bk,bg=[[],[],[],[]];for(bk=0;bk<bi.length;bk++){bt=128*(br/bm-bi[bk].dx);bs=128*(bq/bm-(wma_zoomsize[wma_maxlabel]-bi[bk].dy-1));bl=(bi[bk].tx+bi[bk].fx-bt)*bm;bj=(bi[bk].ty+bi[bk].fy-bs)*bm;if(bl>=0&&bl<128&&bj>=0&&bj<128){bo=jQuery.extend(true,{},bi[bk]);bo.tx=Math.floor(bl);bo.ty=Math.floor(bj);bo.fx=bl-bo.tx;bo.fy=bj-bo.ty;bg[Math.floor(bl/64)+2*Math.floor(bj/64)].push(bo)}}for(bk=0;bk<4;bk++){if(bg[bk].length>0){bg[bk].sort(function(bv,bu){return bu.wg-bv.wg});bh.push(bg[bk][0])}}aZ(bn.span,bh)}if(C<0){C=0}if(D<0){D+=Math.floor(wma_zoomsize[X]*2*p)}if(D>0){D%=Math.floor(wma_zoomsize[X]*2*p)}var a0=Math.floor(D/p)%v,aY=Math.floor(C/o)%u,aX=D%p,aW=C%o,a8,a6,aU,bf,be,bd,bc,bb,a5,a4,ba,a7,a1,aV;s();var a3=new Date;for(var bc=0;bc<u;bc++){for(var bd=0;bd<v;bd++){ba=((bd+a0)%v)+((bc+aY)%u)*v;a5=(Math.floor(D/p)+bd);a4=(Math.floor(C/o)+bc);a1=wma_tilesets[ay].getTileURL(a4,a5,X);a7=l[ba];a7.div.css({left:(bd*p-aX)+"px",top:(bc*o-aW)+"px"});if(a7.url!=a1||wma_highzoom_purge){a7.url=a1;if(ay==0&&X>12){if(!a7.csrender){a7.csrender=true;a7.img.fadeOut(200)}if(a7.csx!=a5||a7.csy!=a4||a7.csz!=X||wma_highzoom_purge){a7.can.hide();a7.img.hide();wmajt.update(a5,a4,X,a7,wma_highzoom_purge)}}else{a7.csz=X;if(a7.csrender){a7.can.fadeOut(200)}if(a4>=wma_zoomsize[X]){a7.img.fadeOut(0);a7.span.text("");continue}if(a7.img.attr("src")!=a1){a7.img.fadeOut(0).attr("src",a1)}else{if(a7.csrender){a7.img.fadeIn(200)}}a7.csrender=false}if(a7.xhr!==null){a7.xhr.abort()}a7.lx=a5;a7.ly=a4;a7.lz=X;a7.span.html('<span class="loading">'+strings.labelLoading[e]+"</span>");if(X>wma_maxlabel){a8=Math.floor(a5/(1<<(X-wma_maxlabel)));a6=Math.floor(a4/(1<<(X-wma_maxlabel)));aV=aK(a6,a8,wma_maxlabel);aU=J(a6,a8,wma_maxlabel)}else{aV=aK(a4,a5,X);aU=J(a4,a5,X)}if(lc[aU]&&!("filler" in lc[aU])){(X<wma_maxlabel)?aZ(a7.span,lc[aU].label):a9(a7,lc[aU].label)}else{if(lc[aU]&&"filler" in lc[aU]){aZ(a7.span,lc[aU].label)}else{if(X<=wma_maxlabel&&X>0){bf=J(Math.floor(a4/2),Math.floor(a5/2),X-1);if(lc[bf]){a8=a5%2;lc[aU]={label:[],filler:1};for(bb=0;bb<lc[bf].label.length;bb++){if(Math.floor(lc[bf].label[bb].tx/64)===(a5%2)&&Math.floor(lc[bf].label[bb].ty/64)===(a4%2)){be=jQuery.extend(true,{},lc[bf].label[bb]);be.tx=(be.tx+be.fx)*2-(a5%2)*128;be.ty=(be.ty+be.fy)*2-(a4%2)*128;be.fx=be.tx-Math.floor(be.tx);be.fy=be.ty-Math.floor(be.ty);be.tx=Math.floor(be.tx);be.ty=Math.floor(be.ty);lc[aU].label.push(be)}}aZ(a7.span,lc[aU].label)}}}(function(bi,bh,bg){a7.xhr=$.ajax({url:bh,context:a7}).success(function(bj){try{lc[bi]=JSON.parse(bj);bg?aZ(this.span,lc[bi].label):a9(this,lc[bi].label)}catch(bk){this.span.html(bj)}}).error(function(){this.span.text("")})})(aU,aV,X<wma_maxlabel)}}}}g(N);for(ba=0;ba<H.length;++ba){g(H[ba])}wma_highzoom_purge=false;if(X>=14){update3dBuildings()}ad();var a2=new Date}function aC(aY){aY.clearColor(0,0,0,0);aY.clearDepth(1);aY.enable(aY.DEPTH_TEST);aY.depthMask(true);aY.depthFunc(aY.LEQUAL);aY.clear(aY.COLOR_BUFFER_BIT+aY.DEPTH_BUFFER_BIT);var aX=aY.createProgram();var aZ=aY.createShader(aY.VERTEX_SHADER);aY.shaderSource(aZ,$("#bldg-vs").text());aY.compileShader(aZ);aY.attachShader(aX,aZ);var a0=aY.createShader(aY.FRAGMENT_SHADER);aY.shaderSource(a0,$("#bldg-fs").text());aY.compileShader(a0);aY.attachShader(aX,a0);aY.linkProgram(aX);aY.useProgram(aX);aX.vertexPosAttrib=aY.getAttribLocation(aX,"pos");aY.enableVertexAttribArray(aX.vertexPosAttrib);aX.normalPosAttrib=aY.getAttribLocation(aX,"norm");aY.enableVertexAttribArray(aX.normalPosAttrib);var a1=aY.getUniformLocation(aX,"u_resolution");var a3=aY.getUniformLocation(aX,"u_centerdeg");var a2=aY.getUniformLocation(aX,"u_lightdir");var aW=3,aV=2,aU=5;r=Math.sqrt(aW*aW+aV*aV+aU*aU);aY.uniform3f(a2,aW/r,aV/r,aU/r);wmajt.registerWebGLBuildingData(5000,aY);return function(){var a6=aT/2,a5=af/2,a4=60/(128*1<<X),a7=aH(D+a6,C+a5);if(a7.lon>180){a7.lon-=360}aY.uniform3f(a1,a6*a4,a5*a4,500);aY.uniform3f(a3,a7.lon,a7.lat,0);console.log(a7.lat,a7.lon,a6*a4,a5*a4);aY.clear(aY.COLOR_BUFFER_BIT|aY.DEPTH_BUFFER_BIT);wmajt.renderWebGLBuildingData(aX)}}function q(){if(aa&&X>14){var aV=wmajt.ref_z(),aU=wmajt.zbuild(),a7=aT/2,a6=af/2,a0=(128*1<<X)/60,aY,aX,a3=bldg3dc,a1,aW,a2,aZ,a4=aH(D+a7,C+a6);if(a4.lon>180){a4.lon-=360}function a5(a9){var a8;if(aW>0){a3.moveTo((a9[0][0]-a4.lon)*aY+a7,a6-(a9[0][1]-a4.lat)*aY);for(a8=1;a8<a9.length;a8++){a3.lineTo((a9[a8][0]-a4.lon)*aY+a7,a6-(a9[a8][1]-a4.lat)*aY)}}for(a8=0;a8<a9.length-1;a8++){a3.moveTo((a9[a8][0]-a4.lon)*aY+a7,a6-(a9[a8][1]-a4.lat)*aY);a3.lineTo((a9[a8][0]-a4.lon)*aX+a7,a6-(a9[a8][1]-a4.lat)*aX);a3.lineTo((a9[a8+1][0]-a4.lon)*aX+a7,a6-(a9[a8+1][1]-a4.lat)*aX)}}a3.lineWidth=0.5;a3.strokeStyle="rgb(0,0,0)";a3.beginPath();bldg3dc.clearRect(0,0,aT,af);for(aZ in aV){a2=aU[aZ].geo.coordinates;a1=(aU[aZ].tags["building:levels"]*3)||aU[aZ].tags.height;aW=(aU[aZ].tags["building:min_level"]*3)||aU[aZ].tags.min_height||0;aY=a0*(1+aW/450);aX=a0*(1+a1/450);if(aU[aZ].geo.type==="Polygon"){for(aZ=0;aZ<a2.length;aZ++){a5(a2[aZ])}}else{a5(a2)}}a3.stroke();bldg3d.show();if(bldg3dtimer!==null){clearTimeout(bldg3dtimer)}setTimeout(update3dBuildings,1500)}else{bldg3d.hide()}}function g(aU){var aV=P(aU.lat,aU.lon),aW=(aV.x-D);if(aW<-100){aW+=(wma_zoomsize[X]*256)}aU.obj.css("left",(aW-6)+"px");aU.obj.css("top",(aV.y-C-6)+"px")}function an(aU){K=Q=aL(aU)}function aF(aU){window.scrollTo(0,0);var aW=aL(aU);if(Q!==null){D-=(aW.x-Q.x);C-=(aW.y-Q.y);Q=aW;aI();if(at){at=false;d()}}if(aM.shown){I(aH(D+aW.x,C+aW.y))}var aV=aH(D+aT/2,C+af/2);aA&&aA.setLatLon(aV.lat,aV.lon)}function V(aU){var aV=aL(aU);D+=aV.x-aT/2;C+=aV.y-af/2;if(at){at=false;d()}aI();return false}function au(aU){if(h){clearTimeout(h)}y.stop(true).fadeTo(1,1).text(aU);h=setTimeout(function(){y.fadeOut(200)},5000)}function aq(aV,aU){if(aU=="+"){aU=prompt("Enter article title to use as overlay");if(!aU){return}}if(aU=="*"){aU=ai.page;aV=ai.lang}if(aU=="-"){aM.shown=false;aM.canvas.fadeOut(200);return}O(aV,aU);b()}function O(aV,aU){$.ajax({url:"//toolserver.org/~master/osmjson/getGeoJSON.php?lang="+aV+"&article="+aU,dataType:"json",success:av})}function L(aX){var aV=false;aX=aX||window.event;switch(aX.keyCode||aX.which){case 37:D-=aT/1;break;case 38:C-=af/1;break;case 39:D+=aT/1;break;case 40:C+=af/1;break;case 187:case 107:ab();break;case 189:case 109:R();break;case 80:wma_highzoom_purge=true;console.log("purging current viewport");aI();break;case 79:if(aM.shown){aM.shown=false;aM.canvas.fadeOut(200)}else{O(strings.sover[e].site,strings.sover[e].list[0])}break;case 84:aE((ay+1)%wma_tilesets.length);break;case 76:var aW,aY,aU=["en","de","fr","ru","ar","he","ko","ja","ml","fa","commons"];aW=aU[($.inArray(ar,aU)+1)%aU.length];y.text(wikiminiatlas_sites[aW]);az(aW,true);break;case 67:az("commons",true);break;case 27:if(aM.shown){aM.shown=false;aM.canvas.fadeOut(200)}if(ax.shown){T()}if(z.style.visibility!="hidden"){z.style.visibility="hidden"}break;default:aV=true}if(at){at=false;d()}aI();return aV}function aL(aU){return{x:aU.pageX,y:aU.pageY}}function J(aW,aU,aV){return ar+"_"+(wma_zoomsize[aV]-aW-1)+"_"+(aU%(wma_zoomsize[aV]*2))+"_"+aV+"_"+wma_tilesets[ay].globe}function aK(aW,aU,aV){return wma_database+"?l="+ar+"&a="+(wma_zoomsize[aV]-aW-1)+"&b="+(aU%(wma_zoomsize[aV]*2))+"&z="+aV+"&g="+wma_tilesets[ay].globe}function aR(){var aV=wma_tilesets[ay].globe;for(var aU=ay+1;aU<wma_tilesets.length;aU++){if(wma_tilesets[aU].maxzoom>=(X+1)&&wma_tilesets[aU].globe==aV){ay=aU;X++;return}}}function k(){for(var aU=ay-1;aU>=0;aU--){if(wma_tilesets[aU].minzoom<(X-1)){ay=aU;X--;return}}}function ab(aV){var aW=aH(D+aT/2,C+af/2);var aU=false;if(!aV){var aV=window.event}if(aV){if(aV.which){aU=(aV.which==3)}else{if(aV.button){aU=(aV.button==2)}}}if(aU){if(aa&&wma_highzoom_activated){X=(ay==0)?15:wma_tilesets[ay].maxzoom}else{X=(ay==0)?12:wma_tilesets[ay].maxzoom}}else{if(X>=((ay==0&&!(aa&&wma_highzoom_activated))?12:wma_tilesets[ay].maxzoom)){}else{X++}}var aX;if(at){aX=P(N.lat,N.lon)}else{aX=P(aW.lat,aW.lon)}D=aX.x-aT/2;C=aX.y-af/2;aI();return false}function R(aX){var aW=aH(D+aT/2,C+af/2);var aU=false;if(!aV){var aV=window.event}if(aV){if(aV.which){aU=(aV.which==3)}else{if(aV.button){aU=(aV.button==2)}}}if(aU){X=wma_tilesets[ay].minzoom}else{if(X<=wma_tilesets[ay].minzoom){k()}else{X--}}var aY=P(aW.lat,aW.lon);D=aY.x-aT/2;C=aY.y-af/2;aI();return false}function aE(aY,aX){var aV=X;ay=aY;aS={color:wma_tilesets[aY].linkcolor[0],textShadow:wma_tilesets[aY].linkcolor[1]};$("a.label").css(aS);credit.text("");if("credit" in wma_tilesets[aY]){credit.html(wma_tilesets[aY].credit)}if(aV>(aY!=0?wma_tilesets[aY].maxzoom:((aa&&wma_highzoom_activated)?15:12))){aV=wma_tilesets[aY].maxzoom}if(aV<wma_tilesets[aY].minzoom){aV=wma_tilesets[aY].minzoom}if(X!=aV){var aU=aH(D+aT/2,C+af/2);X=aV;var aW=P(aU.lat,aU.lon);D=aW.x-aT/2;C=aW.y-af/2}if(!aX){aI()}aD()}function az(aU){ar=aU;for(var aV=0;aV<v*u;aV++){l[aV].url=""}aI()}function s(){var aW=aH(D+aT/2,C+af/2);var aV=50,aY;var aU,aX;aU=Math.cos(aW.lat*0.0174532778)*wma_tilesets[ay].equator*aV/(256*wma_zoomsize[X]);aX=Math.pow(10,Math.floor(Math.log(aU)/Math.log(10)));aY=aV*aX/aU;if(5*aY<aV){aY=aY*5;aX=aX*5}if(2*aY<aV){aY=aY*2;aX=aX*2}x.text(aX<1?(aX*1000)+" m":aX+" km");c.width(aY)}function d(){if(at){$("#button_target").css("background-position","")}else{$("#button_target").css("background-position","-40px 0")}}function aB(aU,aW){var aV=P(aU,aW);D=aV.x-aT/2;C=aV.y-af/2;aI()}function ag(){aB(N.lat,N.lon);at=true;d()}function aw(aV,aW,aU){aU=aU||wma_zoomsize[X]*p;return{y:Math.floor((0.5-aV/180)*aU),x:Math.floor((aW/360)*aU*2)}}function P(aV,aW,aU){aU=aU||wma_zoomsize[X]*p;var aX=Math.floor((aW/360)*aU*2);if(aX<0){aX+=aU*2}return{y:Math.floor((0.5-aV/180)*aU),x:aX}}function aH(aU,aV){return{lat:180*(0.5-aV/(wma_zoomsize[X]*128)),lon:360*(aU/(wma_zoomsize[X]*256))}}function Z(aU){$("#debugbox").append($("<div></div>").text(aU))}function F(aV,aU,aW){return aW?"//upload.wikimedia.org/wikipedia/commons/thumb/"+aW[0]+"/"+aW+"/"+aV+"/"+aU+"px-"+aV:"//commons.wikimedia.org/w/thumb.php?w="+aU+"&f="+aV}function T(){ax.shown=false;ax.panel.fadeOut(200)}function A(){ax.panel=$("<div></div>",{id:"wma_wmaci_panel"}).append($("<div></div>",{id:"wma_wmaci_panel_sub"}).append(ax.span=$("<span></span>")).append($("<br/>")).append(ax.link=$("<a></a>",{id:"wma_wmaci_link",target:"_top"}).click(function(aU){aU.stopPropagation()}))).css("visibility","visible").hide().click(T).appendTo(ac)}function m(aU,a1,aY,a0){if(ax.panel==null){A()}var aZ=aT-30;var aW=af-80;var aV=a1;var a2=aY;if(aV>aZ){a2=Math.round((a2*aZ)/aV);aV=aZ}if(a2>aW){aV=Math.round((aV*aW)/a2);a2=aW}ax.span.find("img").remove();var aX=$("<img/>",{id:"wma_wmaci_image"}).appendTo(ax.span);if(aV<a1){aX.attr("src",F(aU,Math.floor(aV/10)*10,a0))}else{aX.attr("src","//commons.wikimedia.org/wiki/Special:FilePath/"+aU)}ax.link.attr("href","//commons.wikimedia.org/wiki/Image:"+aU).text("[[:commons:Image:"+decodeURIComponent(aU)+"]]");ax.panel.fadeIn(200);ax.shown=true}function ak(){var aU=window.open("","showwin","left=0,top=0,width="+screen.width+",height="+screen.height+",toolbar=0,resizable=0,fullscreen=1"),aW=ai.page,aX=ai.lang,aY=wma_tilesets[ay].globe,aV=aH(D+aT/2,C+af/2);aU.document.location="iframe_dev.html?"+N.lat+"_"+N.lon+"_"+0+"_"+0+"_"+ar+"_"+X+"_"+aN+"_"+aV.lat+"_"+aV.lon+"&globe="+aY+"&page="+aW+"&lang="+aX}function al(aU,aV){return function(aW){window.parent.postMessage(aV+","+aU,"*")}}function w(aU){if(!aa){return}aU=aU||aP;if(aU.canvas===null){aU.canvas=$('<canvas class="wmakml"></canvas>').attr({width:aT,height:af}).appendTo($(B));aU.c=aU.canvas[0].getContext("2d");aU.shown=true;aU.drawn=true;if(aU==aP){$("#button_kml").show()}}if(aU===aP&&aA){aA.updateKML()}}function ao(aX){aX=aX.originalEvent;var aY=JSON.parse(aX.data),aW,aV,aU;if("coords" in aY){for(aW=0;aW<aY.coords.length;++aW){aU={obj:null,lat:aY.coords[aW].lat,lon:aY.coords[aW].lon};if(Math.abs(aU.lat-N.lat)>0.0001||Math.abs(aU.lon-N.lon)>0.0001){aU.obj=$("<div></div>").attr("title",decodeURIComponent(aY.coords[aW].title)).addClass("emarker").mouseover(al(aW,"highlight")).mouseout(al(aW,"unhighlight")).click(al(aW,"scroll")).appendTo($(B));g(aU);H.push(aU)}}}if(("ways" in aY)||("areas" in aY)){w();aP.ways=aY.ways||null;aP.areas=aY.areas||null;ad()}if(("minlon" in aY)&&("maxlon" in aY)){if(!("maxlon" in aP)||aY.maxlon>aP.maxlon){aP.maxlon=aY.maxlon}if(!("minlon" in aP)||aY.minlon<aP.minlon){aP.minlon=aY.minlon}}}function E(a0,aZ){function aW(a6){var a3,a7,a1,bb=180/Math.PI,a4=Math.PI/2,a2=180/20037508.34,ba=[],a8=-Infinity,a5=Infinity,a9;for(a3=0;a3<a6.length;++a3){a1=a6[a3][0]*a2;a7=bb*(2*Math.atan(Math.exp(a6[a3][1]*a2/bb))-a4);if(a1>a8){a8=a1}if(a1<a5){a5=a1}if(a7>aZ.maxlat){aZ.maxlat=a7}if(a7<aZ.minlat){aZ.minlat=a7}ba.push({lat:a7,lon:a1})}if(!("maxlon" in aZ)||!("maxlon" in aZ)){aZ.maxlon=a8;aZ.minlon=a5}else{a9=[{r:Math.max(aZ.maxlon,a8),l:Math.min(aZ.minlon,a5)},{r:Math.max(aZ.maxlon,a8+360),l:Math.min(aZ.minlon,a5+360)},{r:Math.max(aZ.maxlon+360,a8),l:Math.min(aZ.minlon+360,a5)}];a9.sort(function(bd,bc){return(bd.r-bd.l)-(bc.r-bc.l)});aZ.minlon=a9[0].l;aZ.maxlon=a9[0].r}return ba}function aV(a3){var a2={outer:[],inner:[]},a1;a2.outer.push(aW(a3[0]));for(a1=1;a1<a3.length;a1++){a2.inner.push(aW(a3[a1]))}if(aZ.areas){aZ.areas.push(a2)}else{aZ.areas=[a2]}}function aU(a1){var a2=[aW(a1)];if(aZ.ways){aZ.ways.push.apply(aZ.ways,a2)}else{aZ.ways=a2}}function aY(a2){var a1;switch(a2.type){case"LineString":aU(a2.coordinates);break;case"MultiLineString":for(a1=0;a1<a2.coordinates.length;a1++){aU(a2.coordinates[a1])}break;case"Polygon":aV(a2.coordinates);break;case"MultiPolygon":for(a1=0;a1<a2.coordinates.length;a1++){aV(a2.coordinates[a1])}break}}var aX;if(!("type" in a0)){return}if(a0.type=="GeometryCollection"){for(aX=0;aX<a0.geometries.length;++aX){aY(a0.geometries[aX])}}else{aY(a0)}}function a(aY){E(aY,aP);if(aP.ways||aP.areas){w();ad()}if(aP.maxlon&&aP.minlon&&aP.maxlat>-Infinity&&aP.minlat<Infinity){var aX=(aP.maxlon+aP.minlon)/2,aW=(aP.maxlat+aP.minlat)/2,aV=(aP.maxlon-aP.minlon)/180*3*128,aU=(aP.maxlat-aP.minlat)/180*3*128;for(X=0;X<12;++X){if(aV>aT/2||aU>af/2){break}aV*=2;aU*=2}aB(aW,aX)}}function av(a0){var a1=aM.c,aW=aM.canvas;if(aW){aM={shown:true,drawn:false,canvas:aW,c:a1,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity}}else{aM={shown:true,drawn:false,canvas:null,c:null,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity};w(aM)}E(a0,aM);var aV=aM.areas,aU=aM.ways,aZ=(aM.maxlon+aM.minlon)/2,aY=(aM.maxlat+aM.minlat)/2;function aX(a2){var a4,a3=0;if(a2[0].lon<aM.minlon){a3=360}for(a4=0;a4<a2.length;++a4){a2[a4].lon-=aZ-a3;a2[a4].lon*=Math.cos(a2[a4].lat/180*Math.PI);a2[a4].lat-=aY}}if(aV!==null){for(i=0;i<aV.length;i++){for(j=0;j<aV[i].outer.length;++j){aX(aV[i].outer[j])}for(j=0;j<aV[i].inner.length;++j){aX(aV[i].inner[j])}}}if(aU!==null){for(i=0;i<aU.length;++i){latNorm(aU[i])}}aM.canvas.fadeIn(200)}aQ()}function wmaMenu(a){this.div=$("<div></div>").addClass("wmamenu").css("direction",(a===true?"rtl":""));this.parent=null;this.shown=false}wmaMenu.prototype.addTitle=function(a,c){var b=$("<div></div>").addClass("wmamenutitle").html(a).css("direction",(c===true)?"rtl":"").appendTo(this.div);return b};wmaMenu.prototype.addItem=function(a,d,e){d=d||(function(){});var c=this,b=$("<div></div>").addClass("wmamenuitem").html(a).css("direction",(e===true)?"rtl":"").mouseenter(function(){b.css("background-color","#AAA")}).mouseleave(function(){b.css("background-color","")}).click(function(){d();c.close()}).appendTo(this.div);return b};wmaMenu.prototype.addMenu=function(a,d,c){var b=$("<div></div>").addClass("wmasubmenu").html(a).css("direction",(c===true)?"rtl":"").mouseenter(function(){b.css("background-color","#AAA")}).mouseleave(function(){b.css("background-color","");d.hide()}).click(function(){d.move(b.width(),0);d.show()}).append(d.div).appendTo(this.div);d.parent=this;return b};wmaMenu.prototype.addCheck=function(b,f,c,g){function a(){if(c){d.addClass("wmamenuchecked")}else{d.removeClass("wmamenuchecked")}}function e(){c=!c;a();f(c)}var d=this.addItem(b,e,g);f=f||(function(){});a();return{toggle:function(h){if(h===undefined){c=!c;a()}},check:a,item:d}};wmaMenu.prototype.addGroup=function(l,a,b,g){var f={},d=this,e=-1;function k(o){if(o==e){return}for(var m in f){if(m==o){f[m].addClass("wmamenuselected")}else{f[m].removeClass("wmamenuselected")}}e=o}function h(o,m){f[o]=d.addItem(m,function(){k(o);a(o)},g)}b=b||0;a=a||(function(){});for(var c=0;c<l.length;++c){if(typeof l[c]==="object"){h(l[c][0],l[c][1])}else{h(c,l[c])}}k(b);return{items:f,select:k,current:function(){return e},hide:function(){for(var m in f){f[m].hide()}},show:function(){for(var m in f){f[m].show()}}}};wmaMenu.prototype.addSep=function(){this.div.children().last().css({"border-bottom-style":"solid","border-bottom-width":"1px","border-bottom-color":"#AAA"})};wmaMenu.prototype.show=function(){this.div.fadeIn(200);this.shown=true};wmaMenu.prototype.hide=function(){this.div.fadeOut(200);this.shown=false};wmaMenu.prototype.toggle=function(){this.shown?this.hide():this.show()};wmaMenu.prototype.close=function(){this.hide();this.parent&&this.parent.close()};wmaMenu.prototype.move=function(a,b){this.div.css({top:b+"px",left:a+"px"})};