function wmaGlobe3d(d,f){var x,v=true;function C(H,I){var e=$("#"+I),G=e.text(),F;switch(e.attr("type")){case"x-shader/x-fragment":F=H.createShader(H.FRAGMENT_SHADER);break;case"x-shader/x-vertex":F=H.createShader(H.VERTEX_SHADER);break;default:return null}H.shaderSource(F,G);H.compileShader(F);return F}var B;function D(){var e=C(x,"shader-fs");var F=C(x,"shader-vs");B=x.createProgram();x.attachShader(B,F);x.attachShader(B,e);x.linkProgram(B);if(!x.getProgramParameter(B,x.LINK_STATUS)){alert("Could not initialise shaders")}x.useProgram(B);B.vertexPositionAttribute=x.getAttribLocation(B,"aVertexPosition");x.enableVertexAttribArray(B.vertexPositionAttribute);B.textureCoordAttribute=x.getAttribLocation(B,"aTextureCoord");x.enableVertexAttribArray(B.textureCoordAttribute);B.vertexNormalAttribute=x.getAttribLocation(B,"aVertexNormal");x.enableVertexAttribArray(B.vertexNormalAttribute);B.pMatrixUniform=x.getUniformLocation(B,"uPMatrix");B.mvMatrixUniform=x.getUniformLocation(B,"uMVMatrix");B.nMatrixUniform=x.getUniformLocation(B,"uNMatrix");B.samplerUniform=x.getUniformLocation(B,"uSampler");B.ambientColorUniform=x.getUniformLocation(B,"uAmbientColor");B.lightingDirectionUniform=x.getUniformLocation(B,"uLightingDirection");B.directionalColorUniform=x.getUniformLocation(B,"uDirectionalColor")}var o;function k(){x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,true);x.bindTexture(x.TEXTURE_2D,o);x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,o.image);x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST);x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE);x.bindTexture(x.TEXTURE_2D,null)}function i(){o=x.createTexture();o.image=f;k(o)}var r=mat4.create();var p=mat4.create();function y(){x.uniformMatrix4fv(B.pMatrixUniform,false,p);x.uniformMatrix4fv(B.mvMatrixUniform,false,r);var e=mat3.create();mat4.toInverseMat3(r,e);mat3.transpose(e);x.uniformMatrix3fv(B.nMatrixUniform,false,e)}function b(e){return e*Math.PI/180}var l=mat4.create();var t=0,q=0,j=0,h=0;function s(e,F){t=e;q=F;if(!v){v=true;z()}}var w;var g;var n;var a;function u(){var I=30;var J=30;var H=2;var T=[];var Q=[];var X=[];for(var Z=0;Z<=I;Z++){var L=Z*Math.PI/I;var W=Math.sin(L);var U=Math.cos(L);for(var M=0;M<=J;M++){var F=M*2*Math.PI/J;var V=Math.sin(F);var G=Math.cos(F);var P=G*W;var O=U;var N=V*W;var S=1-(M/J);var R=1-(Z/I);Q.push(P);Q.push(O);Q.push(N);X.push(S);X.push(R);T.push(H*P);T.push(H*O);T.push(H*N)}}var e=[];for(var Z=0;Z<I;Z++){for(var M=0;M<J;M++){var K=(Z*(J+1))+M;var Y=K+J+1;e.push(K);e.push(Y);e.push(K+1);e.push(Y);e.push(Y+1);e.push(K+1)}}g=x.createBuffer();x.bindBuffer(x.ARRAY_BUFFER,g);x.bufferData(x.ARRAY_BUFFER,new Float32Array(Q),x.STATIC_DRAW);g.itemSize=3;g.numItems=Q.length/3;n=x.createBuffer();x.bindBuffer(x.ARRAY_BUFFER,n);x.bufferData(x.ARRAY_BUFFER,new Float32Array(X),x.STATIC_DRAW);n.itemSize=2;n.numItems=X.length/2;w=x.createBuffer();x.bindBuffer(x.ARRAY_BUFFER,w);x.bufferData(x.ARRAY_BUFFER,new Float32Array(T),x.STATIC_DRAW);w.itemSize=3;w.numItems=T.length/3;a=x.createBuffer();x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,a);x.bufferData(x.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),x.STATIC_DRAW);a.itemSize=1;a.numItems=e.length}function E(){x.viewport(0,0,x.viewportWidth,x.viewportHeight);x.colorMask(1,1,1,0);x.clear(x.COLOR_BUFFER_BIT|x.DEPTH_BUFFER_BIT);x.colorMask(1,1,1,1);mat4.identity(l);var e=b(-(h+90));mat4.rotate(l,e,[0,1,0]);mat4.rotate(l,b(j),[Math.cos(e),0,Math.sin(e)]);mat4.perspective(3.85,x.viewportWidth/x.viewportHeight,1,100,p);mat4.identity(r);mat4.translate(r,[0,0,-60]);mat4.multiply(r,l);x.activeTexture(x.TEXTURE0);x.bindTexture(x.TEXTURE_2D,o);x.uniform1i(B.samplerUniform,0);x.bindBuffer(x.ARRAY_BUFFER,w);x.vertexAttribPointer(B.vertexPositionAttribute,w.itemSize,x.FLOAT,false,0,0);x.bindBuffer(x.ARRAY_BUFFER,n);x.vertexAttribPointer(B.textureCoordAttribute,n.itemSize,x.FLOAT,false,0,0);x.bindBuffer(x.ARRAY_BUFFER,g);x.vertexAttribPointer(B.vertexNormalAttribute,g.itemSize,x.FLOAT,false,0,0);x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,a);y();x.drawElements(x.TRIANGLES,a.numItems,x.UNSIGNED_SHORT,0)}function z(){var e=t-j,F=q-h;h+=0.1*Math.pow(Math.abs(F),0.85)*(F<0?-1:1);j+=0.1*Math.pow(Math.abs(e),0.85)*(e<0?-1:1);if((Math.abs(e)+Math.abs(F))>0.1){requestAnimFrame(z)}else{v=false}E()}try{x=d.getContext("experimental-webgl");x.viewportWidth=d.width;x.viewportHeight=d.height}catch(A){}if(!x){return false}D();u();i();x.clearColor(0,0,0,1);x.enable(x.DEPTH_TEST);var m=[5,-10,-50];var c=vec3.create();vec3.normalize(m,c);vec3.scale(c,-1);x.uniform3fv(B.lightingDirectionUniform,c);x.uniform3f(B.directionalColorUniform,0.3,0.3,0.3);x.uniform3f(B.ambientColorUniform,0.7,0.7,0.7);z();return s}window.wmaGlobe3d=wmaGlobe3d;