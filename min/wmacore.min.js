var wma_highzoom_activated=true;var wma_highzoom_purge=false;var wma_bldg3dzoom=14;var bldg3d=null,bldg3dc=null,bldg3dtimer=null;var update3dBuildings;var credit;var wmaNews=[];var wma_imgbase="tiles/";var wma_database="label.php";var wma_tilebase=".wma.wmflabs.org/tiles/";var wma_maxlabel=13;var i,wma_zoomsize=[3];for(i=1;i<40;i++){wma_zoomsize[i]=2*wma_zoomsize[i-1]}var lc={};var wma_tilesets=[{name:"mapFull",globe:"Earth",credit:' / Map data Â© <a href="http://www.openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://www.opendatacommons.org/licenses/odbl">License</a>',getTileURL:function(d,a,c,b){me=wma_tilesets[0];if(b||document.location.protocol=="https:"){if(c>=7){return wma_imgbase+"mapnik/"+c+"/"+d+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}else{return wma_imgbase+"mapnik/"+c+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}}else{if(c>=7){return"//"+((a+d)%8)+wma_tilebase+"mapnik/"+c+"/"+d+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}else{return"//"+((a+d)%8)+wma_tilebase+"mapnik/"+c+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}}},linkcolor:["#2255aa","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:40075,maxzoom:20,minzoom:0},{name:"mapPhysical",globe:"Earth",getTileURL:function(c,a,b){return wma_imgbase+"relief/"+b+"/"+c+"_"+(a%(wma_zoomsize[b]*2))+".png"},linkcolor:["#2255aa","white 0pt 0pt 2pt"],equator:40075,maxzoom:5,minzoom:0},{name:"mapLandsat",globe:"Earth",getTileURL:function(e,a,d,c){var b=a%(wma_zoomsize[d]*2);if(b<0){b+=(wma_zoomsize[d]*2)}if(c||document.location.protocol=="https:"){return wma_imgbase+"mapnik/sat/"+d+"/"+e+"/"+e+"_"+(b%(wma_zoomsize[d]*2))+".png"}else{return"//"+((b+e)%8)+wma_tilebase+"mapnik/sat/"+d+"/"+e+"/"+e+"_"+(b%(wma_zoomsize[d]*2))+".png"}},linkcolor:["white","black 0pt 0pt 2pt"],equator:40075,maxzoom:13,minzoom:0},{name:"mapCoastline",globe:"Earth",getTileURL:function(c,a,b){return wma_imgbase+"plain/"+b+"/tile_"+c+"_"+(a%(wma_zoomsize[b]*2))+".png"},linkcolor:["#2255aa","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:40075,maxzoom:7,minzoom:0},{name:"mapPhysical",globe:"Moon",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"lro_moon/lromoon_"+("00"+(5-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:10940.475,maxzoom:5,minzoom:0},{name:"mapLandsat",globe:"Moon",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"moon/"+c+"/"+d+"_"+b+".jpg"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:10940.475,maxzoom:7,minzoom:0},{name:"mapLandsat",globe:"Mars",getTileURL:function(d,a,c){var b=(a+wma_zoomsize[c])%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"mars/mars_"+("00"+(5-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["white","black 0pt 0pt 2pt"],equator:21359.975,maxzoom:5,minzoom:0},{name:"mapPhysical",globe:"Venus",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"venus/venus_"+("00"+(3-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:38024.6,maxzoom:3,minzoom:0},{name:"mapLandsat",globe:"Mercury",getTileURL:function(e,a,d){var b=(a+1*wma_zoomsize[d])%(wma_zoomsize[d]*2);if(b<0){b+=(wma_zoomsize[d]*2)}var c=6-d;return wma_imgbase+"mercury/"+((c<3)?(c+"/"):"")+((c==0)?(Math.floor(b/100)+"/"):"")+"merc_"+("00"+c)+"_"+("000"+b).substr(-3)+"_"+("000"+e).substr(-3)+".png"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:15329.1,maxzoom:6,minzoom:0},{name:"mapLandsat",globe:"Io",getTileURL:function(d,a,c){var b=(a+wma_zoomsize[c])%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"io/io_"+("00"+(4-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:11443.6,maxzoom:4,minzoom:0},{name:"mapLandsat",globe:"Titan",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"titan/titan_"+("00"+(3-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:16190.3,maxzoom:3,minzoom:0}];function parseParams(a){var d={},c,b,e=a.substr(a.indexOf("?")+1).split("&");for(b=0;b<e.length;++b){c=e[b].split("=");d[c[0]]=c[1]}return d}function isRTL(a){return($.inArray(a,["ar","he","fa"])>=0)}function wikiminiatlasInstall(ad,aj){var N="";var aV=500;var ag=300;var C=null;var n=false;var w;var v;var l;var ak=[];var R=null;var L={x:-1,y:-1};var E=0;var D=0;var Y=1;var V=0;var O={obj:null,lat:0,lon:0};var I=[];var av=true;var u=null;var A=null;var H=false;var aI=false;var aP="de";var au="";var e="en";var aQ=false;var aA=0;var p=128,o=128;var y=null;var c=null;var Z=null;var f=null;var ai=null;var an=null;var az={shown:false,panel:null,image:null,link:null};aj=aj||parseParams(window.location.href);var aO={},aR={shown:false,drawn:false,canvas:null,c:null,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity};var aU={};var aC=false;var aF=null;var ab="HTMLCanvasElement" in window;var s=("devicePixelRatio" in window)?window.devicePixelRatio:1;var z,h=null;function aS(){var a5;var a2=aj.wma||(window.location.search).substr(1),a6=aj.page,aY=aj.lang,aW="";Z=aj.globe||"Earth";if(a6&&ab){$.ajax({url:"//tools.wmflabs.org/wiwosm/osmjson/getGeoJSON.php?lang="+aY+"&article="+a6,dataType:"json",success:a})}aF=(function(){if(!ab){return function(){}}var bc=$("<canvas></canvas>").attr({width:6*128*4/3,height:3*128*4/3}).css({display:"none"}),a9=$("<canvas></canvas>").attr({width:6*128,height:3*128}).css({display:"none"}),bb=$("<canvas></canvas>").attr({width:6*128,height:3*128}).css({display:"none"}),be=$("<div></div>").css({position:"absolute",width:"80px",height:"80px",bottom:"20px",right:"5px",zIndex:50,display:"none",borderRadius:"40px","-moz-border-radius":"40px",boxShadow:"5px 5px 25px rgba(0,0,0,0.3)"}),bd=$("<canvas></canvas>").attr({width:160,height:160}).css({position:"absolute",width:"80px",height:"80px",bottom:"20px",right:"5px",zIndex:51,display:"none"});function ba(){var bi,bh,bg=0,bj=a9[0].getContext("2d"),bf=bc[0].getContext("2d");bj.clearRect(0,0,6*128,3*128);for(bi=0;bi<6;++bi){for(bh=0;bh<3;++bh){(function(bk,bm){var bl=new Image;$(bl).load(function(){bj.drawImage(bl,bk*128,bm*128);bg++;if(bg==3*6){bf.drawImage(a9[0],0,0,6*128*4/3,3*128*4/3);if(!aC){aC=wmaGlobe3d(bd[0],bc[0]);if(!aC){return}aC.setLatLon(O.lat,O.lon);be.fadeIn(200);bd.fadeIn(200);aC.mapContext=bf;aC.tmap=a9[0];aC.tmapContext=bj;aC.omap=bb[0];aC.omapContext=bb[0].getContext("2d");aC.updateTiles=function(){aC.mapContext.clearRect(0,0,6*128*4/3,3*128*4/3);aC.mapContext.drawImage(aC.tmap,0,0,6*128*4/3,3*128*4/3);aC.updateTexture();aC.draw()};aC.updateKML=function(){aC.mapContext.clearRect(0,0,6*128*4/3,3*128*4/3);aC.mapContext.drawImage(aC.tmap,0,0,6*128*4/3,3*128*4/3);aC.mapContext.save();aC.mapContext.globalAlpha=0.5;ae(3*128,0,0,6*128,3*128,aC.omapContext);aC.mapContext.drawImage(aC.omap,0,0,6*128*4/3,3*128*4/3);aC.mapContext.restore();aC.updateTexture();aC.draw()}}if(aR.canvas){aC.updateKML()}else{aC.updateTiles()}}}).attr("src",wma_tilesets[aA].getTileURL(bm,bk,0,true))})(bi,bh)}}}$("body").append(bd).append(bc).append(be);return ba})();var aX=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)/;if(aX.test(a2)){aX.exec(a2);O.lat=parseFloat(RegExp.$1);O.lon=parseFloat(RegExp.$2);aV=$(window).width();ag=$(window).height();aX=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)/;if(aX.test(a2)){aX.exec(a2);au=RegExp.$5}aX=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)/;if(aX.test(a2)){aX.exec(a2);V=parseInt(RegExp.$6,10);ar(V);ar(Math.min(Y,(aA!=0?wma_tilesets[aA].maxzoom:((ab&&wma_highzoom_activated)?15:12))));ar(Math.max(Y,wma_tilesets[aA].minzoom))}aX=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)_([a-z]+)/;if(aX.test(a2)){aX.exec(a2);aP=RegExp.$7}else{aP=au}aX=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)_([a-z]+)_([\d+-.]+)_([\d+-.]+)/;if(aX.test(a2)){a5=Q(RegExp.$8,RegExp.$9);av=false;n=true}else{a5=Q(O.lat,O.lon);av=true}E=a5.x-aV/2;D=a5.y-ag/2}e=aP;if(e=="co"||e=="commons"){e="en"}aQ=isRTL(e);wmajt.setUILang(e);for(a3 in strings){if(!strings[a3][e]){strings[a3][e]=strings[a3].en}}a8='<div class="bsprite" id="button_plus" title="'+strings.zoomIn[e]+'"></div><div class="bsprite" id="button_minus" title="'+strings.zoomOut[e]+'"></div><div class="bsprite" id="button_target" title="'+strings.center[e]+'"></div><div class="bsprite" id="button_kml" title="'+strings.kml[e]+'"></div><div class="bsprite" id="button_menu" title="'+strings.settings[e]+'"></div>';if(n){a8+='<img id="button_hide" src="'+wma_imgbase+'button_hide.png" title="'+strings.close[e]+'" onclick="window.close()">'}else{a8+='<img id="button_fs" src="'+wma_imgbase+'button_fs.png" title="'+strings.fullscreen[e]+'">'}a8+='<div id="wma_map" style="position:absolute; width:'+aV+"px; height:"+ag+'px; cursor: move; background-color: #aaaaaa;"></div>';a8+='<div id="scalebox"><div id="scalebar"></div><div id="scalelabel">null</div></div>';a8+='<div id="synopsis"><p id="synopsistext"></p></div>';a8+='<div id="wma_settings"><h4>'+strings.settings[e]+'</h4><p class="option">Size Comparison <select id="wmaSetSizeOverlay">';a0=strings.sover[e].list;a8+='<option value="-" class="bg" selected="selected">-</option>';a8+='<option value="+" class="bg">'+strings.other[e]+"</option>";a8+='<option value="*" class="bg">'+decodeURIComponent(a6)+"</option>";for(a3 in a0){a8+='<option value="'+a0[a3]+'">'+a0[a3]+"</option>"}a8+='</select></p><a href="//wma.wmflabs.org/" target="_top"><img src="//upload.wikimedia.org/wikipedia/commons/4/46/Powered_by_labs_button.png" border="0"></a></div>';ad.html(a8).append($("<span></span>",{id:"wmacredit"}).append($("<a></a>",{href:"//meta.wikimedia.org/wiki/WikiMiniAtlas/"+aP,target:"_top"}).text("WikiMiniAtlas")).append(credit=$("<span></span>")));var aZ=new wmaMenu(aQ);(function(){var bc,bb,ba=[],bd;aZ.addTitle(strings.labelSet[e],aQ);a8='<select id="wmaLabelSet">';for(bc in wikiminiatlas_sites){if(bc!=="commons"){a8+='<option value="'+bc+'"';if(bc==au){a8+='selected="selected"'}a8+=">"+wikiminiatlas_sites[bc]+"</option>"}}a8+="</select>";bd=aZ.addGroup([["LANG",a8],["commons",strings.commons[e]]],function(bf){if(bf=="LANG"){bf=bd.items.LANG.find("select option:selected").val()}aB(bf)},au=="commons"?"commons":"LANG",aQ);bd.items.LANG.find("select").click(function(bf){bf.stopPropagation()}).change(function(bf){bd.items.LANG.click()});aZ.addSep();var be={};for(bc=0;bc<wma_tilesets.length;bc++){bb=wma_tilesets[bc].globe;be[bb]=be[bb]||[];be[bb].push([bc,strings[wma_tilesets[bc].name][e]||""])}a8='<select id="wmaGlobeSet">';for(bc in be){a8+='<option value="'+bc+'"';if(bc==Z){a8+='selected="selected"'}a8+=">"+strings["map"+bc][e]+"</option>"}a8+="</select>";aZ.addTitle(strings.solarSystem[e],aQ);var a9=aZ.addItem(a8,undefined,aQ);a9.find("select").click(function(bf){bf.stopPropagation()}).change(function(bf){var bg=$(this).find("option:selected").val();be[Z].hide();be[bg].show();Z=bg;a9.click();aG(be[bg].current())});aZ.addSep();aZ.addTitle(strings.mode[e],aQ);for(bc in be){be[bc]=aZ.addGroup(be[bc],aG,be[bc][0][0],aQ);if(bc!==Z){be[bc].hide()}aZ.addSep()}aZ.addItem(strings.sizeRef[e],b)})();$("#button_menu").click(function(){aZ.toggle()});$("#button_fs").click(al);$("#wma_widget").append(aZ.div.css({right:"40px",top:"26px"}));a0=strings.dyk[e];var a7=$("<div></div>").html(a0[Math.floor(Math.random()*a0.length)]).addClass("news");z=$("<div></div>").css({position:"absolute",top:"30px",left:"60px",zIndex:100,fontSize:"40px",color:"white",textShadow:"1px 1px 5px black",fontWeight:"bold"}).appendTo("#wma_widget");wmaNews[0]=function(){aG(4)};wmaNews[1]=function(){if(ab){E=19039255;D=3363704;ar(15);aG(0)}else{a7.text("Sorry, your browser does not support the canvas element! Try FireFox or Google Chrome.")}};$("#wma_widget").append(a7);a7.click(function(){a7.fadeOut()});setTimeout(function(){a7.fadeOut()},10*1000);y=$("#scalelabel");c=$("#scalebar");u=document.getElementById("button_target");A=document.getElementById("wma_settings");$("#wmaLabelSet").change(function(){aB(this.value)});$("#wmaSetSizeOverlay").change(function(){at(strings.sover[e].site,this.value)});$("#button_plus").on("mousedown",ac);$("#button_minus").on("mousedown",S);$("#button_target").on("click",ah);$("#button_kml").on("click",aq);$(document).on("keydown",M);$(document).on("contextmenu",function(){return false});$("body").bind("dragstart",function(){return false});$("#wma_map").click(function(ba){var a9=aN(ba);if(a9.x!=L.x||a9.y!=L.y){return false}});T();bldg3d=$('<canvas class="wmakml"></canvas>').attr({width:aV*s,height:ag*s}).css({zIndex:19,opacity:0.75,width:aV+"px",height:ag+"px"}).appendTo($(C));if(ab){try{bldg3dc=bldg3d[0].getContext("experimental-webgl");update3dBuildings=aE(bldg3dc)}catch(a4){bldg3dc=null;bldg3d.remove();bldg3d=$('<canvas class="wmakml"></canvas>').attr({width:aV*s,height:ag*s}).css({zIndex:19,opacity:0.75,width:aV+"px",height:ag+"px"}).appendTo($(C))}if(!bldg3dc||update3dBuildings===false){bldg3dc=bldg3d[0].getContext("2d");bldg3dc.scale(s,s);update3dBuildings=q}}$(window).resize(X);var a8,a3,a0;for(a3=0;a3<wma_tilesets.length&&wma_tilesets[a3].globe!=Z;++a3){}aG(a3,true);aK();d();ai=/https?:\/\/([a-z-]+)\.wikipedia\.org\/wiki\/(.*)/;$("#wma_widget").mouseover(function(bb){var a9,ba;if(bb.metaKey||bb.ctrlKey){if(bb.target.href&&ai.test(bb.target.href)){a9=RegExp.$1;ba=RegExp.$2;$("#synopsistext").load("/summary/?l="+a9+"&t="+ba,function(){$("#synopsistext").css("direction",isRTL(a9)?"rtl":"ltr").find("a").attr("target","_top");$("#synopsis").fadeIn("slow");setTimeout(function(){var bd=$("#synopsistext").outerHeight(true),bc=ag/2;$("#synopsis").animate({height:bd<bc?bd:bc})},500)})}else{$("#synopsis").fadeOut("fast")}}});$("#synopsis").click(function(a9){if(a9.target==this){$("#synopsis").fadeOut("fast")}});if(window.postMessage){$(window).bind("message",ap);if(window!=window.top){try{window.parent.postMessage("request","*")}catch(a1){}}}}function aL(){if(ad.css("visibility")!="visible"){ad.css("visibility","visible")}else{ad.css("visibility","hidden")}return false}function b(){if(A.style.visibility!="visible"){A.style.visibility="visible"}else{A.style.visibility="hidden"}return false}function af(){var aY=$("<div></div>").addClass("wmatile").on("mousedown touchstart",ao).click(function(a1){var aZ,a0=aN(a1);if(a0.x!=L.x||a0.y!=L.y||!aW.csrender){return true}aZ=wmajt.detectPointer(a1,aW);if(aZ){aw(aZ)}}),aX=null,aW={div:aY,img:$("<img>").load(function(aZ){$(this).fadeIn(100)}).error(function(aZ){aX=setTimeout(function(){var a0=aW.img.attr("src");aW.img.attr("src",a0.replace(/\?.*/,"")+"?"+Math.random())},1*1000)}).appendTo(aY),can:$("<canvas></canvas>").appendTo(aY),ctx:null,csrender:false,csx:0,csy:0,csz:20,lx:0,ly:0,lz:20,span:$("<span></span>").appendTo(aY),debug:$("<span></span>").addClass("wmadbg").css("display","none").appendTo(aY),url:"",xhr:null};if(ab){if(s>1){aW.can.attr({width:128*s,height:128*s}).css({width:"128px",height:"128px"});aW.ctx=aW.can[0].getContext("2d");aW.ctx.scale(s,s)}else{aW.can.attr({width:128,height:128});aW.ctx=aW.can[0].getContext("2d")}}$(C).append(aW.div);return aW}function T(){var aX,aW;if(C===null){$(document).on("mousemove touchmove",function(aY){aH(aY);aY.preventDefault()}).on("mouseup touchend",function(){R=null});$("#wma_map").on("dblclick",W).on("mousedown touchstart",ao);C=document.getElementById("wma_map");w=Math.floor(aV/p)+2;v=Math.floor(ag/o)+2;l=[];for(var aW=0;aW<v;aW++){for(var aX=0;aX<w;aX++){l.push(af())}}O.obj=$('<div id="wmamarker"></div>');$(C).append(O.obj)}}function X(){var aX=$(window).width(),aZ=$(window).height(),aW=Math.floor(aX/p)+2,a0=Math.floor(aZ/o)+2,aY;aV=aX;ag=aZ;if(ab){if(aR.canvas!==null){aR.canvas.attr({width:aX*s,height:aZ*s}).css({width:aX+"px",height:aZ+"px"});aR.c.setTransform(s,0,0,s,0,0)}bldg3d.attr({width:aX*s,height:aZ*s}).css({width:aX+"px",height:aZ+"px"});if(bldg3dc.viewport){bldg3dc.viewport(0,0,aX*s,aZ*s)}}if(aW!=w||a0!=v){w=aW;v=a0;while(l.length<aW*a0){l.push(af())}for(aY=0;aY<l.length;++aY){if(aY<aW*a0){l[aY].div.show()}else{l[aY].div.hide()}}aK();$(C).width(aX).height(aZ)}else{if(aR.shown){ae()}}}function aq(){if(aR.shown){aR.canvas.fadeOut(200)}else{aR.canvas.fadeIn(200)}aR.shown=!aR.shown}function J(aY){var a0,aZ,aX,a1=aO.c,a4=aO.ways,a2=aO.areas,aW,a6=E,a5=D;function a3(a7){var a9,bc,ba,a8,bb;if(a7.length>0){bb=a7[0].lat+aY.lat;bc=ay(bb,a7[0].lon/Math.cos(bb/180*Math.PI)+aY.lon);ba=bc.x;a1.moveTo(bc.x-a6,bc.y-a5);for(a9=1;a9<a7.length;++a9){bb=a7[a9].lat+aY.lat;bc=ay(bb,a7[a9].lon/Math.cos(bb/180*Math.PI)+aY.lon);a1.lineTo(bc.x-a6,bc.y-a5)}}}if(a1!==null){a1.clearRect(0,0,aO.canvas[0].width,aO.canvas[0].height);if(a2!==null){a1.fillStyle="rgb(0,255,0)";for(a0=0;a0<a2.length;a0++){a1.globalCompositeOperation="source-over";for(aZ=0;aZ<a2[a0].outer.length;++aZ){a1.beginPath();a3(a2[a0].outer[aZ]);a1.closePath();a1.fill()}a1.globalCompositeOperation="destination-out";for(aZ=0;aZ<a2[a0].inner.length;++aZ){a1.beginPath();a3(a2[a0].inner[aZ]);a1.closePath();a1.fill()}}}if(a4!==null){a1.globalCompositeOperation="source-over";a1.lineWidth=4;a1.strokeStyle="rgb(0,255,0)";a1.beginPath();for(a0=0;a0<a4.length;++a0){a3(a4[a0])}a1.stroke()}}}function ae(a3,aY,aX,a0,a9,a4){var a2,a1,aZ,a7=aR.ways,a5=aR.areas,aW,ba,a8,bb;a3=a3||wma_zoomsize[Y]*p;aY=(aY!==undefined)?aY:E;aX=(aX!==undefined)?aX:D;a4=a4||aR.c;bb=aY;function a6(bc){var be,bh,bg=0,bf,bd;if(bc[0].lon<aR.minlon){bg=2*a3}if(bc.length>0){bh=ay(bc[0].lat,bc[0].lon,a3);bf=bh.x;a4.moveTo(bh.x-bb+bg,bh.y-aX);for(be=1;be<bc.length;++be){bh=Q(bc[be].lat,bc[be].lon,a3);bd=bh.x-bf;if(Math.abs(bd)>a3){bg-=Math.round(bd/(2*a3))*2*a3}bf=bh.x;a4.lineTo(bh.x-bb+bg,bh.y-aX)}}}if(a4!==null){a0=a0||aR.canvas[0].width;a9=a9||aR.canvas[0].height;a4.clearRect(0,0,a0,a9);for(aZ=-2;aZ<=2;++aZ){bb=aY+aZ*2*a3;ba=ay(0,aR.minlon,a3);a8=ay(0,aR.maxlon,a3);if(a8.x-bb<0||ba.x-bb>a0){continue}if(a5!==null){a4.fillStyle="rgb(255,0,0)";a4.strokeStyle="rgb(0,0,0)";a4.lineWidth=2;for(a2=0;a2<a5.length;a2++){a4.globalCompositeOperation="source-over";for(a1=0;a1<a5[a2].outer.length;++a1){a4.beginPath();a6(a5[a2].outer[a1]);a4.closePath();a4.fill();a4.stroke()}a4.globalCompositeOperation="destination-out";for(a1=0;a1<a5[a2].inner.length;++a1){a4.beginPath();a6(a5[a2].inner[a1]);a4.closePath();a4.fill();a4.stroke()}}}if(a7!==null){a4.globalCompositeOperation="source-over";a4.lineWidth=4;a4.strokeStyle="rgb(0,0,255)";a4.beginPath();for(a2=0;a2<a7.length;++a2){a6(a7[a2])}a4.stroke()}}}}function aK(){function a1(bn,bl){var bq,bp,bm,bo,bk=[0,0,5,0,0,2,3,4,5,6,6],bi=[0,0,8,0,0,2,3,4,5,6,6];bn.text("");for(bm=0;bm<bl.length;++bm){bp=$("<a></a>");if("img" in bl[bm]){(function(bu,br,bs,bt){bp.click(function(bw){var bv=aN(bw);if(bv.x!=L.x||bv.y!=L.y){bw.preventDefault()}else{if(bw.which==1&&(!bw.ctrlKey)){m(bu,br,bs,bt);bw.preventDefault()}}}).attr("href","//commons.wikimedia.org/wiki/File:"+bl[bm].img)})(bl[bm].img,bl[bm].w,bl[bm].h,bl[bm].m5);bq=(parseInt(bl[bm].w)>parseInt(bl[bm].h))?(bl[bm].style==-2?24:48):Math.floor((bl[bm].style==-2?24:48)*bl[bm].w/bl[bm].h);bp.addClass("cthumb").append($("<img/>",{title:decodeURIComponent(bl[bm].img)}).error(function(){$(this).parent().hide()}).attr({src:G(bl[bm].img,bq,bl[bm].m5),srcset:(2*bq<=bl[bm].w)?(G(bl[bm].img,bq*2,bl[bm].m5)+" 2x"):""}));if(bl[bm].head<18){bp.addClass("dir dir"+bl[bm].head);bo=8}else{bo=6}bp.css({top:(bl[bm].ty-bo)+"px",left:(bl[bm].tx-bo)+"px"})}else{bp.addClass("label").addClass("label"+bl[bm].style).css(aU).attr({href:"//"+bl[bm].lang+".wikipedia.org/wiki/"+bl[bm].page,target:"_top"}).css({top:(bl[bm].ty-bi[bl[bm].style])+"px",left:(bl[bm].tx-bk[bl[bm].style])+"px",direction:isRTL(bl[bm].lang)?"rtl":"ltr"});var bj=/(.*?)(\s*\([^\)]*\)$|\s*,[^,\(]*$)/.exec(bl[bm].name);if(bj){bp.text(bj[1]).append($('<span class="hell">&hellip;</span>')).append($('<span class="sufx"></span>').text(bj[2]).hide()).hover(function(){$(".hell",this).hide();$(".sufx",this).show()},function(){$(".hell",this).show();$(".sufx",this).hide()})}else{bp.text(bl[bm].name)}}bn.append(bp)}}function bb(bp,bk){var bt=bp.lx,bs=bp.ly,br=bp.lz,bo=1<<(br-wma_maxlabel),bv,bu,bq,bn,bl,bj=[],bm,bi=[[],[],[],[]];for(bm=0;bm<bk.length;bm++){bv=128*(bt/bo-bk[bm].dx);bu=128*(bs/bo-(wma_zoomsize[wma_maxlabel]-bk[bm].dy-1));bn=(bk[bm].tx+bk[bm].fx-bv)*bo;bl=(bk[bm].ty+bk[bm].fy-bu)*bo;if(bn>=0&&bn<128&&bl>=0&&bl<128){bq=jQuery.extend(true,{},bk[bm]);bq.tx=Math.floor(bn);bq.ty=Math.floor(bl);bq.fx=bn-bq.tx;bq.fy=bl-bq.ty;bi[Math.floor(bn/64)+2*Math.floor(bl/64)].push(bq)}}for(bm=0;bm<4;bm++){if(bi[bm].length>0){bi[bm].sort(function(bx,bw){return bw.wg-bx.wg});bj.push(bi[bm][0])}}a1(bp.span,bj)}if(D<0){D=0}if(E<0){E+=Math.floor(wma_zoomsize[Y]*2*p)}if(E>0){E%=Math.floor(wma_zoomsize[Y]*2*p)}var a2=Math.floor(E/p)%w,a0=Math.floor(D/o)%v,aZ=E%p,aY=D%o,ba,a8,aW,bh,bg,bf,be,bd,a7,a6,bc,a9,a3,aX;t();var a5=new Date;for(var be=0;be<v;be++){for(var bf=0;bf<w;bf++){bc=((bf+a2)%w)+((be+a0)%v)*w;a7=(Math.floor(E/p)+bf);a6=(Math.floor(D/o)+be);a3=wma_tilesets[aA].getTileURL(a6,a7,Y);a9=l[bc];a9.div.css({left:(bf*p-aZ)+"px",top:(be*o-aY)+"px"});if(a9.url!=a3||wma_highzoom_purge){a9.url=a3;if(aA==0&&Y>12){if(!a9.csrender){a9.csrender=true;a9.img.fadeOut(200)}if(a9.csx!=a7||a9.csy!=a6||a9.csz!=Y||wma_highzoom_purge){a9.can.hide();a9.img.hide();wmajt.update(a7,a6,Y,a9,wma_highzoom_purge)}}else{a9.csz=Y;if(a9.csrender){a9.can.fadeOut(200)}if(a6>=wma_zoomsize[Y]){a9.img.fadeOut(0);a9.span.text("");continue}if(a9.img.attr("src")!=a3){a9.img.fadeOut(0).attr("src",a3)}else{if(a9.csrender){a9.img.fadeIn(200)}}a9.csrender=false}if(a9.xhr!==null){a9.xhr.abort()}a9.lx=a7;a9.ly=a6;a9.lz=Y;a9.span.html('<span class="loading">'+strings.labelLoading[e]+"</span>");if(Y>wma_maxlabel){ba=Math.floor(a7/(1<<(Y-wma_maxlabel)));a8=Math.floor(a6/(1<<(Y-wma_maxlabel)));aX=aM(a8,ba,wma_maxlabel);aW=K(a8,ba,wma_maxlabel)}else{aX=aM(a6,a7,Y);aW=K(a6,a7,Y)}if(lc[aW]&&!("filler" in lc[aW])){(Y<wma_maxlabel)?a1(a9.span,lc[aW].label):bb(a9,lc[aW].label)}else{if(lc[aW]&&"filler" in lc[aW]){a1(a9.span,lc[aW].label)}else{if(Y<=wma_maxlabel&&Y>0){bh=K(Math.floor(a6/2),Math.floor(a7/2),Y-1);if(lc[bh]){ba=a7%2;lc[aW]={label:[],filler:1};for(bd=0;bd<lc[bh].label.length;bd++){if(Math.floor(lc[bh].label[bd].tx/64)===(a7%2)&&Math.floor(lc[bh].label[bd].ty/64)===(a6%2)){bg=jQuery.extend(true,{},lc[bh].label[bd]);bg.tx=(bg.tx+bg.fx)*2-(a7%2)*128;bg.ty=(bg.ty+bg.fy)*2-(a6%2)*128;bg.fx=bg.tx-Math.floor(bg.tx);bg.fy=bg.ty-Math.floor(bg.ty);bg.tx=Math.floor(bg.tx);bg.ty=Math.floor(bg.ty);lc[aW].label.push(bg)}}a1(a9.span,lc[aW].label)}}}(function(bk,bj,bi){a9.xhr=$.ajax({url:bj,context:a9}).success(function(bl){try{lc[bk]=JSON.parse(bl);bi?a1(this.span,lc[bk].label):bb(this,lc[bk].label)}catch(bm){this.span.html(bl)}}).error(function(){this.span.text("")})})(aW,aX,Y<wma_maxlabel)}}}}g(O);for(bc=0;bc<I.length;++bc){g(I[bc])}wma_highzoom_purge=false;if(Y>=wma_bldg3dzoom){update3dBuildings()}ae();var a4=new Date}function aE(a0){a0.clearColor(0,0,0,0);a0.clearDepth(1);a0.enable(a0.DEPTH_TEST);a0.depthMask(true);a0.depthFunc(a0.LEQUAL);a0.clear(a0.COLOR_BUFFER_BIT+a0.DEPTH_BUFFER_BIT);var aZ=a0.createProgram();var a1=a0.createShader(a0.VERTEX_SHADER);a0.shaderSource(a1,$("#bldg-vs").text());a0.compileShader(a1);a0.attachShader(aZ,a1);var a2=a0.createShader(a0.FRAGMENT_SHADER);a0.shaderSource(a2,$("#bldg-fs").text());a0.compileShader(a2);a0.attachShader(aZ,a2);a0.linkProgram(aZ);a0.useProgram(aZ);aZ.vertexPosAttrib=a0.getAttribLocation(aZ,"pos");a0.enableVertexAttribArray(aZ.vertexPosAttrib);aZ.normalPosAttrib=a0.getAttribLocation(aZ,"norm");a0.enableVertexAttribArray(aZ.normalPosAttrib);var a3=a0.getUniformLocation(aZ,"u_resolution");var a5=a0.getUniformLocation(aZ,"u_centerdeg");var a4=a0.getUniformLocation(aZ,"u_lightdir");var aY=3,aX=2,aW=5;r=Math.sqrt(aY*aY+aX*aX+aW*aW);a0.uniform3f(a4,aY/r,aX/r,aW/r);wmajt.registerWebGLBuildingData(5000,a0,aZ);return function(){var a8=aV/2,a7=ag/2,a6=60/(128*1<<Y),a9=aJ(E+a8,D+a7);if(a9.lon>180){a9.lon-=360}a0.uniform3f(a3,a8*a6,a7*a6,850);a0.uniform3f(a5,a9.lon,a9.lat,0);a0.clear(a0.COLOR_BUFFER_BIT|a0.DEPTH_BUFFER_BIT);wmajt.renderWebGLBuildingData()}}function q(){if(ab&&Y>wma_bldg3dzoom){var aX=wmajt.ref_z(),aW=wmajt.zbuild(),a9=aV/2,a8=ag/2,a2=(128*1<<Y)/60,a0,aZ,a5=bldg3dc,a3,aY,a4,a1,a6=aJ(E+a9,D+a8);if(a6.lon>180){a6.lon-=360}function a7(bb){var ba;if(aY>0){a5.moveTo((bb[0][0]-a6.lon)*a0+a9,a8-(bb[0][1]-a6.lat)*a0);for(ba=1;ba<bb.length;ba++){a5.lineTo((bb[ba][0]-a6.lon)*a0+a9,a8-(bb[ba][1]-a6.lat)*a0)}}for(ba=0;ba<bb.length-1;ba++){a5.moveTo((bb[ba][0]-a6.lon)*a0+a9,a8-(bb[ba][1]-a6.lat)*a0);a5.lineTo((bb[ba][0]-a6.lon)*aZ+a9,a8-(bb[ba][1]-a6.lat)*aZ);a5.lineTo((bb[ba+1][0]-a6.lon)*aZ+a9,a8-(bb[ba+1][1]-a6.lat)*aZ)}}a5.lineWidth=0.5;a5.strokeStyle="rgb(0,0,0)";a5.beginPath();bldg3dc.clearRect(0,0,aV,ag);for(a1 in aX){a4=aW[a1].geo.coordinates;a3=(aW[a1].tags["building:levels"]*3)||aW[a1].tags.height;aY=(aW[a1].tags["building:min_level"]*3)||aW[a1].tags.min_height||0;a0=a2*(1+aY/450);aZ=a2*(1+a3/450);if(aW[a1].geo.type==="Polygon"){for(a1=0;a1<a4.length;a1++){a7(a4[a1])}}else{a7(a4)}}a5.stroke();bldg3d.show();if(bldg3dtimer!==null){clearTimeout(bldg3dtimer)}setTimeout(update3dBuildings,1500)}else{bldg3d.hide()}}function g(aW){var aX=Q(aW.lat,aW.lon),aY=(aX.x-E);if(aY<-100){aY+=(wma_zoomsize[Y]*256)}aW.obj.css("left",(aY-6)+"px");aW.obj.css("top",(aX.y-D-6)+"px")}function ao(aW){L=R=aN(aW)}function aH(aW){window.scrollTo(0,0);var aY=aN(aW);if(R!==null){E-=(aY.x-R.x);D-=(aY.y-R.y);R=aY;aK();if(av){av=false;d()}}if(aO.shown){J(aJ(E+aY.x,D+aY.y))}var aX=aJ(E+aV/2,D+ag/2);aC&&aC.setLatLon(aX.lat,aX.lon)}function W(aW){var aX=aN(aW);E+=aX.x-aV/2;D+=aX.y-ag/2;if(av){av=false;d()}aK();return false}function aw(aW){if(h){clearTimeout(h)}z.stop(true).fadeTo(1,1).text(aW);h=setTimeout(function(){z.fadeOut(200)},5000)}function ar(aW){Y=aW;if(bldg3d){if(aW>=wma_bldg3dzoom){bldg3d.show()}else{bldg3d.hide()}}}function at(aX,aW){if(aW=="+"){aW=prompt("Enter article title to use as overlay");if(!aW){return}}if(aW=="*"){aW=aj.page;aX=aj.lang}if(aW=="-"){aO.shown=false;aO.canvas.fadeOut(200);return}P(aX,aW);b()}function P(aX,aW){$.ajax({url:"//tools.wmflabs.org/wiwosm/osmjson/getGeoJSON.php?lang="+aX+"&article="+aW,dataType:"json",success:ax})}function M(aZ){var aX=false;aZ=aZ||window.event;switch(aZ.keyCode||aZ.which){case 37:E-=aV/1;break;case 38:D-=ag/1;break;case 39:E+=aV/1;break;case 40:D+=ag/1;break;case 187:case 107:ac();break;case 189:case 109:S();break;case 80:wma_highzoom_purge=true;aK();break;case 79:if(aO.shown){aO.shown=false;aO.canvas.fadeOut(200)}else{P(strings.sover[e].site,strings.sover[e].list[0])}break;case 84:aG((aA+1)%wma_tilesets.length);break;case 76:var aY,a0,aW=["en","de","fr","ru","ar","he","ko","ja","ml","fa","commons"];aY=aW[($.inArray(au,aW)+1)%aW.length];z.text(wikiminiatlas_sites[aY]);aB(aY,true);break;case 67:aB("commons",true);break;case 27:if(aO.shown){aO.shown=false;aO.canvas.fadeOut(200)}if(az.shown){U()}if(A.style.visibility!="hidden"){A.style.visibility="hidden"}break;default:aX=true}if(av){av=false;d()}aK();return aX}function aN(aW){var aX=aW.originalEvent;if("touches" in aX){return{x:aX.touches[0].pageX,y:aX.touches[0].pageY}}else{return{x:aW.pageX,y:aW.pageY}}}function K(aY,aW,aX){return au+"_"+(wma_zoomsize[aX]-aY-1)+"_"+(aW%(wma_zoomsize[aX]*2))+"_"+aX+"_"+wma_tilesets[aA].globe}function aM(aY,aW,aX){return wma_database+"?l="+au+"&a="+(wma_zoomsize[aX]-aY-1)+"&b="+(aW%(wma_zoomsize[aX]*2))+"&z="+aX+"&g="+wma_tilesets[aA].globe}function aT(){var aX=wma_tilesets[aA].globe;for(var aW=aA+1;aW<wma_tilesets.length;aW++){if(wma_tilesets[aW].maxzoom>=(Y+1)&&wma_tilesets[aW].globe==aX){aA=aW;Y++;return}}}function k(){for(var aW=aA-1;aW>=0;aW--){if(wma_tilesets[aW].minzoom<(Y-1)){aA=aW;Y--;return}}}function ac(aX){var aY=aJ(E+aV/2,D+ag/2);var aW=false;if(!aX){var aX=window.event}if(aX){if(aX.which){aW=(aX.which==3)}else{if(aX.button){aW=(aX.button==2)}}}if(aW){if(ab&&wma_highzoom_activated){ar((aA==0)?15:wma_tilesets[aA].maxzoom)}else{ar((aA==0)?12:wma_tilesets[aA].maxzoom)}}else{if(Y>=((aA==0&&!(ab&&wma_highzoom_activated))?12:wma_tilesets[aA].maxzoom)){}else{ar(Y+1)}}var aZ;if(av){aZ=Q(O.lat,O.lon)}else{aZ=Q(aY.lat,aY.lon)}E=aZ.x-aV/2;D=aZ.y-ag/2;aK();return false}function S(aZ){var aY=aJ(E+aV/2,D+ag/2);var aW=false;if(!aX){var aX=window.event}if(aX){if(aX.which){aW=(aX.which==3)}else{if(aX.button){aW=(aX.button==2)}}}if(aW){ar(wma_tilesets[aA].minzoom)}else{if(Y<=wma_tilesets[aA].minzoom){k()}else{ar(Y-1)}}var a0=Q(aY.lat,aY.lon);E=a0.x-aV/2;D=a0.y-ag/2;aK();return false}function aG(a0,aZ){var aX=Y;aA=a0;aU={color:wma_tilesets[a0].linkcolor[0],textShadow:wma_tilesets[a0].linkcolor[1]};$("a.label").css(aU);credit.text("");if("credit" in wma_tilesets[a0]){credit.html(wma_tilesets[a0].credit)}if(aX>(a0!=0?wma_tilesets[a0].maxzoom:((ab&&wma_highzoom_activated)?15:12))){aX=wma_tilesets[a0].maxzoom}if(aX<wma_tilesets[a0].minzoom){aX=wma_tilesets[a0].minzoom}if(Y!=aX){var aW=aJ(E+aV/2,D+ag/2);ar(aX);var aY=Q(aW.lat,aW.lon);E=aY.x-aV/2;D=aY.y-ag/2}if(!aZ){aK()}aF()}function aB(aW){au=aW;for(var aX=0;aX<w*v;aX++){l[aX].url=""}aK()}function t(){var aY=aJ(E+aV/2,D+ag/2);var aX=50,a0;var aW,aZ;aW=Math.cos(aY.lat*0.0174532778)*wma_tilesets[aA].equator*aX/(256*wma_zoomsize[Y]);aZ=Math.pow(10,Math.floor(Math.log(aW)/Math.log(10)));a0=aX*aZ/aW;if(5*a0<aX){a0=a0*5;aZ=aZ*5}if(2*a0<aX){a0=a0*2;aZ=aZ*2}y.text(aZ<1?(aZ*1000)+" m":aZ+" km");c.width(a0)}function d(){if(av){$("#button_target").css("background-position","")}else{$("#button_target").css("background-position","-40px 0")}}function aD(aW,aY){var aX=Q(aW,aY);E=aX.x-aV/2;D=aX.y-ag/2;aK()}function ah(){aD(O.lat,O.lon);av=true;d()}function ay(aX,aY,aW){aW=aW||wma_zoomsize[Y]*p;return{y:Math.floor((0.5-aX/180)*aW),x:Math.floor((aY/360)*aW*2)}}function Q(aX,aY,aW){aW=aW||wma_zoomsize[Y]*p;var aZ=Math.floor((aY/360)*aW*2);if(aZ<0){aZ+=aW*2}return{y:Math.floor((0.5-aX/180)*aW),x:aZ}}function aJ(aW,aX){return{lat:180*(0.5-aX/(wma_zoomsize[Y]*128)),lon:360*(aW/(wma_zoomsize[Y]*256))}}function aa(aW){$("#debugbox").append($("<div></div>").text(aW))}function G(aX,aW,aY){return aY?"//upload.wikimedia.org/wikipedia/commons/thumb/"+aY[0]+"/"+aY+"/"+aX+"/"+aW+"px-"+aX:"//commons.wikimedia.org/w/thumb.php?w="+aW+"&f="+aX}function U(){az.shown=false;az.panel.fadeOut(200)}function B(){az.panel=$("<div></div>",{id:"wma_wmaci_panel"}).append($("<div></div>",{id:"wma_wmaci_panel_sub"}).append(az.span=$("<span></span>")).append($("<br/>")).append(az.link=$("<a></a>",{id:"wma_wmaci_link",target:"_top"}).click(function(aW){aW.stopPropagation()}))).css("visibility","visible").hide().click(U).appendTo(ad)}function m(aW,a3,a0,a2){if(az.panel==null){B()}var a1=aV-30;var aY=ag-80;var aX=a3;var a4=a0;if(aX>a1){a4=Math.round((a4*a1)/aX);aX=a1}if(a4>aY){aX=Math.round((aX*aY)/a4);a4=aY}az.span.find("img").remove();var aZ=$("<img/>",{id:"wma_wmaci_image"}).appendTo(az.span);if(aX*2<a3){aZ.attr({src:G(aW,Math.floor(aX/10)*10,a2),srcset:G(aW,Math.floor(aX/10)*20,a2)+" 2x"})}else{if(aX<a3){aZ.attr({src:G(aW,Math.floor(aX/10)*10,a2)})}else{aZ.attr("src","//commons.wikimedia.org/wiki/Special:FilePath/"+aW)}}az.link.attr("href","//commons.wikimedia.org/wiki/File:"+aW).text("[[:commons:File:"+decodeURIComponent(aW)+"]]");az.panel.fadeIn(200);az.shown=true}function al(){var aW=window.open("","showwin","left=0,top=0,width="+screen.width+",height="+screen.height+",toolbar=0,resizable=0,fullscreen=1"),aY=aj.page,aZ=aj.lang,a0=wma_tilesets[aA].globe,aX=aJ(E+aV/2,D+ag/2);aW.document.location=document.location.pathname+"?"+O.lat+"_"+O.lon+"_"+0+"_"+0+"_"+au+"_"+Y+"_"+aP+"_"+aX.lat+"_"+aX.lon+"&globe="+a0+"&page="+aY+"&lang="+aZ}function am(aW,aX){return function(aY){window.parent.postMessage(aX+","+aW,"*")}}function x(aW){if(!ab){return}aW=aW||aR;if(aW.canvas===null){aW.canvas=$('<canvas class="wmakml"></canvas>').attr({width:aV*s,height:ag*s}).css({width:aV+"px",height:ag+"px"}).appendTo($(C));aW.c=aW.canvas[0].getContext("2d");aW.c.scale(s,s);aW.shown=true;aW.drawn=true;if(aW==aR){$("#button_kml").show()}}if(aW===aR&&aC){aC.updateKML()}}function ap(a0){a0=a0.originalEvent;var a1=JSON.parse(a0.data),aZ,aX,aW;if("coords" in a1){for(aZ=0;aZ<a1.coords.length;++aZ){aW={obj:null,lat:a1.coords[aZ].lat,lon:a1.coords[aZ].lon};if(Math.abs(aW.lat-O.lat)>0.0001||Math.abs(aW.lon-O.lon)>0.0001){aW.obj=$("<div></div>").attr("title",decodeURIComponent(a1.coords[aZ].title)).addClass("emarker").mouseover(am(aZ,"highlight")).mouseout(am(aZ,"unhighlight")).click(am(aZ,"scroll")).appendTo($(C));g(aW);I.push(aW)}}}if(("ways" in a1)||("areas" in a1)){x();aR.ways=a1.ways||null;aR.areas=a1.areas||null;ae()}if(("minlon" in a1)&&("maxlon" in a1)){if(!("maxlon" in aR)||a1.maxlon>aR.maxlon){aR.maxlon=a1.maxlon}if(!("minlon" in aR)||a1.minlon<aR.minlon){aR.minlon=a1.minlon}}if("getcoords" in a1){var a2={query:a1.getcoords,response:{topleft:aJ(E,D),rightbottom:aJ(E+aV,D+ag)}};if(window.parent){window.parent.postMessage(JSON.stringify(a2),a0.origin)}}if("moveto" in a1){var aY=a1.moveto;if("zoom" in aY){ar(aY.zoom)}if("lat" in aY&&"lon" in aY){aD(aY.lat,aY.lon);aC&&aC.setLatLon(aY.lat,aY.lon)}}}function F(a2,a1){function aY(a8){var a5,a9,a3,bd=180/Math.PI,a6=Math.PI/2,a4=180/20037508.34,bc=[],ba=-Infinity,a7=Infinity,bb;for(a5=0;a5<a8.length;++a5){a3=a8[a5][0]*a4;a9=bd*(2*Math.atan(Math.exp(a8[a5][1]*a4/bd))-a6);if(a3>ba){ba=a3}if(a3<a7){a7=a3}if(a9>a1.maxlat){a1.maxlat=a9}if(a9<a1.minlat){a1.minlat=a9}bc.push({lat:a9,lon:a3})}if(!("maxlon" in a1)||!("maxlon" in a1)){a1.maxlon=ba;a1.minlon=a7}else{bb=[{r:Math.max(a1.maxlon,ba),l:Math.min(a1.minlon,a7)},{r:Math.max(a1.maxlon,ba+360),l:Math.min(a1.minlon,a7+360)},{r:Math.max(a1.maxlon+360,ba),l:Math.min(a1.minlon+360,a7)}];bb.sort(function(bf,be){return(bf.r-bf.l)-(be.r-be.l)});a1.minlon=bb[0].l;a1.maxlon=bb[0].r}return bc}function aX(a5){var a4={outer:[],inner:[]},a3;a4.outer.push(aY(a5[0]));for(a3=1;a3<a5.length;a3++){a4.inner.push(aY(a5[a3]))}if(a1.areas){a1.areas.push(a4)}else{a1.areas=[a4]}}function aW(a3){var a4=[aY(a3)];if(a1.ways){a1.ways.push.apply(a1.ways,a4)}else{a1.ways=a4}}function a0(a4){var a3;switch(a4.type){case"LineString":aW(a4.coordinates);break;case"MultiLineString":for(a3=0;a3<a4.coordinates.length;a3++){aW(a4.coordinates[a3])}break;case"Polygon":aX(a4.coordinates);break;case"MultiPolygon":for(a3=0;a3<a4.coordinates.length;a3++){aX(a4.coordinates[a3])}break}}var aZ;if(!("type" in a2)){return}if(a2.type=="GeometryCollection"){for(aZ=0;aZ<a2.geometries.length;++aZ){a0(a2.geometries[aZ])}}else{a0(a2)}}function a(a1){F(a1,aR);if(aR.ways||aR.areas){x();ae()}if(aR.maxlon&&aR.minlon&&aR.maxlat>-Infinity&&aR.minlat<Infinity){var a0=(aR.maxlon+aR.minlon)/2,aZ=(aR.maxlat+aR.minlat)/2,aY=(aR.maxlon-aR.minlon)/180*3*128,aW=(aR.maxlat-aR.minlat)/180*3*128,aX;for(aX=0;aX<12;++aX){if(aY>aV/2||aW>ag/2){break}aY*=2;aW*=2}ar(aX);aD(aZ,a0)}}function ax(a2){var a3=aO.c,aY=aO.canvas;if(aY){aO={shown:true,drawn:false,canvas:aY,c:a3,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity}}else{aO={shown:true,drawn:false,canvas:null,c:null,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity};x(aO)}F(a2,aO);var aX=aO.areas,aW=aO.ways,a1=(aO.maxlon+aO.minlon)/2,a0=(aO.maxlat+aO.minlat)/2;function aZ(a4){var a6,a5=0;if(a4[0].lon<aO.minlon){a5=360}for(a6=0;a6<a4.length;++a6){a4[a6].lon-=a1-a5;a4[a6].lon*=Math.cos(a4[a6].lat/180*Math.PI);a4[a6].lat-=a0}}if(aX!==null){for(i=0;i<aX.length;i++){for(j=0;j<aX[i].outer.length;++j){aZ(aX[i].outer[j])}for(j=0;j<aX[i].inner.length;++j){aZ(aX[i].inner[j])}}}if(aW!==null){for(i=0;i<aW.length;++i){latNorm(aW[i])}}aO.canvas.fadeIn(200)}aS()}function wmaMenu(a){this.div=$("<div></div>").addClass("wmamenu").css("direction",(a===true?"rtl":""));this.parent=null;this.shown=false}wmaMenu.prototype.addTitle=function(a,c){var b=$("<div></div>").addClass("wmamenutitle").html(a).css("direction",(c===true)?"rtl":"").appendTo(this.div);return b};wmaMenu.prototype.addItem=function(a,d,e){d=d||(function(){});var c=this,b=$("<div></div>").addClass("wmamenuitem").html(a).css("direction",(e===true)?"rtl":"").mouseenter(function(){b.css("background-color","#AAA")}).mouseleave(function(){b.css("background-color","")}).click(function(){d();c.close()}).appendTo(this.div);return b};wmaMenu.prototype.addMenu=function(a,d,c){var b=$("<div></div>").addClass("wmasubmenu").html(a).css("direction",(c===true)?"rtl":"").mouseenter(function(){b.css("background-color","#AAA")}).mouseleave(function(){b.css("background-color","");d.hide()}).click(function(){d.move(b.width(),0);d.show()}).append(d.div).appendTo(this.div);d.parent=this;return b};wmaMenu.prototype.addCheck=function(b,f,c,g){function a(){if(c){d.addClass("wmamenuchecked")}else{d.removeClass("wmamenuchecked")}}function e(){c=!c;a();f(c)}var d=this.addItem(b,e,g);f=f||(function(){});a();return{toggle:function(h){if(h===undefined){c=!c;a()}},check:a,item:d}};wmaMenu.prototype.addGroup=function(l,a,b,g){var f={},d=this,e=-1;function k(o){if(o==e){return}for(var m in f){if(m==o){f[m].addClass("wmamenuselected")}else{f[m].removeClass("wmamenuselected")}}e=o}function h(o,m){f[o]=d.addItem(m,function(){k(o);a(o)},g)}b=b||0;a=a||(function(){});for(var c=0;c<l.length;++c){if(typeof l[c]==="object"){h(l[c][0],l[c][1])}else{h(c,l[c])}}k(b);return{items:f,select:k,current:function(){return e},hide:function(){for(var m in f){f[m].hide()}},show:function(){for(var m in f){f[m].show()}}}};wmaMenu.prototype.addSep=function(){this.div.children().last().css({"border-bottom-style":"solid","border-bottom-width":"1px","border-bottom-color":"#AAA"})};wmaMenu.prototype.show=function(){this.div.fadeIn(200);this.shown=true};wmaMenu.prototype.hide=function(){this.div.fadeOut(200);this.shown=false};wmaMenu.prototype.toggle=function(){this.shown?this.hide():this.show()};wmaMenu.prototype.close=function(){this.hide();this.parent&&this.parent.close()};wmaMenu.prototype.move=function(a,b){this.div.css({top:b+"px",left:a+"px"})};