var wmajt=(function(){var s=128,G=128,m=12,q=14,v={},d={},u={},A={},L=false,B=true,a,o,M,n,H,g,f,I,k,b,E=null,t=null,F={Polygon:[["natural",{ocean:1},[{fillStyle:"rgb(250,250,208)"},{lineWidth:1,strokeStyle:"rgb(125,125,104)"}]],["railway",{platform:1},[{fillStyle:"rgb(220,220,220)"}]],["landuse",{industrial:1,retail:1,commercial:1,residential:1},[{fillStyle:"rgb(208,208,208)"}]],["landuse",{reservoir:1},[{fillStyle:"rgb(200,200,224)"}]],["landuse",{military:1,railway:1},[{fillStyle:"rgb(224,200,200)"}]],["landuse",{cemetery:1,recreation_ground:1},[{fillStyle:"rgb(190,214,190)"}]],["landuse",{grass:1},[{globalAlpha:0.3,fillStyle:"rgb(0,160,0)"},{globalAlpha:1}]],["leisure",{park:1,orchard:1,meadow:1,village_green:1,golf_course:1,track:1,forrest:1,recreation_ground:1,dog_park:1,garden:1,pitch:1,stadium:1},[{fillStyle:"rgb(200,224,200)"}]],["waterway",{riverbank:1,dock:1},[{fillStyle:"rgb(158,199,243)"}]],["natural",{beach:1},[{fillStyle:"rgb(224,224,200)"}]],["natural",{wetland:1,mud:1},[{fillStyle:"rgb(200,218,224)"}]],["natural",{grassland:1,fell:1},[{fillStyle:"rgb(200,224,200)"}]],["natural",{scrub:1},[{fillStyle:"rgb(150,214,150)"}]],["natural",{wood:1},[{fillStyle:"rgb(100,204,100)"}]],["natural",{water:1,bay:1},[{fillStyle:"rgb(158,199,243)"},{lineWidth:1,strokeStyle:"rgb(158,199,243)"}]],["natural",{glacier:1},[{fillStyle:"rgb(230,245,255)"},{lineWidth:1,strokeStyle:"rgb(255,255,255)"}]],["amenity",{university:1},[{lineWidth:0.5,strokeStyle:"rgb(240,225,183)"}]],["amenity",{parking:1},[{fillStyle:"rgb(240,235,193)"}]],["highway",{pedestrian:1},[{fillStyle:"rgb(255,255,255)"},{lineWidth:2,strokeStyle:"rgb(168,148,148)"}]],["tourism",true,[{dash:[3,3],lineWidth:2,strokeStyle:"rgb(255,255,0)"}]],["aeroway",{terminal:1},[{fillStyle:"rgb(190,210,190)"},{lineWidth:1,strokeStyle:"rgb(127,137,127)"}]],["historic",{memorial:1,monument:1,fort:1,castle:1},[{fillStyle:"rgb(255,190,190)"},{lineWidth:1,strokeStyle:"rgb(167,120,120)"}]],["historic",{ship:1,wreck:1},[{fillStyle:"rgb(255,190,235)"}]],["railway",{station:1},[{fillStyle:"rgb(210,195,195)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["natural",{water:1,bay:1},[{fillStyle:"rgb(158,199,243)"},{lineWidth:1,strokeStyle:"rgb(158,199,243)"}]],["building",true,[{fillStyle:"rgb(200,200,200)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["building:part",true,[{fillStyle:"rgb(200,200,200)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["start_date",true,[{dash:[2,5],lineWidth:3,strokeStyle:"rgb(255,0,0)"}]]],LineString:[["waterway",{canal:1},[{lineCap:"butt",lineWidth:3,strokeStyle:"rgb(158,199,243)"}]],["waterway",{river:1},[{lineWidth:1.5,strokeStyle:"rgb(126,159,194)"}]],["waterway",{stream:1},[{dash:[2,2],lineWidth:1.5,strokeStyle:"rgb(126,159,194)"}]],["route",{ferry:1},[{dash:[4,4],lineWidth:2,strokeStyle:"rgb(126,159,194)"}]],["highway",{pedestrian:1},[{lineWidth:5,strokeStyle:"rgb(255,255,255)"}]],["highway",{footway:1,pedestrian:1,path:1},[{lineWidth:2,strokeStyle:"rgb(198,178,178)"}]],["highway",{steps:1},[{dash:[1.5,1.5],lineWidth:3,strokeStyle:"rgb(168,148,148)"}]],["highway",{service:1},[{lineWidth:4,strokeStyle:"rgb(168,168,168)"},{lineWidth:2.5,strokeStyle:"rgb(208,208,208)"}]],["highway",{track:1},[{lineWidth:3.5,strokeStyle:"rgb(168,168,168)"},{lineWidth:2.5,strokeStyle:"rgb(250,250,208)"}]],["highway",{residential:1,unclassified:1},[{lineWidth:4,strokeStyle:"rgb(200,200,200)"},{lineWidth:2.5,strokeStyle:"rgb(255,255,255)"}]],["highway",{tertiary:1},[{lineWidth:5,strokeStyle:"rgb(200,200,200)"},{lineWidth:3.5,strokeStyle:"rgb(255,255,235)"}]],["railway",{subway:1},[{globalAlpha:0.2,lineWidth:3,strokeStyle:"rgb(100,100,100)"},{globalAlpha:1}]],["railway",{rail:1,preserved:1,monorail:1,narrow_gauge:1},[{lineWidth:3,strokeStyle:"rgb(100,100,100)"}]],["highway",{secondary:1,secondary_link:1,primary:1,primary_link:1},[{lineCap:"round",lineWidth:6,strokeStyle:"rgb(171,158,137)"}]],["highway",{motorway:1,motorway_link:1,trunk:1,trunk_link:1},[{lineWidth:7,strokeStyle:"rgb(188,149,28)"}]],["aeroway",{runway:1},[{lineWidth:10,strokeStyle:"rgb(100,130,100)"}]],["aeroway",{taxiway:1},[{lineWidth:4.5,strokeStyle:"rgb(100,130,100)"}]],["railway",{subway:1},[{lineCap:"butt",globalAlpha:0.3,dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(255,255,255)"},{globalAlpha:1}]],["railway",{rail:1,narrow_gauge:1},[{dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(255,255,255)"}]],["railway",{preserved:1},[{dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(200,200,200)"}]],["railway",{monorail:1},[{dash:[1,2,4,2],lineWidth:1.5,strokeStyle:"rgb(200,200,200)"}]],["highway",{secondary:1,secondary_link:1},[{lineCap:"round",lineWidth:4.5,strokeStyle:"rgb(255,250,115)"}]],["highway",{primary:1,primary_link:1},[{lineWidth:4,strokeStyle:"rgb(255,230,95)"}]],["highway",{motorway:1,motorway_link:1,trunk:1,trunk_link:1},[{lineWidth:5,strokeStyle:"rgb(242,191,36)"}]],["aeroway",{runway:1},[{lineWidth:8,strokeStyle:"rgb(150,180,150)"}]],["aeroway",{taxiway:1},[{lineWidth:2.5,strokeStyle:"rgb(150,180,150)"}]],["railway",{tram:1},[{globalAlpha:0.4,dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(0,0,0)"},{globalAlpha:1}]],["access",{permissive:1},[{dash:[1,2],lineWidth:1,strokeStyle:"rgb(100,200,100)"}]],["access",{"private":1,residents:1},[{dash:[1,2],lineWidth:1,strokeStyle:"rgb(200,100,100)"}]],["building:part",true,[{lineWidth:1,strokeStyle:"rgb(127,127,255)"}]],["start_date",true,[{dash:[2,5],lineWidth:3,strokeStyle:"rgb(255,0,0)"}]]]};function e(N,h){var w=N.concat(h),P=[],O={};for(i in w){if(w.hasOwnProperty(i)){if(!(w[i] in O)){O[w[i]]=true;P.push(w[i])}}}return P}function c(h,N,w){return h+"_"+N+"_"+w}function l(P){if(P===null){return}T=P.data;var U,R={0:1},T,Q,O;if(P.v&&P.v>=2){U=P.idx}else{U={};for(Q=0;Q<T.length;++Q){for(O in T[Q].tags){if(O in U){U[O].push(Q)}else{U[O]=[Q]}}}}for(Q=0;Q<T.length;++Q){if("layer" in T[Q].tags){R[T[Q].tags.layer]=1}}v[c(P.x,P.y,P.z)]={data:P.data,building:{},f:P.f||{},idx:U,lay:R};var T=P.data,w,h=P.x,S=P.y,N;if(P.z>=q){for(w=P.z;w>=m;w--){N=v[c(h,S,w)];if(w<q&&N&&N.data){for(Q=0;Q<T.length;++Q){if("osm_id" in T[Q].tags&&("building" in T[Q].tags||"building:part" in T[Q].tags)&&!(T[Q].tags.osm_id in N.building)){for(O in T[Q].tags){if(O in N.idx){N.idx[O].push(N.data.length)}else{N.idx[O]=[N.data.length]}}N.data.push(T[Q]);N.building[T[Q].tags.osm_id]=1}}}h=Math.floor(h/2);S=Math.floor(S/2)}}else{}p(this.csx,this.csy,this.csz,this)}function C(P,S){if(t){if(P.length>0){var V=(P[0][0]-a)*128/H,T=128-(P[0][1]-o)*128/g,Z,Y,R=0,Q=t.length,X=0,W,U,h,O,N,w;for(N=1;N<P.length;++N){S.moveTo(V,T);O=-X;Z=(P[N][0]-a)*128/H;Y=128-(P[N][1]-o)*128/g;W=Z-V;U=Y-T;h=Math.sqrt(W*W+U*U);W/=h;U/=h;w=false;while(true){O+=t[R];if(O>h){w=true;X=O-h;O=h}S[R%2?"moveTo":"lineTo"](O*W+V,O*U+T);if(w){break}R=(R+1)%Q}V=Z;T=Y}}}else{if(P.length>0){S.moveTo((P[0][0]-a)*128/H,128-(P[0][1]-o)*128/g);for(N=1;N<P.length;++N){S.lineTo((P[N][0]-a)*128/H,128-(P[N][1]-o)*128/g)}}}}function J(P,Q){var S=null,W={},h=Q.div.offset(),U=P.pageX-h.left,T=P.pageY-h.top,R=Q.csca.data||[],w,N,V,Y="";function O(ad,ae,Z){var ab,aa,ac;for(j=1;j<ad.length;++j){ab=(ad[j][0]-a)*128/H-U;aa=128-(ad[j][1]-o)*128/g-T;ac=ab*ab+aa*aa;if((S===null||ac<S)&&("name" in Z.tags||"addr:street" in Z.tags)){S=ac;W=Z}}}a=Q.csx*60/(1<<Q.csz);o=90-(((Q.csy+1)*60)/(1<<Q.csz));M=(Q.csx+1)*60/(1<<Q.csz);n=90-((Q.csy*60)/(1<<Q.csz));H=M-a;g=n-o;if(a>180){a-=360}for(N=0;N<R.length;++N){w=R[N];y(w,"Polygon",null,O);if(w.geo.type=="GeometryCollection"){y(w,"Line",null,O)}}V=W.tags||{};if("name" in V){Y=V.name;if("loc_name" in V){Y+=' "'+V.loc_name+'"'}if("artist_name" in V){Y+=" ("+V.artist_name+")"}return Y}if("addr:street" in V){Y=V["addr:street"];if("addr:housenumber" in V){Y=V["addr:housenumber"]+" "+Y}return Y}var X=["landuse","historic","highway","building"];for(N=0;N<X.length;++N){if(X[N] in V){return X[N]+" "+V[X[N]]}}return null}function y(h,O,R,Q){var N,w,P;switch(h.geo.type){case"Polygon":Q(h.geo.coordinates[0],R,h);break;case"LineString":Q(h.geo.coordinates,R,h);break;case"MultiLineString":for(N=0;N<h.geo.coordinates.length;N++){Q(h.geo.coordinates[N],R,h)}break;case"MultiPolygon":for(N=0;N<h.geo.coordinates.length;N++){Q(h.geo.coordinates[N][0],R,h)}break;case"GeometryCollection":P=h.geo.geometries;for(w=0;w<P.length;w++){if(O==="Polygon"){switch(P[w].type){case"Polygon":Q(P[w].coordinates[0],R,h);break;case"MultiPolygon":for(N=0;N<P[w].coordinates.length;N++){Q(P[w].coordinates[N][0],R,h)}break}}else{switch(P[w].type){case"LineString":Q(P[w].coordinates,R,h);break;case"MultiLineString":for(N=0;N<P[w].coordinates.length;N++){Q(P[w].coordinates[N],R,h)}break}}}break}}function p(V,U,T,P,N){var S=P.ctx;a=V*60/(1<<T);o=90-(((U+1)*60)/(1<<T));M=(V+1)*60/(1<<T);n=90-((U*60)/(1<<T));H=M-a;g=n-o;if(a>180){a-=360}function Y(ac){var ae,ad,ab,af,ai,Z,ag=ac.data,aa,ah;S.lineWidth=1;S.fillStyle="rgb(158,199,243)";S.fillRect(0,0,128,128);for(ai in F){for(Z=0;Z<F[ai].length;Z++){S.beginPath();if(!(F[ai][Z][0] in ac.idx)){continue}t=F[ai][Z][2][0].dash||null;ah=ac.idx[F[ai][Z][0]];for(ae=0;ae<ah.length;++ae){aa=ag[ah[ae]];if((ai!==aa.geo.type&&("Multi"+ai)!==aa.geo.type&&aa.geo.type!=="GeometryCollection")||!(F[ai][Z][1]===true||aa.tags[F[ai][Z][0]] in F[ai][Z][1])){continue}y(aa,ai,S,C)}af=F[ai][Z][2];for(ae=0;ae<af.length;ae++){for(ad in af[ae]){if(ad!="dash"){S[ad]=af[ae][ad]}}if("strokeStyle" in af[ae]){S.stroke()}if("fillStyle" in af[ae]){S.fill()}}}}}P.csx=V;P.csy=U;P.csz=T;var w,h=V,R=U,O,Q,X,W;for(w=T;w>=m;w--){O=v[c(h,R,w)];if(O&&O.data&&!N){if(P.csca){Q=P.csca.data;if(L&&"start_date" in P.csca.idx){W=P.csca.idx.start_date;for(i=0;i<W.length;++i){X=Q[W[i]].tags.start_date;if(X in d){d[X]--;if(d[X]==0){delete d[X]}}}}if(B&&T>q){W=e(P.csca.idx["building:levels"]||[],P.csca.idx.height||[]);for(i=0;i<W.length;++i){if("osm_id" in Q[W[i]].tags){X=Q[W[i]].tags.osm_id;if(X in u){u[X]--;if(u[X]==0){delete u[X]}}}}}}Y(O);P.csca=O;Q=O.data;if(L&&"start_date" in O.idx){W=O.idx.start_date;for(i=0;i<W.length;++i){X=Q[W[i]].tags.start_date;d[X]=(d[X]||0)+1}}if(B&&T>q){W=e(O.idx["building:levels"]||[],O.idx.height||[]);for(i=0;i<W.length;++i){if("osm_id" in Q[W[i]].tags){X=Q[W[i]].tags.osm_id;u[X]=(u[X]||0)+1;if(!(X in A)){A[X]=Q[W[i]]}}}}if(E!==null){W=e(O.idx["building:levels"]||[],O.idx.height||[]);for(i=0;i<W.length;++i){if("osm_id" in Q[W[i]].tags){X=Q[W[i]].tags.osm_id;if(!(X in u)){u[X]=true;X=Q[W[i]];if(X.geo.type==="Polygon"){x(X.geo.coordinates,(X.tags["building:min_level"]*3)||X.tags.min_height||0,(X.tags["building:levels"]*3)||X.tags.height)}}}}}P.can.show();if(T<q||w>=q){return}}h=Math.floor(h/2);R=Math.floor(R/2)}P.debug.html("tiles/jsontile.php?x="+V+"&y="+U+"&z="+T);$.ajax({url:"tiles/jsontile.php?x="+V+"&y="+U+"&z="+T+(N===true?"&action=purge":""),dataType:"json",success:l,context:P})}function D(h,N){glArrList=[];f=[];I=h;E=N;var O,w;k=0;b=0;O=new Float32Array(I*9);w=new Float32Array(I*9);glArrList.push({v:O,n:w});B=false}function z(N){var O,w,Q,h,P;if(glArrList.length>f.length||k>b){P=f.length-1;P=P<0?0:P;for(O=P;O<glArrList.length;++O){if(O>=f.length){Q=E.createBuffer();h=E.createBuffer();f.push({v:Q,n:h})}else{Q=f[O].v;h=f[O].n}E.bindBuffer(E.ARRAY_BUFFER,Q);E.bufferData(E.ARRAY_BUFFER,glArrList[O].v,E.STATIC_DRAW);E.bindBuffer(E.ARRAY_BUFFER,h);E.bufferData(E.ARRAY_BUFFER,glArrList[O].n,E.STATIC_DRAW)}b=k}w=f.length-1;for(O=0;O<=w;++O){E.bindBuffer(E.ARRAY_BUFFER,f[O].n);E.vertexAttribPointer(N.normalPosAttrib,3,E.FLOAT,false,0,0);E.bindBuffer(E.ARRAY_BUFFER,f[O].v);E.vertexAttribPointer(N.vertexPosAttrib,3,E.FLOAT,false,0,0);E.drawArrays(E.TRIANGLES,0,((O==w)?b:I)*3)}}function K(N,R){var h=N.length/9,Q=I,P,O,w,R;P=glArrList.length-1;if(k+h<=Q){glArrList[P].v.set(N,k*9);glArrList[P].n.set(R,k*9);k+=h}else{for(O=0;O<h;++O){for(w=0;w<9;++w){glArrList[P].v[k*9+w]=N[O*9+w]}k++;if(k==Q){k=0;glArrList.push({v:new Float32Array(I*9),n:new Float32Array(I*9)});P++}}}if(k==Q){k=0;glArrList.push({v:new Float32Array(I*9),n:new Float32Array(I*9)})}}function x(V,Z,T){var X,O,W,S,R,Q,P,N;for(R=0;R<V.length;++R){W=V[R];Q=W.length;for(S=0;S<Q-1;S++){dx=W[S][0]-W[(S+1)%Q][0];dy=W[S][1]-W[(S+1)%Q][1];r=Math.sqrt(dx*dx+dy*dy);dx/=r;dy/=r;K([W[S][0],W[S][1],Z,W[S+1][0],W[S+1][1],Z,W[S][0],W[S][1],T],[-dy,dx,0,-dy,dx,0,-dy,dx,0]);K([W[S][0],W[S][1],T,W[S+1][0],W[S+1][1],T,W[S+1][0],W[S+1][1],Z],[-dy,dx,0,-dy,dx,0,-dy,dx,0])}}if(V.length===1&&V[0].length<=5){W=V[0];if(W.length==4){K([W[0][0],W[0][1],T,W[1][0],W[1][1],T,W[2][0],W[2][1],T],[0,0,1,0,0,1,0,0,1])}else{K([W[0][0],W[0][1],T,W[1][0],W[1][1],T,W[2][0],W[2][1],T,W[0][0],W[0][1],T,W[2][0],W[2][1],T,W[3][0],W[3][1],T],[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])}return}var Y=[],U=[];W=V[0];Q=W.length-1;for(S=0;S<Q;S++){Y.push(new p2t.Point(W[S][0],W[S][1]))}var ab=new p2t.SweepContext(Y);for(R=1;R<V.length;++R){W=V[R];Q=W.length-1;var w=[];for(S=0;S<Q;S++){w.push(new p2t.Point(W[S][0],W[S][1]))}ab.AddHole(w)}p2t.sweep.Triangulate(ab);X=ab.GetTriangles();for(S=0;S<X.length;++S){var aa=[X[S].GetPoint(0),X[S].GetPoint(1),X[S].GetPoint(2)];K([aa[0].x,aa[0].y,T,aa[1].x,aa[1].y,T,aa[2].x,aa[2].y,T],[0,0,1,0,0,1,0,0,1])}}return{update:p,detectPointer:J,ref_z:function(){return u},zbuild:function(){return A},registerWebGLBuildingData:D,renderWebGLBuildingData:z}})();