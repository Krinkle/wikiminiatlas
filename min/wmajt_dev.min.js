var wmajt=(function(){var t=128,H=128,n=12,s=14,x={},d={},v={},B={},M=false,C=true,a,p,N,o,I,g,f,J,l,b,F=null,u=null,G={Polygon:[["natural",{ocean:1},[{fillStyle:"rgb(250,250,208)"},{lineWidth:1,strokeStyle:"rgb(125,125,104)"}]],["railway",{platform:1},[{fillStyle:"rgb(220,220,220)"}]],["landuse",{industrial:1,retail:1,commercial:1,residential:1},[{fillStyle:"rgb(208,208,208)"}]],["landuse",{reservoir:1},[{fillStyle:"rgb(200,200,224)"}]],["landuse",{military:1,railway:1},[{fillStyle:"rgb(224,200,200)"}]],["landuse",{cemetery:1,recreation_ground:1},[{fillStyle:"rgb(190,214,190)"}]],["landuse",{grass:1},[{globalAlpha:0.3,fillStyle:"rgb(0,160,0)"},{globalAlpha:1}]],["leisure",{park:1,orchard:1,meadow:1,village_green:1,golf_course:1,track:1,forrest:1,recreation_ground:1,dog_park:1,garden:1,pitch:1,stadium:1},[{fillStyle:"rgb(200,224,200)"}]],["waterway",{riverbank:1,dock:1},[{fillStyle:"rgb(158,199,243)"}]],["natural",{beach:1},[{fillStyle:"rgb(224,224,200)"}]],["natural",{wetland:1,mud:1},[{fillStyle:"rgb(200,218,224)"}]],["natural",{grassland:1,fell:1},[{fillStyle:"rgb(200,224,200)"}]],["natural",{scrub:1},[{fillStyle:"rgb(150,214,150)"}]],["natural",{wood:1},[{fillStyle:"rgb(100,204,100)"}]],["natural",{water:1,bay:1},[{fillStyle:"rgb(158,199,243)"},{lineWidth:1,strokeStyle:"rgb(158,199,243)"}]],["natural",{glacier:1},[{fillStyle:"rgb(230,245,255)"},{lineWidth:1,strokeStyle:"rgb(255,255,255)"}]],["amenity",{university:1},[{lineWidth:0.5,strokeStyle:"rgb(240,225,183)"}]],["amenity",{parking:1},[{fillStyle:"rgb(240,235,193)"}]],["highway",{pedestrian:1},[{fillStyle:"rgb(255,255,255)"},{lineWidth:2,strokeStyle:"rgb(168,148,148)"}]],["tourism",true,[{dash:[3,3],lineWidth:2,strokeStyle:"rgb(255,255,0)"}]],["aeroway",{terminal:1},[{fillStyle:"rgb(190,210,190)"},{lineWidth:1,strokeStyle:"rgb(127,137,127)"}]],["historic",{memorial:1,monument:1,fort:1,castle:1},[{fillStyle:"rgb(255,190,190)"},{lineWidth:1,strokeStyle:"rgb(167,120,120)"}]],["historic",{ship:1,wreck:1},[{fillStyle:"rgb(255,190,235)"}]],["railway",{station:1},[{fillStyle:"rgb(210,195,195)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["natural",{water:1,bay:1},[{fillStyle:"rgb(158,199,243)"},{lineWidth:1,strokeStyle:"rgb(158,199,243)"}]],["building",true,[{fillStyle:"rgb(200,200,200)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["building:part",true,[{fillStyle:"rgb(200,200,200)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["start_date",true,[{dash:[2,5],lineWidth:3,strokeStyle:"rgb(255,0,0)"}]]],LineString:[["waterway",{canal:1},[{lineCap:"butt",lineWidth:3,strokeStyle:"rgb(158,199,243)"}]],["waterway",{river:1},[{lineWidth:1.5,strokeStyle:"rgb(126,159,194)"}]],["waterway",{stream:1},[{dash:[2,2],lineWidth:1.5,strokeStyle:"rgb(126,159,194)"}]],["route",{ferry:1},[{dash:[4,4],lineWidth:2,strokeStyle:"rgb(126,159,194)"}]],["highway",{pedestrian:1},[{lineWidth:5,strokeStyle:"rgb(255,255,255)"}]],["highway",{footway:1,pedestrian:1,path:1},[{lineWidth:2,strokeStyle:"rgb(198,178,178)"}]],["highway",{steps:1},[{dash:[1.5,1.5],lineWidth:3,strokeStyle:"rgb(168,148,148)"}]],["highway",{service:1},[{lineWidth:4,strokeStyle:"rgb(168,168,168)"},{lineWidth:2.5,strokeStyle:"rgb(208,208,208)"}]],["highway",{track:1},[{lineWidth:3.5,strokeStyle:"rgb(168,168,168)"},{lineWidth:2.5,strokeStyle:"rgb(250,250,208)"}]],["highway",{residential:1,unclassified:1},[{lineWidth:4,strokeStyle:"rgb(200,200,200)"},{lineWidth:2.5,strokeStyle:"rgb(255,255,255)"}]],["highway",{tertiary:1},[{lineWidth:5,strokeStyle:"rgb(200,200,200)"},{lineWidth:3.5,strokeStyle:"rgb(255,255,235)"}]],["railway",{subway:1},[{globalAlpha:0.2,lineWidth:3,strokeStyle:"rgb(100,100,100)"},{globalAlpha:1}]],["railway",{rail:1,preserved:1,monorail:1,narrow_gauge:1},[{lineWidth:3,strokeStyle:"rgb(100,100,100)"}]],["highway",{secondary:1,secondary_link:1,primary:1,primary_link:1},[{lineCap:"round",lineWidth:6,strokeStyle:"rgb(171,158,137)"}]],["highway",{motorway:1,motorway_link:1,trunk:1,trunk_link:1},[{lineWidth:7,strokeStyle:"rgb(188,149,28)"}]],["aeroway",{runway:1},[{lineWidth:10,strokeStyle:"rgb(100,130,100)"}]],["aeroway",{taxiway:1},[{lineWidth:4.5,strokeStyle:"rgb(100,130,100)"}]],["railway",{subway:1},[{lineCap:"butt",globalAlpha:0.3,dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(255,255,255)"},{globalAlpha:1}]],["railway",{rail:1,narrow_gauge:1},[{dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(255,255,255)"}]],["railway",{preserved:1},[{dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(200,200,200)"}]],["railway",{monorail:1},[{dash:[1,2,4,2],lineWidth:1.5,strokeStyle:"rgb(200,200,200)"}]],["highway",{secondary:1,secondary_link:1},[{lineCap:"round",lineWidth:4.5,strokeStyle:"rgb(255,250,115)"}]],["highway",{primary:1,primary_link:1},[{lineWidth:4,strokeStyle:"rgb(255,230,95)"}]],["highway",{motorway:1,motorway_link:1,trunk:1,trunk_link:1},[{lineWidth:5,strokeStyle:"rgb(242,191,36)"}]],["aeroway",{runway:1},[{lineWidth:8,strokeStyle:"rgb(150,180,150)"}]],["aeroway",{taxiway:1},[{lineWidth:2.5,strokeStyle:"rgb(150,180,150)"}]],["railway",{tram:1},[{globalAlpha:0.4,dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(0,0,0)"},{globalAlpha:1}]],["access",{permissive:1},[{dash:[1,2],lineWidth:1,strokeStyle:"rgb(100,200,100)"}]],["access",{"private":1,residents:1},[{dash:[1,2],lineWidth:1,strokeStyle:"rgb(200,100,100)"}]],["building:part",true,[{lineWidth:1,strokeStyle:"rgb(127,127,255)"}]],["start_date",true,[{dash:[2,5],lineWidth:3,strokeStyle:"rgb(255,0,0)"}]]]};function e(O,h){var w=O.concat(h),Q=[],P={};for(i in w){if(w.hasOwnProperty(i)){if(!(w[i] in P)){P[w[i]]=true;Q.push(w[i])}}}return Q}function c(h,O,w){return h+"_"+O+"_"+w}function m(Q){if(Q===null){return}U=Q.data;var V,S={0:1},U,R,P;if(Q.v&&Q.v>=2){V=Q.idx}else{V={};for(R=0;R<U.length;++R){for(P in U[R].tags){if(P in V){V[P].push(R)}else{V[P]=[R]}}}}for(R=0;R<U.length;++R){if("layer" in U[R].tags){S[U[R].tags.layer]=1}}x[c(Q.x,Q.y,Q.z)]={data:Q.data,building:{},f:Q.f||{},idx:V,lay:S};var U=Q.data,w,h=Q.x,T=Q.y,O;if(Q.z>=s){for(w=Q.z;w>=n;w--){O=x[c(h,T,w)];if(w<s&&O&&O.data){for(R=0;R<U.length;++R){if("osm_id" in U[R].tags&&("building" in U[R].tags||"building:part" in U[R].tags)&&!(U[R].tags.osm_id in O.building)){for(P in U[R].tags){if(P in O.idx){O.idx[P].push(O.data.length)}else{O.idx[P]=[O.data.length]}}O.data.push(U[R]);O.building[U[R].tags.osm_id]=1}}}h=Math.floor(h/2);T=Math.floor(T/2)}}else{}q(this.csx,this.csy,this.csz,this)}function D(Q,T){if(u){if(Q.length>0){var W=(Q[0][0]-a)*128/I,U=128-(Q[0][1]-p)*128/g,aa,Z,S=0,R=u.length,Y=0,X,V,h,P,O,w;for(O=1;O<Q.length;++O){T.moveTo(W,U);P=-Y;aa=(Q[O][0]-a)*128/I;Z=128-(Q[O][1]-p)*128/g;X=aa-W;V=Z-U;h=Math.sqrt(X*X+V*V);X/=h;V/=h;w=false;while(true){P+=u[S];if(P>h){w=true;Y=P-h;P=h}T[S%2?"moveTo":"lineTo"](P*X+W,P*V+U);if(w){break}S=(S+1)%R}W=aa;U=Z}}}else{if(Q.length>0){T.moveTo((Q[0][0]-a)*128/I,128-(Q[0][1]-p)*128/g);for(O=1;O<Q.length;++O){T.lineTo((Q[O][0]-a)*128/I,128-(Q[O][1]-p)*128/g)}}}}function K(Q,R){var T=null,X={},h=R.div.offset(),V=Q.pageX-h.left,U=Q.pageY-h.top,S=R.csca.data||[],w,O,W,Z="";function P(ae,af,aa){var ac,ab,ad;for(j=1;j<ae.length;++j){ac=(ae[j][0]-a)*128/I-V;ab=128-(ae[j][1]-p)*128/g-U;ad=ac*ac+ab*ab;if((T===null||ad<T)&&("name" in aa.tags||"addr:street" in aa.tags)){T=ad;X=aa}}}a=R.csx*60/(1<<R.csz);p=90-(((R.csy+1)*60)/(1<<R.csz));N=(R.csx+1)*60/(1<<R.csz);o=90-((R.csy*60)/(1<<R.csz));I=N-a;g=o-p;if(a>180){a-=360}for(O=0;O<S.length;++O){w=S[O];z(w,"Polygon",null,P);if(w.geo.type=="GeometryCollection"){z(w,"Line",null,P)}}W=X.tags||{};if("name" in W){Z=W.name;if("loc_name" in W){Z+=' "'+W.loc_name+'"'}if("artist_name" in W){Z+=" ("+W.artist_name+")"}return Z}if("addr:street" in W){Z=W["addr:street"];if("addr:housenumber" in W){Z=W["addr:housenumber"]+" "+Z}return Z}var Y=["landuse","historic","highway","building"];for(O=0;O<Y.length;++O){if(Y[O] in W){return Y[O]+" "+W[Y[O]]}}return null}function z(h,P,S,R){var O,w,Q;switch(h.geo.type){case"Polygon":R(h.geo.coordinates[0],S,h);break;case"LineString":R(h.geo.coordinates,S,h);break;case"MultiLineString":for(O=0;O<h.geo.coordinates.length;O++){R(h.geo.coordinates[O],S,h)}break;case"MultiPolygon":for(O=0;O<h.geo.coordinates.length;O++){R(h.geo.coordinates[O][0],S,h)}break;case"GeometryCollection":Q=h.geo.geometries;for(w=0;w<Q.length;w++){if(P==="Polygon"){switch(Q[w].type){case"Polygon":R(Q[w].coordinates[0],S,h);break;case"MultiPolygon":for(O=0;O<Q[w].coordinates.length;O++){R(Q[w].coordinates[O][0],S,h)}break}}else{switch(Q[w].type){case"LineString":R(Q[w].coordinates,S,h);break;case"MultiLineString":for(O=0;O<Q[w].coordinates.length;O++){R(Q[w].coordinates[O],S,h)}break}}}break}}function q(W,V,U,Q,O){var T=Q.ctx;a=W*60/(1<<U);p=90-(((V+1)*60)/(1<<U));N=(W+1)*60/(1<<U);o=90-((V*60)/(1<<U));I=N-a;g=o-p;if(a>180){a-=360}function Z(ad){var af,ae,ac,ag,aj,aa,ah=ad.data,ab,ai;T.lineWidth=1;T.fillStyle="rgb(158,199,243)";T.fillRect(0,0,128,128);for(aj in G){for(aa=0;aa<G[aj].length;aa++){T.beginPath();if(!(G[aj][aa][0] in ad.idx)){continue}u=G[aj][aa][2][0].dash||null;ai=ad.idx[G[aj][aa][0]];for(af=0;af<ai.length;++af){ab=ah[ai[af]];if((aj!==ab.geo.type&&("Multi"+aj)!==ab.geo.type&&ab.geo.type!=="GeometryCollection")||!(G[aj][aa][1]===true||ab.tags[G[aj][aa][0]] in G[aj][aa][1])){continue}z(ab,aj,T,D)}ag=G[aj][aa][2];for(af=0;af<ag.length;af++){for(ae in ag[af]){if(ae!="dash"){T[ae]=ag[af][ae]}}if("strokeStyle" in ag[af]){T.stroke()}if("fillStyle" in ag[af]){T.fill()}}}}}Q.csx=W;Q.csy=V;Q.csz=U;var w,h=W,S=V,P,R,Y,X;for(w=U;w>=n;w--){P=x[c(h,S,w)];if(P&&P.data&&!O){if(Q.csca){R=Q.csca.data;if(M&&"start_date" in Q.csca.idx){X=Q.csca.idx.start_date;for(i=0;i<X.length;++i){Y=R[X[i]].tags.start_date;if(Y in d){d[Y]--;if(d[Y]==0){delete d[Y]}}}}if(C&&U>s){X=e(Q.csca.idx["building:levels"]||[],Q.csca.idx.height||[]);for(i=0;i<X.length;++i){if("osm_id" in R[X[i]].tags){Y=R[X[i]].tags.osm_id;if(Y in v){v[Y]--;if(v[Y]==0){delete v[Y]}}}}}}Z(P);Q.csca=P;R=P.data;if(M&&"start_date" in P.idx){X=P.idx.start_date;for(i=0;i<X.length;++i){Y=R[X[i]].tags.start_date;d[Y]=(d[Y]||0)+1}}if(C&&U>s){X=e(P.idx["building:levels"]||[],P.idx.height||[]);for(i=0;i<X.length;++i){if("osm_id" in R[X[i]].tags){Y=R[X[i]].tags.osm_id;v[Y]=(v[Y]||0)+1;if(!(Y in B)){B[Y]=R[X[i]]}}}}if(F!==null){X=e(P.idx["building:levels"]||[],P.idx.height||[]);for(i=0;i<X.length;++i){if("osm_id" in R[X[i]].tags){Y=R[X[i]].tags.osm_id;if(!(Y in v)){v[Y]=true;Y=R[X[i]];if(Y.geo.type==="Polygon"){y(Y.geo.coordinates,(Y.tags["building:min_level"]*3)||Y.tags.min_height||0,(Y.tags["building:levels"]*3)||Y.tags.height)}}}}}Q.can.show();if(U<s||w>=s){return}}h=Math.floor(h/2);S=Math.floor(S/2)}Q.debug.html("tiles/jsontile.php?x="+W+"&y="+V+"&z="+U);$.ajax({url:"tiles/jsontile.php?x="+W+"&y="+V+"&z="+U+(O===true?"&action=purge":""),dataType:"json",success:m,context:Q})}function E(h,O){glArrList=[];f=[];J=h;F=O;var P,w;l=0;b=0;P=new Float32Array(J*9);w=new Float32Array(J*9);glArrList.push({v:P,n:w});C=false}function A(O){var P,w,R,h,Q;if(glArrList.length>f.length||l>b){Q=f.length-1;Q=Q<0?0:Q;for(P=Q;P<glArrList.length;++P){if(P>=f.length){R=F.createBuffer();h=F.createBuffer();f.push({v:R,n:h})}else{R=f[P].v;h=f[P].n}F.bindBuffer(F.ARRAY_BUFFER,R);F.bufferData(F.ARRAY_BUFFER,glArrList[P].v,F.STATIC_DRAW);F.bindBuffer(F.ARRAY_BUFFER,h);F.bufferData(F.ARRAY_BUFFER,glArrList[P].n,F.STATIC_DRAW)}b=l}w=f.length-1;for(P=0;P<=w;++P){F.bindBuffer(F.ARRAY_BUFFER,f[P].n);F.vertexAttribPointer(O.normalPosAttrib,3,F.FLOAT,false,0,0);F.bindBuffer(F.ARRAY_BUFFER,f[P].v);F.vertexAttribPointer(O.vertexPosAttrib,3,F.FLOAT,false,0,0);F.drawArrays(F.TRIANGLES,0,((P==w)?b:J)*3)}}function L(O,S){var h=O.length/9,R=J,Q,P,w,S;Q=glArrList.length-1;if(l+h<=R){glArrList[Q].v.set(O,l*9);glArrList[Q].n.set(S,l*9);l+=h}else{for(P=0;P<h;++P){for(w=0;w<9;++w){glArrList[Q].v[l*9+w]=O[P*9+w]}l++;if(l==R){l=0;glArrList.push({v:new Float32Array(J*9),n:new Float32Array(J*9)});Q++}}}if(l==R){l=0;glArrList.push({v:new Float32Array(J*9),n:new Float32Array(J*9)})}}function y(Y,ab,W){var ac=[],Q=[],P,Z,V,U,S,R,O;for(U=0;U<Y.length;++U){Z=Y[U];S=Z.length;for(V=0;V<S-1;V++){dx=Z[V][0]-Z[(V+1)%S][0];dy=Z[V][1]-Z[(V+1)%S][1];r=Math.sqrt(dx*dx+dy*dy);dx/=r;dy/=r;L([Z[V][0],Z[V][1],ab,Z[V+1][0],Z[V+1][1],ab,Z[V][0],Z[V][1],W],[-dy,dx,0,-dy,dx,0,-dy,dx,0]);L([Z[V][0],Z[V][1],W,Z[V+1][0],Z[V+1][1],W,Z[V+1][0],Z[V+1][1],ab],[-dy,dx,0,-dy,dx,0,-dy,dx,0])}}if(Y.length===1&&Y[0].length<=5){Z=Y[0];if(Z.length==4){L([Z[0][0],Z[0][1],W,Z[1][0],Z[1][1],W,Z[2][0],Z[2][1],W],[0,0,1,0,0,1,0,0,1])}else{L([Z[0][0],Z[0][1],W,Z[1][0],Z[1][1],W,Z[2][0],Z[2][1],W,Z[0][0],Z[0][1],W,Z[2][0],Z[2][1],W,Z[3][0],Z[3][1],W],[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])}return}for(U=0;U<Y.length;++U){Z=Y[U];S=Z.length-1;O=0;for(V=0;V<S-1;V++){O+=(Z[V][0]*Z[V+1][1])-(Z[V+1][0]*Z[V][1])}if(U==0){if(O>0){Z.reverse()}}else{if(O<0){Z.reverse()}}}if(Y.length>1){var w=[];P=Y[0].concat();for(U=1;U<Y.length-1;++U){var X=Y[U];for(V=0;V<P.length-1;++V){for(k=0;k<X.length;++k){}}}}else{function aa(ah,af){var ad=ah[af][0]-ah[0][0],ag=ah[af][1]-ah[0][1],h=ah[af+1][0]-ah[0][0],ae=ah[af+1][1]-ah[0][1];return(ad*ae-ag*h)>0}Z=Y[0];S=Z.length;U=0;O=aa(Z,1),R=true;for(V=2;V<S-2;++V){if(aa(Z,V)!=O){R=false;break}}if(R){for(V=1;V<S-2;++V){L([Z[0][0],Z[0][1],W,Z[V][0],Z[V][1],W,Z[V+1][0],Z[V+1][1],W],[0,0,1,0,0,1,0,0,1])}return ac}P=Y[0].concat()}function T(ai){var h,ae,ad,ag,af;while((h=ai.length-1)>=3){for(V=0;V<h;++V){ae=ai[(V+1)%h][0]-ai[V][0];ad=ai[(V+2)%h][0]-ai[V][0];ag=ai[(V+1)%h][1]-ai[V][1];af=ai[(V+2)%h][1]-ai[V][1];if(ae*af-ad*ag>0){continue}L([ai[V][0],ai[V][1],W,ai[(V+1)%h][0],ai[(V+1)%h][1],W,ai[(V+2)%h][0],ai[(V+2)%h][1],W],[0,0,1,0,0,1,0,0,1]);ai.splice((V+1)%h,1);break;ae=Math.min(ai[V][0],Math.min(ai[(V+1)%h][0],ai[(V+2)%h][0]));ag=Math.min(ai[V][1],Math.min(ai[(V+1)%h][1],ai[(V+2)%h][1]));ad=Math.max(ai[V][0],Math.max(ai[(V+1)%h][0],ai[(V+2)%h][0]));af=Math.max(ai[V][1],Math.max(ai[(V+1)%h][1],ai[(V+2)%h][1]));var ah=false;for(U=3;U<h;++U){if(ai[(V+U)%h][0]<ae||ai[(V+U)%h][0]>ad||ai[(V+U)%h][1]<ag||ai[(V+U)%h][1]>af){continue}}if(ah){continue}}}}}return{update:q,detectPointer:K,ref_z:function(){return v},zbuild:function(){return B},registerWebGLBuildingData:E,renderWebGLBuildingData:A}})();