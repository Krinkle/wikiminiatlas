var wmajt=(function(){var n=128,u=128,f=12,m=14,q={},b={},p={},s={},a,k,z,g,x,d,o=null,v={Polygon:[["natural",{ocean:1},[{fillStyle:"rgb(250,250,208)"},{lineWidth:1,strokeStyle:"rgb(125,125,104)"}]],["railway",{platform:1},[{fillStyle:"rgb(220,220,220)"}]],["landuse",{industrial:1,retail:1,commercial:1,residential:1},[{fillStyle:"rgb(208,208,208)"}]],["landuse",{reservoir:1},[{fillStyle:"rgb(200,200,224)"}]],["landuse",{military:1,railway:1},[{fillStyle:"rgb(224,200,200)"}]],["landuse",{cemetery:1,recreation_ground:1},[{fillStyle:"rgb(190,214,190)"}]],["landuse",{grass:1},[{globalAlpha:0.3,fillStyle:"rgb(0,160,0)"},{globalAlpha:1}]],["leisure",{park:1,orchard:1,meadow:1,village_green:1,golf_course:1,track:1,forrest:1,recreation_ground:1,dog_park:1,garden:1,pitch:1,stadium:1},[{fillStyle:"rgb(200,224,200)"}]],["waterway",{riverbank:1,dock:1},[{fillStyle:"rgb(158,199,243)"}]],["natural",{beach:1},[{fillStyle:"rgb(224,224,200)"}]],["natural",{wetland:1,mud:1},[{fillStyle:"rgb(200,218,224)"}]],["natural",{grassland:1,fell:1},[{fillStyle:"rgb(200,224,200)"}]],["natural",{scrub:1},[{fillStyle:"rgb(150,214,150)"}]],["natural",{wood:1},[{fillStyle:"rgb(100,204,100)"}]],["natural",{water:1,bay:1},[{fillStyle:"rgb(158,199,243)"},{lineWidth:1,strokeStyle:"rgb(158,199,243)"}]],["natural",{glacier:1},[{fillStyle:"rgb(230,245,255)"},{lineWidth:1,strokeStyle:"rgb(255,255,255)"}]],["amenity",{university:1},[{lineWidth:0.5,strokeStyle:"rgb(240,225,183)"}]],["amenity",{parking:1},[{fillStyle:"rgb(240,235,193)"}]],["highway",{pedestrian:1},[{fillStyle:"rgb(255,255,255)"},{lineWidth:2,strokeStyle:"rgb(168,148,148)"}]],["tourism",true,[{dash:[3,3],lineWidth:2,strokeStyle:"rgb(255,255,0)"}]],["aeroway",{terminal:1},[{fillStyle:"rgb(190,210,190)"},{lineWidth:1,strokeStyle:"rgb(127,137,127)"}]],["historic",{memorial:1,monument:1,fort:1,castle:1},[{fillStyle:"rgb(255,190,190)"},{lineWidth:1,strokeStyle:"rgb(167,120,120)"}]],["historic",{ship:1,wreck:1},[{fillStyle:"rgb(255,190,235)"}]],["railway",{station:1},[{fillStyle:"rgb(210,195,195)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["natural",{water:1,bay:1},[{fillStyle:"rgb(158,199,243)"},{lineWidth:1,strokeStyle:"rgb(158,199,243)"}]],["building",true,[{fillStyle:"rgb(200,200,200)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["building:part",true,[{fillStyle:"rgb(200,200,200)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["start_date",true,[{dash:[2,5],lineWidth:3,strokeStyle:"rgb(255,0,0)"}]]],LineString:[["waterway",{canal:1},[{lineCap:"butt",lineWidth:3,strokeStyle:"rgb(158,199,243)"}]],["waterway",{river:1},[{lineWidth:1.5,strokeStyle:"rgb(126,159,194)"}]],["waterway",{stream:1},[{dash:[2,2],lineWidth:1.5,strokeStyle:"rgb(126,159,194)"}]],["route",{ferry:1},[{dash:[4,4],lineWidth:2,strokeStyle:"rgb(126,159,194)"}]],["highway",{pedestrian:1},[{lineWidth:5,strokeStyle:"rgb(255,255,255)"}]],["highway",{footway:1,pedestrian:1,path:1},[{lineWidth:2,strokeStyle:"rgb(198,178,178)"}]],["highway",{steps:1},[{dash:[1.5,1.5],lineWidth:3,strokeStyle:"rgb(168,148,148)"}]],["highway",{service:1},[{lineWidth:4,strokeStyle:"rgb(168,168,168)"},{lineWidth:2.5,strokeStyle:"rgb(208,208,208)"}]],["highway",{track:1},[{lineWidth:3.5,strokeStyle:"rgb(168,168,168)"},{lineWidth:2.5,strokeStyle:"rgb(250,250,208)"}]],["highway",{residential:1,unclassified:1},[{lineWidth:4,strokeStyle:"rgb(200,200,200)"},{lineWidth:2.5,strokeStyle:"rgb(255,255,255)"}]],["highway",{tertiary:1},[{lineWidth:5,strokeStyle:"rgb(200,200,200)"},{lineWidth:3.5,strokeStyle:"rgb(255,255,235)"}]],["railway",{subway:1},[{globalAlpha:0.2,lineWidth:3,strokeStyle:"rgb(100,100,100)"},{globalAlpha:1}]],["railway",{rail:1,preserved:1,monorail:1,narrow_gauge:1},[{lineWidth:3,strokeStyle:"rgb(100,100,100)"}]],["highway",{secondary:1,secondary_link:1,primary:1,primary_link:1},[{lineCap:"round",lineWidth:6,strokeStyle:"rgb(171,158,137)"}]],["highway",{motorway:1,motorway_link:1,trunk:1,trunk_link:1},[{lineWidth:7,strokeStyle:"rgb(188,149,28)"}]],["aeroway",{runway:1},[{lineWidth:10,strokeStyle:"rgb(100,130,100)"}]],["aeroway",{taxiway:1},[{lineWidth:4.5,strokeStyle:"rgb(100,130,100)"}]],["railway",{subway:1},[{lineCap:"butt",globalAlpha:0.3,dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(255,255,255)"},{globalAlpha:1}]],["railway",{rail:1,narrow_gauge:1},[{dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(255,255,255)"}]],["railway",{preserved:1},[{dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(200,200,200)"}]],["railway",{monorail:1},[{dash:[1,2,4,2],lineWidth:1.5,strokeStyle:"rgb(200,200,200)"}]],["highway",{secondary:1,secondary_link:1},[{lineCap:"round",lineWidth:4.5,strokeStyle:"rgb(255,250,115)"}]],["highway",{primary:1,primary_link:1},[{lineWidth:4,strokeStyle:"rgb(255,230,95)"}]],["highway",{motorway:1,motorway_link:1,trunk:1,trunk_link:1},[{lineWidth:5,strokeStyle:"rgb(242,191,36)"}]],["aeroway",{runway:1},[{lineWidth:8,strokeStyle:"rgb(150,180,150)"}]],["aeroway",{taxiway:1},[{lineWidth:2.5,strokeStyle:"rgb(150,180,150)"}]],["railway",{tram:1},[{globalAlpha:0.4,dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(0,0,0)"},{globalAlpha:1}]],["access",{permissive:1},[{dash:[1,2],lineWidth:1,strokeStyle:"rgb(100,200,100)"}]],["access",{"private":1,residents:1},[{dash:[1,2],lineWidth:1,strokeStyle:"rgb(200,100,100)"}]],["building:part",true,[{lineWidth:1,strokeStyle:"rgb(127,127,255)"}]],["start_date",true,[{dash:[2,5],lineWidth:3,strokeStyle:"rgb(255,0,0)"}]]]};function c(h,A,w){return h+"_"+A+"_"+w}function e(C){if(C===null){return}G=C.data;var H,E={0:1},G,D,B;if(C.v&&C.v>=2){H=C.idx}else{H={};for(D=0;D<G.length;++D){for(B in G[D].tags){if(B in H){H[B].push(D)}else{H[B]=[D]}}}}for(D=0;D<G.length;++D){if("layer" in G[D].tags){E[G[D].tags.layer]=1}}q[c(C.x,C.y,C.z)]={data:C.data,building:{},f:C.f||{},idx:H,lay:E};var G=C.data,w,h=C.x,F=C.y,A;if(C.z>=m){for(w=C.z;w>=f;w--){A=q[c(h,F,w)];if(w<m&&A&&A.data){for(D=0;D<G.length;++D){if("osm_id" in G[D].tags&&("building" in G[D].tags||"building:part" in G[D].tags)&&!(G[D].tags.osm_id in A.building)){for(B in G[D].tags){if(B in A.idx){A.idx[B].push(A.data.length)}else{A.idx[B]=[A.data.length]}}A.data.push(G[D]);A.building[G[D].tags.osm_id]=1}}}h=Math.floor(h/2);F=Math.floor(F/2)}}else{}l(this.csx,this.csy,this.csz,this)}function t(C,F){if(o){if(C.length>0){var I=(C[0][0]-a)*128/x,G=128-(C[0][1]-k)*128/d,M,L,E=0,D=o.length,K=0,J,H,h,B,A,w;for(A=1;A<C.length;++A){F.moveTo(I,G);B=-K;M=(C[A][0]-a)*128/x;L=128-(C[A][1]-k)*128/d;J=M-I;H=L-G;h=Math.sqrt(J*J+H*H);J/=h;H/=h;w=false;while(true){B+=o[E];if(B>h){w=true;K=B-h;B=h}F[E%2?"moveTo":"lineTo"](B*J+I,B*H+G);if(w){break}E=(E+1)%D}I=M;G=L}}}else{if(C.length>0){F.moveTo((C[0][0]-a)*128/x,128-(C[0][1]-k)*128/d);for(A=1;A<C.length;++A){F.lineTo((C[A][0]-a)*128/x,128-(C[A][1]-k)*128/d)}}}}function y(C,D){var F=null,J={},h=D.div.offset(),H=C.pageX-h.left,G=C.pageY-h.top,E=D.csca.data||[],w,A,I,L="";function B(Q,R,M){var O,N,P;for(j=1;j<Q.length;++j){O=(Q[j][0]-a)*128/x-H;N=128-(Q[j][1]-k)*128/d-G;P=O*O+N*N;if((F===null||P<F)&&("name" in M.tags||"addr:street" in M.tags)){F=P;J=M}}}a=D.csx*60/(1<<D.csz);k=90-(((D.csy+1)*60)/(1<<D.csz));z=(D.csx+1)*60/(1<<D.csz);g=90-((D.csy*60)/(1<<D.csz));x=z-a;d=g-k;if(a>180){a-=360}for(A=0;A<E.length;++A){w=E[A];r(w,"Polygon",null,B);if(w.geo.type=="GeometryCollection"){r(w,"Line",null,B)}}I=J.tags||{};if("name" in I){L=I.name;if("loc_name" in I){L+=' "'+I.loc_name+'"'}if("artist_name" in I){L+=" ("+I.artist_name+")"}return L}if("addr:street" in I){L=I["addr:street"];if("addr:housenumber" in I){L=I["addr:housenumber"]+" "+L}return L}var K=["landuse","historic","highway","building"];for(A=0;A<K.length;++A){if(K[A] in I){return K[A]+" "+I[K[A]]}}return null}function r(h,B,E,D){var A,w,C;switch(h.geo.type){case"Polygon":D(h.geo.coordinates[0],E,h);break;case"LineString":D(h.geo.coordinates,E,h);break;case"MultiLineString":for(A=0;A<h.geo.coordinates.length;A++){D(h.geo.coordinates[A],E,h)}break;case"MultiPolygon":for(A=0;A<h.geo.coordinates.length;A++){D(h.geo.coordinates[A][0],E,h)}break;case"GeometryCollection":C=h.geo.geometries;for(w=0;w<C.length;w++){if(B==="Polygon"){switch(C[w].type){case"Polygon":D(C[w].coordinates[0],E,h);break;case"MultiPolygon":for(A=0;A<C[w].coordinates.length;A++){D(C[w].coordinates[A][0],E,h)}break}}else{switch(C[w].type){case"LineString":D(C[w].coordinates,E,h);break;case"MultiLineString":for(A=0;A<C[w].coordinates.length;A++){D(C[w].coordinates[A],E,h)}break}}}break}}function l(J,H,G,C,A){var F=C.ctx;a=J*60/(1<<G);k=90-(((H+1)*60)/(1<<G));z=(J+1)*60/(1<<G);g=90-((H*60)/(1<<G));x=z-a;d=g-k;if(a>180){a-=360}function M(Q){var S,R,P,T,W,N,U=Q.data,O,V;F.lineWidth=1;F.fillStyle="rgb(158,199,243)";F.fillRect(0,0,128,128);for(W in v){for(N=0;N<v[W].length;N++){F.beginPath();if(!(v[W][N][0] in Q.idx)){continue}o=v[W][N][2][0].dash||null;V=Q.idx[v[W][N][0]];for(S=0;S<V.length;++S){O=U[V[S]];if((W!==O.geo.type&&("Multi"+W)!==O.geo.type&&O.geo.type!=="GeometryCollection")||!(v[W][N][1]===true||O.tags[v[W][N][0]] in v[W][N][1])){continue}r(O,W,F,t)}T=v[W][N][2];for(S=0;S<T.length;S++){for(R in T[S]){if(R!="dash"){F[R]=T[S][R]}}if("strokeStyle" in T[S]){F.stroke()}if("fillStyle" in T[S]){F.fill()}}}}}C.csx=J;C.csy=H;C.csz=G;var w,h=J,E=H,B,D,L,K,I=false;for(w=G;w>=f;w--){B=q[c(h,E,w)];if(B&&B.data&&!A){if(C.csca){D=C.csca.data;if(I&&"start_date" in C.csca.idx){K=C.csca.idx.start_date;for(i=0;i<K.length;++i){L=D[K[i]].tags.start_date;if(L in b){b[L]--;if(b[L]==0){delete b[L]}}}}if(G>m){K=_.union(C.csca.idx["building:levels"]||[],C.csca.idx.height||[]);for(i=0;i<K.length;++i){if("osm_id" in D[K[i]].tags){L=D[K[i]].tags.osm_id;if(L in p){p[L]--;if(p[L]==0){delete p[L]}}}}}}M(B);C.csca=B;D=B.data;if(I&&"start_date" in B.idx){K=B.idx.start_date;for(i=0;i<K.length;++i){L=D[K[i]].tags.start_date;b[L]=(b[L]||0)+1}}if(G>m){K=_.union(B.idx["building:levels"]||[],B.idx.height||[]);for(i=0;i<K.length;++i){if("osm_id" in D[K[i]].tags){L=D[K[i]].tags.osm_id;p[L]=(p[L]||0)+1;if(!(L in s)){s[L]=D[K[i]]}}}}C.can.show();if(G<m||w>=m){return}}h=Math.floor(h/2);E=Math.floor(E/2)}C.debug.html("tiles/jsontile.php?x="+J+"&y="+H+"&z="+G);$.ajax({url:"tiles/jsontile.php?x="+J+"&y="+H+"&z="+G+(A===true?"&action=purge":""),dataType:"json",success:e,context:C})}return{update:l,detectPointer:y,ref_z:function(){return p},zbuild:function(){return s}}})();