var wma_highzoom_activated=true;var wma_highzoom_purge=false;var wma_bldg3dzoom=14;var bldg3d=null,bldg3dc=null,bldg3dtimer=null;var update3dBuildings;var credit;var wmaNews=[];var wma_imgbase="tiles/";var wma_database="label.php";var wma_tilebase=".www.toolserver.org/~dschwen/wma/tiles/";var wma_maxlabel=13;var i,wma_zoomsize=[3];for(i=1;i<40;i++){wma_zoomsize[i]=2*wma_zoomsize[i-1]}var lc={};var wma_tilesets=[{name:"mapFull",globe:"Earth",credit:' / Map data Â© <a href="http://www.openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://www.opendatacommons.org/licenses/odbl">License</a>',getTileURL:function(d,a,c,b){me=wma_tilesets[0];if(b||document.location.protocol=="https:"){if(c>=7){return wma_imgbase+"mapnik/"+c+"/"+d+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}else{return wma_imgbase+"mapnik/"+c+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}}else{if(c>=7){return"//"+((a+d)%16)+wma_tilebase+"mapnik/"+c+"/"+d+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}else{return"//"+((a+d)%16)+wma_tilebase+"mapnik/"+c+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}}},linkcolor:["#2255aa","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:40075,maxzoom:20,minzoom:0},{name:"mapPhysical",globe:"Earth",getTileURL:function(c,a,b){return wma_imgbase+"relief/"+b+"/"+c+"_"+(a%(wma_zoomsize[b]*2))+".png"},linkcolor:["#2255aa","white 0pt 0pt 2pt"],equator:40075,maxzoom:5,minzoom:0},{name:"mapLandsat",globe:"Earth",getTileURL:function(e,a,d,c){var b=a%(wma_zoomsize[d]*2);if(b<0){b+=(wma_zoomsize[d]*2)}if(c||document.location.protocol=="https:"){return wma_imgbase+"mapnik/sat/"+d+"/"+e+"/"+e+"_"+(b%(wma_zoomsize[d]*2))+".png"}else{return"//"+((b+e)%8)+wma_tilebase+"mapnik/sat/"+d+"/"+e+"/"+e+"_"+(b%(wma_zoomsize[d]*2))+".png"}},linkcolor:["white","black 0pt 0pt 2pt"],equator:40075,maxzoom:13,minzoom:0},{name:"mapCoastline",globe:"Earth",getTileURL:function(c,a,b){return wma_imgbase+"plain/"+b+"/tile_"+c+"_"+(a%(wma_zoomsize[b]*2))+".png"},linkcolor:["#2255aa","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:40075,maxzoom:7,minzoom:0},{name:"mapPhysical",globe:"Moon",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"lro_moon/lromoon_"+("00"+(5-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:10940.475,maxzoom:5,minzoom:0},{name:"mapLandsat",globe:"Moon",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"moon/"+c+"/"+d+"_"+b+".jpg"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:10940.475,maxzoom:7,minzoom:0},{name:"mapLandsat",globe:"Mars",getTileURL:function(d,a,c){var b=(a+wma_zoomsize[c])%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"mars/mars_"+("00"+(5-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["white","black 0pt 0pt 2pt"],equator:21359.975,maxzoom:5,minzoom:0},{name:"mapPhysical",globe:"Venus",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"venus/venus_"+("00"+(3-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:38024.6,maxzoom:3,minzoom:0},{name:"mapLandsat",globe:"Mercury",getTileURL:function(e,a,d){var b=(a+1*wma_zoomsize[d])%(wma_zoomsize[d]*2);if(b<0){b+=(wma_zoomsize[d]*2)}var c=6-d;return wma_imgbase+"mercury/"+((c<3)?(c+"/"):"")+((c==0)?(Math.floor(b/100)+"/"):"")+"merc_"+("00"+c)+"_"+("000"+b).substr(-3)+"_"+("000"+e).substr(-3)+".png"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black,0px 1px 2px black,-1px 0px 2px black"],equator:15329.1,maxzoom:6,minzoom:0},{name:"mapLandsat",globe:"Io",getTileURL:function(d,a,c){var b=(a+wma_zoomsize[c])%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"io/io_"+("00"+(4-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:11443.6,maxzoom:4,minzoom:0},{name:"mapLandsat",globe:"Titan",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"titan/titan_"+("00"+(3-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white,0px 1px 2px white,-1px 0px 2px white"],equator:16190.3,maxzoom:3,minzoom:0}];function parseParams(a){var d={},c,b,e=a.substr(a.indexOf("?")+1).split("&");for(b=0;b<e.length;++b){c=e[b].split("=");d[c[0]]=c[1]}return d}function isRTL(a){return($.inArray(a,["ar","he","fa"])>=0)}function wikiminiatlasInstall(ac,ai){var M="";var aU=500;var af=300;var B=null;var n=false;var v;var u;var l;var aj=[];var Q=null;var K={x:-1,y:-1};var D=0;var C=0;var X=1;var U=0;var N={obj:null,lat:0,lon:0};var H=[];var au=true;var t=null;var z=null;var G=false;var aH=false;var aO="de";var at="";var e="en";var aP=false;var az=0;var p=128,o=128;var x=null;var c=null;var Y=null;var f=null;var ah=null;var am=null;var ay={shown:false,panel:null,image:null,link:null};ai=ai||parseParams(window.location.href);var aN={},aQ={shown:false,drawn:false,canvas:null,c:null,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity};var aT={};var aB=false;var aE=null;var aa="HTMLCanvasElement" in window;var y,h=null;function aR(){var a4;var a1=ai.wma||(window.location.search).substr(1),a5=ai.page,aX=ai.lang,aV="";Y=ai.globe||"Earth";if(a5&&aa){$.ajax({url:"//toolserver.org/~master/osmjson/getGeoJSON.php?lang="+aX+"&article="+a5,dataType:"json",success:a})}$.getScript("/~para/geoip.fcgi",function(){});aE=(function(){if(!aa){return function(){}}var bb=$("<canvas></canvas>").attr({width:6*128*4/3,height:3*128*4/3}).css({display:"none"}),a8=$("<canvas></canvas>").attr({width:6*128,height:3*128}).css({display:"none"}),ba=$("<canvas></canvas>").attr({width:6*128,height:3*128}).css({display:"none"}),bd=$("<div></div>").css({position:"absolute",width:"80px",height:"80px",bottom:"20px",right:"5px",zIndex:50,display:"none",borderRadius:"40px","-moz-border-radius":"40px",boxShadow:"5px 5px 25px rgba(0,0,0,0.3)"}),bc=$("<canvas></canvas>").attr({width:160,height:160}).css({position:"absolute",width:"80px",height:"80px",bottom:"20px",right:"5px",zIndex:51,display:"none"});function a9(){var bh,bg,bf=0,bi=a8[0].getContext("2d"),be=bb[0].getContext("2d");bi.clearRect(0,0,6*128,3*128);for(bh=0;bh<6;++bh){for(bg=0;bg<3;++bg){(function(bj,bl){var bk=new Image;$(bk).load(function(){bi.drawImage(bk,bj*128,bl*128);bf++;if(bf==3*6){be.drawImage(a8[0],0,0,6*128*4/3,3*128*4/3);if(!aB){aB=wmaGlobe3d(bc[0],bb[0]);if(!aB){return}aB.setLatLon(N.lat,N.lon);bd.fadeIn(200);bc.fadeIn(200);aB.mapContext=be;aB.tmap=a8[0];aB.tmapContext=bi;aB.omap=ba[0];aB.omapContext=ba[0].getContext("2d");aB.updateTiles=function(){aB.mapContext.clearRect(0,0,6*128*4/3,3*128*4/3);aB.mapContext.drawImage(aB.tmap,0,0,6*128*4/3,3*128*4/3);aB.updateTexture();aB.draw()};aB.updateKML=function(){aB.mapContext.clearRect(0,0,6*128*4/3,3*128*4/3);aB.mapContext.drawImage(aB.tmap,0,0,6*128*4/3,3*128*4/3);aB.mapContext.save();aB.mapContext.globalAlpha=0.5;ad(3*128,0,0,6*128,3*128,aB.omapContext);aB.mapContext.drawImage(aB.omap,0,0,6*128*4/3,3*128*4/3);aB.mapContext.restore();aB.updateTexture();aB.draw()}}if(aQ.canvas){aB.updateKML()}else{aB.updateTiles()}}}).attr("src",wma_tilesets[az].getTileURL(bl,bj,0,true))})(bh,bg)}}}$("body").append(bc).append(bb).append(bd);return a9})();var aW=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)/;if(aW.test(a1)){aW.exec(a1);N.lat=parseFloat(RegExp.$1);N.lon=parseFloat(RegExp.$2);aU=$(window).width();af=$(window).height();aW=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)/;if(aW.test(a1)){aW.exec(a1);at=RegExp.$5}aW=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)/;if(aW.test(a1)){aW.exec(a1);U=parseInt(RegExp.$6,10);aq(U);aq(Math.min(X,(az!=0?wma_tilesets[az].maxzoom:((aa&&wma_highzoom_activated)?15:12))));aq(Math.max(X,wma_tilesets[az].minzoom))}aW=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)_([a-z]+)/;if(aW.test(a1)){aW.exec(a1);aO=RegExp.$7}else{aO=at}aW=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z]+)_([\d]+)_([a-z]+)_([\d+-.]+)_([\d+-.]+)/;if(aW.test(a1)){a4=P(RegExp.$8,RegExp.$9);au=false;n=true}else{a4=P(N.lat,N.lon);au=true}D=a4.x-aU/2;C=a4.y-af/2}e=aO;if(e=="co"||e=="commons"){e="en"}aP=isRTL(e);wmajt.setUILang(e);for(a2 in strings){if(!strings[a2][e]){strings[a2][e]=strings[a2].en}}a7='<div class="bsprite" id="button_plus" title="'+strings.zoomIn[e]+'"></div><div class="bsprite" id="button_minus" title="'+strings.zoomOut[e]+'"></div><div class="bsprite" id="button_target" title="'+strings.center[e]+'"></div><div class="bsprite" id="button_kml" title="'+strings.kml[e]+'"></div><div class="bsprite" id="button_menu" title="'+strings.settings[e]+'"></div>';if(n){a7+='<img id="button_hide" src="'+wma_imgbase+'button_hide.png" title="'+strings.close[e]+'" onclick="window.close()">'}else{a7+='<img id="button_fs" src="'+wma_imgbase+'button_fs.png" title="'+strings.fullscreen[e]+'">'}a7+='<div id="wma_map" style="position:absolute; width:'+aU+"px; height:"+af+'px; cursor: move; background-color: #aaaaaa;"></div>';a7+='<div id="scalebox"><div id="scalebar"></div><div id="scalelabel">null</div></div>';a7+='<div id="synopsis"><p id="synopsistext"></p></div>';a7+='<div id="wma_settings"><h4>'+strings.settings[e]+'</h4><p class="option">Size Comparison <select id="wmaSetSizeOverlay">';aZ=strings.sover[e].list;a7+='<option value="-" class="bg" selected="selected">-</option>';a7+='<option value="+" class="bg">'+strings.other[e]+"</option>";a7+='<option value="*" class="bg">'+decodeURIComponent(a5)+"</option>";for(a2 in aZ){a7+='<option value="'+aZ[a2]+'">'+aZ[a2]+"</option>"}a7+='</select></p><a href="//wiki.toolserver.org/" target="_top"><img src="//toolserver.org/images/wikimedia-toolserver-button.png" border="0"></a></div>';ac.html(a7).append($("<span></span>",{id:"wmacredit"}).append($("<a></a>",{href:"//meta.wikimedia.org/wiki/WikiMiniAtlas/"+aO,target:"_top"}).text("WikiMiniAtlas")).append(credit=$("<span></span>")));var aY=new wmaMenu(aP);(function(){var bb,ba,a9=[],bc;aY.addTitle(strings.labelSet[e],aP);a7='<select id="wmaLabelSet">';for(bb in wikiminiatlas_sites){if(bb!=="commons"){a7+='<option value="'+bb+'"';if(bb==at){a7+='selected="selected"'}a7+=">"+wikiminiatlas_sites[bb]+"</option>"}}a7+="</select>";bc=aY.addGroup([["LANG",a7],["commons",strings.commons[e]]],function(be){if(be=="LANG"){be=bc.items.LANG.find("select option:selected").val()}aA(be)},at=="commons"?"commons":"LANG",aP);bc.items.LANG.find("select").click(function(be){be.stopPropagation()}).change(function(be){bc.items.LANG.click()});aY.addSep();var bd={};for(bb=0;bb<wma_tilesets.length;bb++){ba=wma_tilesets[bb].globe;bd[ba]=bd[ba]||[];bd[ba].push([bb,strings[wma_tilesets[bb].name][e]||""])}a7='<select id="wmaGlobeSet">';for(bb in bd){a7+='<option value="'+bb+'"';if(bb==Y){a7+='selected="selected"'}a7+=">"+strings["map"+bb][e]+"</option>"}a7+="</select>";aY.addTitle(strings.solarSystem[e],aP);var a8=aY.addItem(a7,undefined,aP);a8.find("select").click(function(be){be.stopPropagation()}).change(function(be){var bf=$(this).find("option:selected").val();bd[Y].hide();bd[bf].show();Y=bf;a8.click();aF(bd[bf].current())});aY.addSep();aY.addTitle(strings.mode[e],aP);for(bb in bd){bd[bb]=aY.addGroup(bd[bb],aF,bd[bb][0][0],aP);if(bb!==Y){bd[bb].hide()}aY.addSep()}aY.addItem(strings.sizeRef[e],b)})();$("#button_menu").click(function(){aY.toggle()});$("#button_fs").click(ak);$("#wma_widget").append(aY.div.css({right:"40px",top:"26px"}));aZ=strings.dyk[e];var a6=$("<div></div>").html(aZ[Math.floor(Math.random()*aZ.length)]).addClass("news");y=$("<div></div>").css({position:"absolute",top:"30px",left:"60px",zIndex:100,fontSize:"40px",color:"white",textShadow:"1px 1px 5px black",fontWeight:"bold"}).appendTo("#wma_widget");wmaNews[0]=function(){aF(4)};wmaNews[1]=function(){if(aa){D=19039255;C=3363704;aq(15);aF(0)}else{a6.text("Sorry, your browser does not support the canvas element! Try FireFox or Google Chrome.")}};$("#wma_widget").append(a6);a6.click(function(){a6.fadeOut()});setTimeout(function(){a6.fadeOut()},10*1000);x=$("#scalelabel");c=$("#scalebar");t=document.getElementById("button_target");z=document.getElementById("wma_settings");$("#wmaLabelSet").change(function(){aA(this.value)});$("#wmaSetSizeOverlay").change(function(){ar(strings.sover[e].site,this.value)});$("#button_plus").bind("mousedown",ab);$("#button_minus").bind("mousedown",R);$("#button_target").click(ag);$("#button_kml").click(ap);$(document).keydown(L);$(document).bind("contextmenu",function(){return false});$("body").bind("dragstart",function(){return false});$("#wma_map").click(function(a9){var a8=aM(a9.originalEvent);if(a8.x!=K.x||a8.y!=K.y){return false}});S();bldg3d=$('<canvas class="wmakml"></canvas>').attr({width:aU,height:af}).css({zIndex:19,opacity:0.75}).appendTo($(B));if(aa){try{bldg3dc=bldg3d[0].getContext("experimental-webgl");update3dBuildings=aD(bldg3dc)}catch(a3){bldg3dc=null;bldg3d.remove();bldg3d=$('<canvas class="wmakml"></canvas>').attr({width:aU,height:af}).css({zIndex:19,opacity:0.75}).appendTo($(B))}if(!bldg3dc||update3dBuildings===false){bldg3dc=bldg3d[0].getContext("2d");update3dBuildings=q}}$(window).resize(W);var a7,a2,aZ;for(a2=0;a2<wma_tilesets.length&&wma_tilesets[a2].globe!=Y;++a2){}aF(a2,true);aJ();d();ah=/https?:\/\/([a-z-]+)\.wikipedia\.org\/wiki\/(.*)/;$("#wma_widget").mouseover(function(ba){var a8,a9;if(ba.metaKey||ba.ctrlKey){if(ba.target.href&&ah.test(ba.target.href)){a8=RegExp.$1;a9=RegExp.$2;$("#synopsistext").load("/~dschwen/synopsis/?l="+a8+"&t="+a9,function(){$("#synopsistext").css("direction",isRTL(a8)?"rtl":"ltr").find("a").attr("target","_top");$("#synopsis").fadeIn("slow");setTimeout(function(){var bc=$("#synopsistext").outerHeight(true),bb=af/2;$("#synopsis").animate({height:bc<bb?bc:bb})},500)})}else{$("#synopsis").fadeOut("fast")}}});$("#synopsis").click(function(a8){if(a8.target==this){$("#synopsis").fadeOut("fast")}});if(window.postMessage){$(window).bind("message",ao);if(window!=window.top){try{window.parent.postMessage("request","*")}catch(a0){}}}}function aK(){if(ac.css("visibility")!="visible"){ac.css("visibility","visible")}else{ac.css("visibility","hidden")}return false}function b(){if(z.style.visibility!="visible"){z.style.visibility="visible"}else{z.style.visibility="hidden"}return false}function ae(){var aX=$("<div></div>").addClass("wmatile").mousedown(an).click(function(a0){var aY,aZ=aM(a0.originalEvent);if(aZ.x!=K.x||aZ.y!=K.y||!aV.csrender){return true}aY=wmajt.detectPointer(a0,aV);if(aY){av(aY)}}),aW=null,aV={div:aX,img:$("<img>").load(function(aY){$(this).fadeIn(100)}).error(function(aY){aW=setTimeout(function(){aV.img.attr("src",aV.img.attr("src")+"?"+Math.random())},1000)}).appendTo(aX),can:$("<canvas></canvas>").appendTo(aX),ctx:null,csrender:false,csx:0,csy:0,csz:20,lx:0,ly:0,lz:20,span:$("<span></span>").appendTo(aX),debug:$("<span></span>").addClass("wmadbg").css("display","none").appendTo(aX),url:"",xhr:null};if(aa){aV.can.attr({width:128,height:128});aV.ctx=aV.can[0].getContext("2d")}$(B).append(aV.div);return aV}function S(){var aW,aV;if(B===null){$(document).mousemove(aG).mouseup(function(){Q=null});$("#wma_map").dblclick(V).mousedown(an);B=document.getElementById("wma_map");v=Math.floor(aU/p)+2;u=Math.floor(af/o)+2;l=[];for(var aV=0;aV<u;aV++){for(var aW=0;aW<v;aW++){l.push(ae())}}N.obj=$('<div id="wmamarker"></div>');$(B).append(N.obj)}}function W(){var aW=$(window).width(),aY=$(window).height(),aV=Math.floor(aW/p)+2,aZ=Math.floor(aY/o)+2,aX;aU=aW;af=aY;if(aa){if(aQ.canvas!==null){aQ.canvas.attr({width:aW,height:aY})}bldg3d.attr({width:aW,height:aY});if(bldg3dc.viewport){bldg3dc.viewport(0,0,aW,aY)}}if(aV!=v||aZ!=u){v=aV;u=aZ;while(l.length<aV*aZ){l.push(ae())}for(aX=0;aX<l.length;++aX){if(aX<aV*aZ){l[aX].div.show()}else{l[aX].div.hide()}}aJ();$(B).width(aW).height(aY)}else{if(aQ.shown){ad()}}}function ap(){if(aQ.shown){aQ.canvas.fadeOut(200)}else{aQ.canvas.fadeIn(200)}aQ.shown=!aQ.shown}function I(aX){var aZ,aY,aW,a0=aN.c,a3=aN.ways,a1=aN.areas,aV,a5=D,a4=C;function a2(a6){var a8,bb,a9,a7,ba;if(a6.length>0){ba=a6[0].lat+aX.lat;bb=ax(ba,a6[0].lon/Math.cos(ba/180*Math.PI)+aX.lon);a9=bb.x;a0.moveTo(bb.x-a5,bb.y-a4);for(a8=1;a8<a6.length;++a8){ba=a6[a8].lat+aX.lat;bb=ax(ba,a6[a8].lon/Math.cos(ba/180*Math.PI)+aX.lon);a0.lineTo(bb.x-a5,bb.y-a4)}}}if(a0!==null){a0.clearRect(0,0,aN.canvas[0].width,aN.canvas[0].height);if(a1!==null){a0.fillStyle="rgb(0,255,0)";for(aZ=0;aZ<a1.length;aZ++){a0.globalCompositeOperation="source-over";for(aY=0;aY<a1[aZ].outer.length;++aY){a0.beginPath();a2(a1[aZ].outer[aY]);a0.closePath();a0.fill()}a0.globalCompositeOperation="destination-out";for(aY=0;aY<a1[aZ].inner.length;++aY){a0.beginPath();a2(a1[aZ].inner[aY]);a0.closePath();a0.fill()}}}if(a3!==null){a0.globalCompositeOperation="source-over";a0.lineWidth=4;a0.strokeStyle="rgb(0,255,0)";a0.beginPath();for(aZ=0;aZ<a3.length;++aZ){a2(a3[aZ])}a0.stroke()}}}function ad(a2,aX,aW,aZ,a8,a3){var a1,a0,aY,a6=aQ.ways,a4=aQ.areas,aV,a9,a7,ba;a2=a2||wma_zoomsize[X]*p;aX=(aX!==undefined)?aX:D;aW=(aW!==undefined)?aW:C;a3=a3||aQ.c;ba=aX;function a5(bb){var bd,bg,bf=0,be,bc;if(bb[0].lon<aQ.minlon){bf=2*a2}if(bb.length>0){bg=ax(bb[0].lat,bb[0].lon,a2);be=bg.x;a3.moveTo(bg.x-ba+bf,bg.y-aW);for(bd=1;bd<bb.length;++bd){bg=P(bb[bd].lat,bb[bd].lon,a2);bc=bg.x-be;if(Math.abs(bc)>a2){bf-=Math.round(bc/(2*a2))*2*a2}be=bg.x;a3.lineTo(bg.x-ba+bf,bg.y-aW)}}}if(a3!==null){aZ=aZ||aQ.canvas[0].width;a8=a8||aQ.canvas[0].height;a3.clearRect(0,0,aZ,a8);for(aY=-2;aY<=2;++aY){ba=aX+aY*2*a2;a9=ax(0,aQ.minlon,a2);a7=ax(0,aQ.maxlon,a2);if(a7.x-ba<0||a9.x-ba>aZ){continue}if(a4!==null){a3.fillStyle="rgb(255,0,0)";a3.strokeStyle="rgb(0,0,0)";a3.lineWidth=2;for(a1=0;a1<a4.length;a1++){a3.globalCompositeOperation="source-over";for(a0=0;a0<a4[a1].outer.length;++a0){a3.beginPath();a5(a4[a1].outer[a0]);a3.closePath();a3.fill();a3.stroke()}a3.globalCompositeOperation="destination-out";for(a0=0;a0<a4[a1].inner.length;++a0){a3.beginPath();a5(a4[a1].inner[a0]);a3.closePath();a3.fill();a3.stroke()}}}if(a6!==null){a3.globalCompositeOperation="source-over";a3.lineWidth=4;a3.strokeStyle="rgb(0,0,255)";a3.beginPath();for(a1=0;a1<a6.length;++a1){a5(a6[a1])}a3.stroke()}}}}function aJ(){function a0(bn,bl){var bk,bj,bm,bo,bi=[0,0,5,0,0,2,3,4,5,6,6],bh=[0,0,8,0,0,2,3,4,5,6,6];bn.text("");for(bm=0;bm<bl.length;++bm){bj=$("<a></a>");if("img" in bl[bm]){(function(bs,bp,bq,br){bj.click(function(bu){var bt=aM(bu.originalEvent);if(bt.x!=K.x||bt.y!=K.y){bu.preventDefault()}else{if(bu.which==1){m(bs,bp,bq,br);bu.preventDefault()}}}).attr("href","//commons.wikimedia.org/wiki/Image:"+bl[bm].img)})(bl[bm].img,bl[bm].w,bl[bm].h,bl[bm].m5);bk=(parseInt(bl[bm].w)>parseInt(bl[bm].h))?(bl[bm].style==-2?24:48):Math.floor((bl[bm].style==-2?24:48)*bl[bm].w/bl[bm].h);bj.addClass("cthumb").append($("<img/>",{title:decodeURIComponent(bl[bm].img)}).error(function(){$(this).parent().hide()}).attr("src",F(bl[bm].img,bk,bl[bm].m5)));if(bl[bm].head<18){bj.addClass("dir dir"+bl[bm].head);bo=8}else{bo=6}bj.css({top:(bl[bm].ty-bo)+"px",left:(bl[bm].tx-bo)+"px"})}else{bj.addClass("label").addClass("label"+bl[bm].style).css(aT).attr({href:"//"+bl[bm].lang+".wikipedia.org/wiki/"+bl[bm].page,target:"_top"}).css({top:(bl[bm].ty-bh[bl[bm].style])+"px",left:(bl[bm].tx-bi[bl[bm].style])+"px",direction:isRTL(bl[bm].lang)?"rtl":"ltr"}).text(bl[bm].name)}bn.append(bj)}}function ba(bo,bj){var bs=bo.lx,br=bo.ly,bq=bo.lz,bn=1<<(bq-wma_maxlabel),bu,bt,bp,bm,bk,bi=[],bl,bh=[[],[],[],[]];for(bl=0;bl<bj.length;bl++){bu=128*(bs/bn-bj[bl].dx);bt=128*(br/bn-(wma_zoomsize[wma_maxlabel]-bj[bl].dy-1));bm=(bj[bl].tx+bj[bl].fx-bu)*bn;bk=(bj[bl].ty+bj[bl].fy-bt)*bn;if(bm>=0&&bm<128&&bk>=0&&bk<128){bp=jQuery.extend(true,{},bj[bl]);bp.tx=Math.floor(bm);bp.ty=Math.floor(bk);bp.fx=bm-bp.tx;bp.fy=bk-bp.ty;bh[Math.floor(bm/64)+2*Math.floor(bk/64)].push(bp)}}for(bl=0;bl<4;bl++){if(bh[bl].length>0){bh[bl].sort(function(bw,bv){return bv.wg-bw.wg});bi.push(bh[bl][0])}}a0(bo.span,bi)}if(C<0){C=0}if(D<0){D+=Math.floor(wma_zoomsize[X]*2*p)}if(D>0){D%=Math.floor(wma_zoomsize[X]*2*p)}var a1=Math.floor(D/p)%v,aZ=Math.floor(C/o)%u,aY=D%p,aX=C%o,a9,a7,aV,bg,bf,be,bd,bc,a6,a5,bb,a8,a2,aW;s();var a4=new Date;for(var bd=0;bd<u;bd++){for(var be=0;be<v;be++){bb=((be+a1)%v)+((bd+aZ)%u)*v;a6=(Math.floor(D/p)+be);a5=(Math.floor(C/o)+bd);a2=wma_tilesets[az].getTileURL(a5,a6,X);a8=l[bb];a8.div.css({left:(be*p-aY)+"px",top:(bd*o-aX)+"px"});if(a8.url!=a2||wma_highzoom_purge){a8.url=a2;if(az==0&&X>12){if(!a8.csrender){a8.csrender=true;a8.img.fadeOut(200)}if(a8.csx!=a6||a8.csy!=a5||a8.csz!=X||wma_highzoom_purge){a8.can.hide();a8.img.hide();wmajt.update(a6,a5,X,a8,wma_highzoom_purge)}}else{a8.csz=X;if(a8.csrender){a8.can.fadeOut(200)}if(a5>=wma_zoomsize[X]){a8.img.fadeOut(0);a8.span.text("");continue}if(a8.img.attr("src")!=a2){a8.img.fadeOut(0).attr("src",a2)}else{if(a8.csrender){a8.img.fadeIn(200)}}a8.csrender=false}if(a8.xhr!==null){a8.xhr.abort()}a8.lx=a6;a8.ly=a5;a8.lz=X;a8.span.html('<span class="loading">'+strings.labelLoading[e]+"</span>");if(X>wma_maxlabel){a9=Math.floor(a6/(1<<(X-wma_maxlabel)));a7=Math.floor(a5/(1<<(X-wma_maxlabel)));aW=aL(a7,a9,wma_maxlabel);aV=J(a7,a9,wma_maxlabel)}else{aW=aL(a5,a6,X);aV=J(a5,a6,X)}if(lc[aV]&&!("filler" in lc[aV])){(X<wma_maxlabel)?a0(a8.span,lc[aV].label):ba(a8,lc[aV].label)}else{if(lc[aV]&&"filler" in lc[aV]){a0(a8.span,lc[aV].label)}else{if(X<=wma_maxlabel&&X>0){bg=J(Math.floor(a5/2),Math.floor(a6/2),X-1);if(lc[bg]){a9=a6%2;lc[aV]={label:[],filler:1};for(bc=0;bc<lc[bg].label.length;bc++){if(Math.floor(lc[bg].label[bc].tx/64)===(a6%2)&&Math.floor(lc[bg].label[bc].ty/64)===(a5%2)){bf=jQuery.extend(true,{},lc[bg].label[bc]);bf.tx=(bf.tx+bf.fx)*2-(a6%2)*128;bf.ty=(bf.ty+bf.fy)*2-(a5%2)*128;bf.fx=bf.tx-Math.floor(bf.tx);bf.fy=bf.ty-Math.floor(bf.ty);bf.tx=Math.floor(bf.tx);bf.ty=Math.floor(bf.ty);lc[aV].label.push(bf)}}a0(a8.span,lc[aV].label)}}}(function(bj,bi,bh){a8.xhr=$.ajax({url:bi,context:a8}).success(function(bk){try{lc[bj]=JSON.parse(bk);bh?a0(this.span,lc[bj].label):ba(this,lc[bj].label)}catch(bl){this.span.html(bk)}}).error(function(){this.span.text("")})})(aV,aW,X<wma_maxlabel)}}}}g(N);for(bb=0;bb<H.length;++bb){g(H[bb])}wma_highzoom_purge=false;if(X>=wma_bldg3dzoom){update3dBuildings()}ad();var a3=new Date}function aD(aZ){aZ.clearColor(0,0,0,0);aZ.clearDepth(1);aZ.enable(aZ.DEPTH_TEST);aZ.depthMask(true);aZ.depthFunc(aZ.LEQUAL);aZ.clear(aZ.COLOR_BUFFER_BIT+aZ.DEPTH_BUFFER_BIT);var aY=aZ.createProgram();var a0=aZ.createShader(aZ.VERTEX_SHADER);aZ.shaderSource(a0,$("#bldg-vs").text());aZ.compileShader(a0);aZ.attachShader(aY,a0);var a1=aZ.createShader(aZ.FRAGMENT_SHADER);aZ.shaderSource(a1,$("#bldg-fs").text());aZ.compileShader(a1);aZ.attachShader(aY,a1);aZ.linkProgram(aY);aZ.useProgram(aY);aY.vertexPosAttrib=aZ.getAttribLocation(aY,"pos");aZ.enableVertexAttribArray(aY.vertexPosAttrib);aY.normalPosAttrib=aZ.getAttribLocation(aY,"norm");aZ.enableVertexAttribArray(aY.normalPosAttrib);var a2=aZ.getUniformLocation(aY,"u_resolution");var a4=aZ.getUniformLocation(aY,"u_centerdeg");var a3=aZ.getUniformLocation(aY,"u_lightdir");var aX=3,aW=2,aV=5;r=Math.sqrt(aX*aX+aW*aW+aV*aV);aZ.uniform3f(a3,aX/r,aW/r,aV/r);wmajt.registerWebGLBuildingData(5000,aZ,aY);return function(){var a7=aU/2,a6=af/2,a5=60/(128*1<<X),a8=aI(D+a7,C+a6);if(a8.lon>180){a8.lon-=360}aZ.uniform3f(a2,a7*a5,a6*a5,850);aZ.uniform3f(a4,a8.lon,a8.lat,0);aZ.clear(aZ.COLOR_BUFFER_BIT|aZ.DEPTH_BUFFER_BIT);wmajt.renderWebGLBuildingData()}}function q(){if(aa&&X>wma_bldg3dzoom){var aW=wmajt.ref_z(),aV=wmajt.zbuild(),a8=aU/2,a7=af/2,a1=(128*1<<X)/60,aZ,aY,a4=bldg3dc,a2,aX,a3,a0,a5=aI(D+a8,C+a7);if(a5.lon>180){a5.lon-=360}function a6(ba){var a9;if(aX>0){a4.moveTo((ba[0][0]-a5.lon)*aZ+a8,a7-(ba[0][1]-a5.lat)*aZ);for(a9=1;a9<ba.length;a9++){a4.lineTo((ba[a9][0]-a5.lon)*aZ+a8,a7-(ba[a9][1]-a5.lat)*aZ)}}for(a9=0;a9<ba.length-1;a9++){a4.moveTo((ba[a9][0]-a5.lon)*aZ+a8,a7-(ba[a9][1]-a5.lat)*aZ);a4.lineTo((ba[a9][0]-a5.lon)*aY+a8,a7-(ba[a9][1]-a5.lat)*aY);a4.lineTo((ba[a9+1][0]-a5.lon)*aY+a8,a7-(ba[a9+1][1]-a5.lat)*aY)}}a4.lineWidth=0.5;a4.strokeStyle="rgb(0,0,0)";a4.beginPath();bldg3dc.clearRect(0,0,aU,af);for(a0 in aW){a3=aV[a0].geo.coordinates;a2=(aV[a0].tags["building:levels"]*3)||aV[a0].tags.height;aX=(aV[a0].tags["building:min_level"]*3)||aV[a0].tags.min_height||0;aZ=a1*(1+aX/450);aY=a1*(1+a2/450);if(aV[a0].geo.type==="Polygon"){for(a0=0;a0<a3.length;a0++){a6(a3[a0])}}else{a6(a3)}}a4.stroke();bldg3d.show();if(bldg3dtimer!==null){clearTimeout(bldg3dtimer)}setTimeout(update3dBuildings,1500)}else{bldg3d.hide()}}function g(aV){var aW=P(aV.lat,aV.lon),aX=(aW.x-D);if(aX<-100){aX+=(wma_zoomsize[X]*256)}aV.obj.css("left",(aX-6)+"px");aV.obj.css("top",(aW.y-C-6)+"px")}function an(aV){K=Q=aM(aV)}function aG(aV){window.scrollTo(0,0);var aX=aM(aV);if(Q!==null){D-=(aX.x-Q.x);C-=(aX.y-Q.y);Q=aX;aJ();if(au){au=false;d()}}if(aN.shown){I(aI(D+aX.x,C+aX.y))}var aW=aI(D+aU/2,C+af/2);aB&&aB.setLatLon(aW.lat,aW.lon)}function V(aV){var aW=aM(aV);D+=aW.x-aU/2;C+=aW.y-af/2;if(au){au=false;d()}aJ();return false}function av(aV){if(h){clearTimeout(h)}y.stop(true).fadeTo(1,1).text(aV);h=setTimeout(function(){y.fadeOut(200)},5000)}function aq(aV){X=aV;if(bldg3d){if(aV>=wma_bldg3dzoom){bldg3d.show()}else{bldg3d.hide()}}}function ar(aW,aV){if(aV=="+"){aV=prompt("Enter article title to use as overlay");if(!aV){return}}if(aV=="*"){aV=ai.page;aW=ai.lang}if(aV=="-"){aN.shown=false;aN.canvas.fadeOut(200);return}O(aW,aV);b()}function O(aW,aV){$.ajax({url:"//toolserver.org/~master/osmjson/getGeoJSON.php?lang="+aW+"&article="+aV,dataType:"json",success:aw})}function L(aY){var aW=false;aY=aY||window.event;switch(aY.keyCode||aY.which){case 37:D-=aU/1;break;case 38:C-=af/1;break;case 39:D+=aU/1;break;case 40:C+=af/1;break;case 187:case 107:ab();break;case 189:case 109:R();break;case 80:wma_highzoom_purge=true;aJ();break;case 79:if(aN.shown){aN.shown=false;aN.canvas.fadeOut(200)}else{O(strings.sover[e].site,strings.sover[e].list[0])}break;case 84:aF((az+1)%wma_tilesets.length);break;case 76:var aX,aZ,aV=["en","de","fr","ru","ar","he","ko","ja","ml","fa","commons"];aX=aV[($.inArray(at,aV)+1)%aV.length];y.text(wikiminiatlas_sites[aX]);aA(aX,true);break;case 67:aA("commons",true);break;case 27:if(aN.shown){aN.shown=false;aN.canvas.fadeOut(200)}if(ay.shown){T()}if(z.style.visibility!="hidden"){z.style.visibility="hidden"}break;default:aW=true}if(au){au=false;d()}aJ();return aW}function aM(aV){return{x:aV.pageX,y:aV.pageY}}function J(aX,aV,aW){return at+"_"+(wma_zoomsize[aW]-aX-1)+"_"+(aV%(wma_zoomsize[aW]*2))+"_"+aW+"_"+wma_tilesets[az].globe}function aL(aX,aV,aW){return wma_database+"?l="+at+"&a="+(wma_zoomsize[aW]-aX-1)+"&b="+(aV%(wma_zoomsize[aW]*2))+"&z="+aW+"&g="+wma_tilesets[az].globe}function aS(){var aW=wma_tilesets[az].globe;for(var aV=az+1;aV<wma_tilesets.length;aV++){if(wma_tilesets[aV].maxzoom>=(X+1)&&wma_tilesets[aV].globe==aW){az=aV;X++;return}}}function k(){for(var aV=az-1;aV>=0;aV--){if(wma_tilesets[aV].minzoom<(X-1)){az=aV;X--;return}}}function ab(aW){var aX=aI(D+aU/2,C+af/2);var aV=false;if(!aW){var aW=window.event}if(aW){if(aW.which){aV=(aW.which==3)}else{if(aW.button){aV=(aW.button==2)}}}if(aV){if(aa&&wma_highzoom_activated){aq((az==0)?15:wma_tilesets[az].maxzoom)}else{aq((az==0)?12:wma_tilesets[az].maxzoom)}}else{if(X>=((az==0&&!(aa&&wma_highzoom_activated))?12:wma_tilesets[az].maxzoom)){}else{aq(X+1)}}var aY;if(au){aY=P(N.lat,N.lon)}else{aY=P(aX.lat,aX.lon)}D=aY.x-aU/2;C=aY.y-af/2;aJ();return false}function R(aY){var aX=aI(D+aU/2,C+af/2);var aV=false;if(!aW){var aW=window.event}if(aW){if(aW.which){aV=(aW.which==3)}else{if(aW.button){aV=(aW.button==2)}}}if(aV){aq(wma_tilesets[az].minzoom)}else{if(X<=wma_tilesets[az].minzoom){k()}else{aq(X-1)}}var aZ=P(aX.lat,aX.lon);D=aZ.x-aU/2;C=aZ.y-af/2;aJ();return false}function aF(aZ,aY){var aW=X;az=aZ;aT={color:wma_tilesets[aZ].linkcolor[0],textShadow:wma_tilesets[aZ].linkcolor[1]};$("a.label").css(aT);credit.text("");if("credit" in wma_tilesets[aZ]){credit.html(wma_tilesets[aZ].credit)}if(aW>(aZ!=0?wma_tilesets[aZ].maxzoom:((aa&&wma_highzoom_activated)?15:12))){aW=wma_tilesets[aZ].maxzoom}if(aW<wma_tilesets[aZ].minzoom){aW=wma_tilesets[aZ].minzoom}if(X!=aW){var aV=aI(D+aU/2,C+af/2);aq(aW);var aX=P(aV.lat,aV.lon);D=aX.x-aU/2;C=aX.y-af/2}if(!aY){aJ()}aE()}function aA(aV){at=aV;for(var aW=0;aW<v*u;aW++){l[aW].url=""}aJ()}function s(){var aX=aI(D+aU/2,C+af/2);var aW=50,aZ;var aV,aY;aV=Math.cos(aX.lat*0.0174532778)*wma_tilesets[az].equator*aW/(256*wma_zoomsize[X]);aY=Math.pow(10,Math.floor(Math.log(aV)/Math.log(10)));aZ=aW*aY/aV;if(5*aZ<aW){aZ=aZ*5;aY=aY*5}if(2*aZ<aW){aZ=aZ*2;aY=aY*2}x.text(aY<1?(aY*1000)+" m":aY+" km");c.width(aZ)}function d(){if(au){$("#button_target").css("background-position","")}else{$("#button_target").css("background-position","-40px 0")}}function aC(aV,aX){var aW=P(aV,aX);D=aW.x-aU/2;C=aW.y-af/2;aJ()}function ag(){aC(N.lat,N.lon);au=true;d()}function ax(aW,aX,aV){aV=aV||wma_zoomsize[X]*p;return{y:Math.floor((0.5-aW/180)*aV),x:Math.floor((aX/360)*aV*2)}}function P(aW,aX,aV){aV=aV||wma_zoomsize[X]*p;var aY=Math.floor((aX/360)*aV*2);if(aY<0){aY+=aV*2}return{y:Math.floor((0.5-aW/180)*aV),x:aY}}function aI(aV,aW){return{lat:180*(0.5-aW/(wma_zoomsize[X]*128)),lon:360*(aV/(wma_zoomsize[X]*256))}}function Z(aV){$("#debugbox").append($("<div></div>").text(aV))}function F(aW,aV,aX){return aX?"//upload.wikimedia.org/wikipedia/commons/thumb/"+aX[0]+"/"+aX+"/"+aW+"/"+aV+"px-"+aW:"//commons.wikimedia.org/w/thumb.php?w="+aV+"&f="+aW}function T(){ay.shown=false;ay.panel.fadeOut(200)}function A(){ay.panel=$("<div></div>",{id:"wma_wmaci_panel"}).append($("<div></div>",{id:"wma_wmaci_panel_sub"}).append(ay.span=$("<span></span>")).append($("<br/>")).append(ay.link=$("<a></a>",{id:"wma_wmaci_link",target:"_top"}).click(function(aV){aV.stopPropagation()}))).css("visibility","visible").hide().click(T).appendTo(ac)}function m(aV,a2,aZ,a1){if(ay.panel==null){A()}var a0=aU-30;var aX=af-80;var aW=a2;var a3=aZ;if(aW>a0){a3=Math.round((a3*a0)/aW);aW=a0}if(a3>aX){aW=Math.round((aW*aX)/a3);a3=aX}ay.span.find("img").remove();var aY=$("<img/>",{id:"wma_wmaci_image"}).appendTo(ay.span);if(aW<a2){aY.attr("src",F(aV,Math.floor(aW/10)*10,a1))}else{aY.attr("src","//commons.wikimedia.org/wiki/Special:FilePath/"+aV)}ay.link.attr("href","//commons.wikimedia.org/wiki/Image:"+aV).text("[[:commons:Image:"+decodeURIComponent(aV)+"]]");ay.panel.fadeIn(200);ay.shown=true}function ak(){var aV=window.open("","showwin","left=0,top=0,width="+screen.width+",height="+screen.height+",toolbar=0,resizable=0,fullscreen=1"),aX=ai.page,aY=ai.lang,aZ=wma_tilesets[az].globe,aW=aI(D+aU/2,C+af/2);aV.document.location=document.location.pathname+"?"+N.lat+"_"+N.lon+"_"+0+"_"+0+"_"+at+"_"+X+"_"+aO+"_"+aW.lat+"_"+aW.lon+"&globe="+aZ+"&page="+aX+"&lang="+aY}function al(aV,aW){return function(aX){window.parent.postMessage(aW+","+aV,"*")}}function w(aV){if(!aa){return}aV=aV||aQ;if(aV.canvas===null){aV.canvas=$('<canvas class="wmakml"></canvas>').attr({width:aU,height:af}).appendTo($(B));aV.c=aV.canvas[0].getContext("2d");aV.shown=true;aV.drawn=true;if(aV==aQ){$("#button_kml").show()}}if(aV===aQ&&aB){aB.updateKML()}}function ao(aY){aY=aY.originalEvent;var aZ=JSON.parse(aY.data),aX,aW,aV;if("coords" in aZ){for(aX=0;aX<aZ.coords.length;++aX){aV={obj:null,lat:aZ.coords[aX].lat,lon:aZ.coords[aX].lon};if(Math.abs(aV.lat-N.lat)>0.0001||Math.abs(aV.lon-N.lon)>0.0001){aV.obj=$("<div></div>").attr("title",decodeURIComponent(aZ.coords[aX].title)).addClass("emarker").mouseover(al(aX,"highlight")).mouseout(al(aX,"unhighlight")).click(al(aX,"scroll")).appendTo($(B));g(aV);H.push(aV)}}}if(("ways" in aZ)||("areas" in aZ)){w();aQ.ways=aZ.ways||null;aQ.areas=aZ.areas||null;ad()}if(("minlon" in aZ)&&("maxlon" in aZ)){if(!("maxlon" in aQ)||aZ.maxlon>aQ.maxlon){aQ.maxlon=aZ.maxlon}if(!("minlon" in aQ)||aZ.minlon<aQ.minlon){aQ.minlon=aZ.minlon}}if("getcoords" in aZ){var a0={query:aZ.getcoords,response:{topleft:aI(D,C),rightbottom:aI(D+aU,C+af)}};if(window.parent){window.parent.postMessage(JSON.stringify(a0),aY.origin)}}}function E(a1,a0){function aX(a7){var a4,a8,a2,bc=180/Math.PI,a5=Math.PI/2,a3=180/20037508.34,bb=[],a9=-Infinity,a6=Infinity,ba;for(a4=0;a4<a7.length;++a4){a2=a7[a4][0]*a3;a8=bc*(2*Math.atan(Math.exp(a7[a4][1]*a3/bc))-a5);if(a2>a9){a9=a2}if(a2<a6){a6=a2}if(a8>a0.maxlat){a0.maxlat=a8}if(a8<a0.minlat){a0.minlat=a8}bb.push({lat:a8,lon:a2})}if(!("maxlon" in a0)||!("maxlon" in a0)){a0.maxlon=a9;a0.minlon=a6}else{ba=[{r:Math.max(a0.maxlon,a9),l:Math.min(a0.minlon,a6)},{r:Math.max(a0.maxlon,a9+360),l:Math.min(a0.minlon,a6+360)},{r:Math.max(a0.maxlon+360,a9),l:Math.min(a0.minlon+360,a6)}];ba.sort(function(be,bd){return(be.r-be.l)-(bd.r-bd.l)});a0.minlon=ba[0].l;a0.maxlon=ba[0].r}return bb}function aW(a4){var a3={outer:[],inner:[]},a2;a3.outer.push(aX(a4[0]));for(a2=1;a2<a4.length;a2++){a3.inner.push(aX(a4[a2]))}if(a0.areas){a0.areas.push(a3)}else{a0.areas=[a3]}}function aV(a2){var a3=[aX(a2)];if(a0.ways){a0.ways.push.apply(a0.ways,a3)}else{a0.ways=a3}}function aZ(a3){var a2;switch(a3.type){case"LineString":aV(a3.coordinates);break;case"MultiLineString":for(a2=0;a2<a3.coordinates.length;a2++){aV(a3.coordinates[a2])}break;case"Polygon":aW(a3.coordinates);break;case"MultiPolygon":for(a2=0;a2<a3.coordinates.length;a2++){aW(a3.coordinates[a2])}break}}var aY;if(!("type" in a1)){return}if(a1.type=="GeometryCollection"){for(aY=0;aY<a1.geometries.length;++aY){aZ(a1.geometries[aY])}}else{aZ(a1)}}function a(a0){E(a0,aQ);if(aQ.ways||aQ.areas){w();ad()}if(aQ.maxlon&&aQ.minlon&&aQ.maxlat>-Infinity&&aQ.minlat<Infinity){var aZ=(aQ.maxlon+aQ.minlon)/2,aY=(aQ.maxlat+aQ.minlat)/2,aX=(aQ.maxlon-aQ.minlon)/180*3*128,aV=(aQ.maxlat-aQ.minlat)/180*3*128,aW;for(aW=0;aW<12;++aW){if(aX>aU/2||aV>af/2){break}aX*=2;aV*=2}aq(aW);aC(aY,aZ)}}function aw(a1){var a2=aN.c,aX=aN.canvas;if(aX){aN={shown:true,drawn:false,canvas:aX,c:a2,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity}}else{aN={shown:true,drawn:false,canvas:null,c:null,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity};w(aN)}E(a1,aN);var aW=aN.areas,aV=aN.ways,a0=(aN.maxlon+aN.minlon)/2,aZ=(aN.maxlat+aN.minlat)/2;function aY(a3){var a5,a4=0;if(a3[0].lon<aN.minlon){a4=360}for(a5=0;a5<a3.length;++a5){a3[a5].lon-=a0-a4;a3[a5].lon*=Math.cos(a3[a5].lat/180*Math.PI);a3[a5].lat-=aZ}}if(aW!==null){for(i=0;i<aW.length;i++){for(j=0;j<aW[i].outer.length;++j){aY(aW[i].outer[j])}for(j=0;j<aW[i].inner.length;++j){aY(aW[i].inner[j])}}}if(aV!==null){for(i=0;i<aV.length;++i){latNorm(aV[i])}}aN.canvas.fadeIn(200)}aR()}function wmaMenu(a){this.div=$("<div></div>").addClass("wmamenu").css("direction",(a===true?"rtl":""));this.parent=null;this.shown=false}wmaMenu.prototype.addTitle=function(a,c){var b=$("<div></div>").addClass("wmamenutitle").html(a).css("direction",(c===true)?"rtl":"").appendTo(this.div);return b};wmaMenu.prototype.addItem=function(a,d,e){d=d||(function(){});var c=this,b=$("<div></div>").addClass("wmamenuitem").html(a).css("direction",(e===true)?"rtl":"").mouseenter(function(){b.css("background-color","#AAA")}).mouseleave(function(){b.css("background-color","")}).click(function(){d();c.close()}).appendTo(this.div);return b};wmaMenu.prototype.addMenu=function(a,d,c){var b=$("<div></div>").addClass("wmasubmenu").html(a).css("direction",(c===true)?"rtl":"").mouseenter(function(){b.css("background-color","#AAA")}).mouseleave(function(){b.css("background-color","");d.hide()}).click(function(){d.move(b.width(),0);d.show()}).append(d.div).appendTo(this.div);d.parent=this;return b};wmaMenu.prototype.addCheck=function(b,f,c,g){function a(){if(c){d.addClass("wmamenuchecked")}else{d.removeClass("wmamenuchecked")}}function e(){c=!c;a();f(c)}var d=this.addItem(b,e,g);f=f||(function(){});a();return{toggle:function(h){if(h===undefined){c=!c;a()}},check:a,item:d}};wmaMenu.prototype.addGroup=function(l,a,b,g){var f={},d=this,e=-1;function k(o){if(o==e){return}for(var m in f){if(m==o){f[m].addClass("wmamenuselected")}else{f[m].removeClass("wmamenuselected")}}e=o}function h(o,m){f[o]=d.addItem(m,function(){k(o);a(o)},g)}b=b||0;a=a||(function(){});for(var c=0;c<l.length;++c){if(typeof l[c]==="object"){h(l[c][0],l[c][1])}else{h(c,l[c])}}k(b);return{items:f,select:k,current:function(){return e},hide:function(){for(var m in f){f[m].hide()}},show:function(){for(var m in f){f[m].show()}}}};wmaMenu.prototype.addSep=function(){this.div.children().last().css({"border-bottom-style":"solid","border-bottom-width":"1px","border-bottom-color":"#AAA"})};wmaMenu.prototype.show=function(){this.div.fadeIn(200);this.shown=true};wmaMenu.prototype.hide=function(){this.div.fadeOut(200);this.shown=false};wmaMenu.prototype.toggle=function(){this.shown?this.hide():this.show()};wmaMenu.prototype.close=function(){this.hide();this.parent&&this.parent.close()};wmaMenu.prototype.move=function(a,b){this.div.css({top:b+"px",left:a+"px"})};