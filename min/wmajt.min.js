var wmajt=(function(){var F=128,J=128,e=12,f=14,n={},u={},c={},E={},v=false,q=true,M,C,L,A,G,K,p,l,N,b,O,k=null,d=null,H={Polygon:[["natural",{ocean:1},[{fillStyle:"rgb(250,250,208)"},{lineWidth:1,strokeStyle:"rgb(125,125,104)"}]],["railway",{platform:1},[{fillStyle:"rgb(220,220,220)"}]],["landuse",{industrial:1,retail:1,commercial:1,residential:1},[{fillStyle:"rgb(208,208,208)"}]],["landuse",{reservoir:1},[{fillStyle:"rgb(200,200,224)"}]],["landuse",{military:1,railway:1},[{fillStyle:"rgb(224,200,200)"}]],["landuse",{cemetery:1,recreation_ground:1},[{fillStyle:"rgb(190,214,190)"}]],["landuse",{grass:1},[{globalAlpha:0.3,fillStyle:"rgb(0,160,0)"},{globalAlpha:1}]],["leisure",{park:1,orchard:1,meadow:1,village_green:1,golf_course:1,track:1,forrest:1,recreation_ground:1,dog_park:1,garden:1,pitch:1,stadium:1},[{fillStyle:"rgb(200,224,200)"}]],["waterway",{riverbank:1,dock:1},[{fillStyle:"rgb(158,199,243)"}]],["natural",{beach:1},[{fillStyle:"rgb(224,224,200)"}]],["natural",{wetland:1,mud:1},[{fillStyle:"rgb(200,218,224)"}]],["natural",{grassland:1,fell:1},[{fillStyle:"rgb(200,224,200)"}]],["natural",{scrub:1},[{fillStyle:"rgb(150,214,150)"}]],["natural",{wood:1},[{fillStyle:"rgb(100,204,100)"}]],["natural",{water:1,bay:1},[{fillStyle:"rgb(158,199,243)"},{lineWidth:1,strokeStyle:"rgb(158,199,243)"}]],["natural",{glacier:1},[{fillStyle:"rgb(230,245,255)"},{lineWidth:1,strokeStyle:"rgb(255,255,255)"}]],["amenity",{university:1},[{lineWidth:0.5,strokeStyle:"rgb(240,225,183)"}]],["amenity",{parking:1},[{fillStyle:"rgb(240,235,193)"}]],["highway",{pedestrian:1},[{fillStyle:"rgb(255,255,255)"},{lineWidth:2,strokeStyle:"rgb(168,148,148)"}]],["tourism",true,[{dash:[3,3],lineWidth:2,strokeStyle:"rgb(255,255,0)"}]],["aeroway",{terminal:1},[{fillStyle:"rgb(190,210,190)"},{lineWidth:1,strokeStyle:"rgb(127,137,127)"}]],["historic",{memorial:1,monument:1,fort:1,castle:1},[{fillStyle:"rgb(255,190,190)"},{lineWidth:1,strokeStyle:"rgb(167,120,120)"}]],["historic",{ship:1,wreck:1},[{fillStyle:"rgb(255,190,235)"}]],["railway",{station:1},[{fillStyle:"rgb(210,195,195)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["natural",{water:1,bay:1},[{fillStyle:"rgb(158,199,243)"},{lineWidth:1,strokeStyle:"rgb(158,199,243)"}]],["building",true,[{fillStyle:"rgb(200,200,200)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]],["building:part",true,[{fillStyle:"rgb(200,200,200)"},{lineWidth:1,strokeStyle:"rgb(127,127,127)"}]]],LineString:[["waterway",{canal:1},[{lineCap:"butt",lineWidth:3,strokeStyle:"rgb(158,199,243)"}]],["waterway",{river:1},[{lineWidth:1.5,strokeStyle:"rgb(126,159,194)"}]],["waterway",{stream:1},[{dash:[2,2],lineWidth:1.5,strokeStyle:"rgb(126,159,194)"}]],["route",{ferry:1},[{dash:[4,4],lineWidth:2,strokeStyle:"rgb(126,159,194)"}]],["highway",{pedestrian:1},[{lineWidth:5,strokeStyle:"rgb(255,255,255)"}]],["highway",{footway:1,pedestrian:1,path:1},[{lineWidth:2,strokeStyle:"rgb(198,178,178)"}]],["highway",{steps:1},[{dash:[1.5,1.5],lineWidth:3,strokeStyle:"rgb(168,148,148)"}]],["highway",{service:1},[{lineWidth:4,strokeStyle:"rgb(168,168,168)"},{lineWidth:2.5,strokeStyle:"rgb(208,208,208)"}]],["highway",{track:1},[{lineWidth:3.5,strokeStyle:"rgb(168,168,168)"},{lineWidth:2.5,strokeStyle:"rgb(250,250,208)"}]],["highway",{residential:1,unclassified:1},[{lineWidth:4,strokeStyle:"rgb(200,200,200)"},{lineWidth:2.5,strokeStyle:"rgb(255,255,255)"}]],["highway",{tertiary:1},[{lineWidth:5,strokeStyle:"rgb(200,200,200)"},{lineWidth:3.5,strokeStyle:"rgb(255,255,235)"}]],["railway",{subway:1},[{globalAlpha:0.2,lineWidth:3,strokeStyle:"rgb(100,100,100)"},{globalAlpha:1}]],["railway",{rail:1,preserved:1,monorail:1,narrow_gauge:1},[{lineWidth:3,strokeStyle:"rgb(100,100,100)"}]],["highway",{secondary:1,secondary_link:1,primary:1,primary_link:1},[{lineCap:"round",lineWidth:6,strokeStyle:"rgb(171,158,137)"}]],["highway",{motorway:1,motorway_link:1,trunk:1,trunk_link:1},[{lineWidth:7,strokeStyle:"rgb(188,149,28)"}]],["aeroway",{runway:1},[{lineWidth:10,strokeStyle:"rgb(100,130,100)"}]],["aeroway",{taxiway:1},[{lineWidth:4.5,strokeStyle:"rgb(100,130,100)"}]],["railway",{subway:1},[{lineCap:"butt",globalAlpha:0.3,dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(255,255,255)"},{globalAlpha:1}]],["railway",{rail:1,narrow_gauge:1},[{dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(255,255,255)"}]],["railway",{preserved:1},[{dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(200,200,200)"}]],["railway",{monorail:1},[{dash:[1,2,4,2],lineWidth:1.5,strokeStyle:"rgb(200,200,200)"}]],["highway",{secondary:1,secondary_link:1},[{lineCap:"round",lineWidth:4.5,strokeStyle:"rgb(255,250,115)"}]],["highway",{primary:1,primary_link:1},[{lineWidth:4,strokeStyle:"rgb(255,230,95)"}]],["highway",{motorway:1,motorway_link:1,trunk:1,trunk_link:1},[{lineWidth:5,strokeStyle:"rgb(242,191,36)"}]],["aeroway",{runway:1},[{lineWidth:8,strokeStyle:"rgb(150,180,150)"}]],["aeroway",{taxiway:1},[{lineWidth:2.5,strokeStyle:"rgb(150,180,150)"}]],["railway",{tram:1},[{globalAlpha:0.4,dash:[3,3],lineWidth:1.5,strokeStyle:"rgb(0,0,0)"},{globalAlpha:1}]],["access",{permissive:1},[{dash:[1,2],lineWidth:1,strokeStyle:"rgb(100,200,100)"}]],["access",{"private":1,residents:1},[{dash:[1,2],lineWidth:1,strokeStyle:"rgb(200,100,100)"}]],["building:part",true,[{lineWidth:1,strokeStyle:"rgb(127,127,255)"}]]]};function x(P,h){var w=P.concat(h),R=[],Q={};for(i in w){if(w.hasOwnProperty(i)){if(!(w[i] in Q)){Q[w[i]]=true;R.push(w[i])}}}return R}function I(h,P,w){return h+"_"+P+"_"+w}function y(R){if(R===null){return}V=R.data;var W,T={0:1},V,S,Q;if(R.v&&R.v>=2){W=R.idx}else{W={};for(S=0;S<V.length;++S){for(Q in V[S].tags){if(Q in W){W[Q].push(S)}else{W[Q]=[S]}}}}for(S=0;S<V.length;++S){if("layer" in V[S].tags){T[V[S].tags.layer]=1}}n[I(R.x,R.y,R.z)]={data:R.data,building:{},f:R.f||{},idx:W,lay:T};var V=R.data,w,h=R.x,U=R.y,P;if(R.z>=f){for(w=R.z;w>=e;w--){P=n[I(h,U,w)];if(w<f&&P&&P.data){for(S=0;S<V.length;++S){if("osm_id" in V[S].tags&&("building" in V[S].tags||"building:part" in V[S].tags)&&!(V[S].tags.osm_id in P.building)){for(Q in V[S].tags){if(Q in P.idx){P.idx[Q].push(P.data.length)}else{P.idx[Q]=[P.data.length]}}P.data.push(V[S]);P.building[V[S].tags.osm_id]=1}}}h=Math.floor(h/2);U=Math.floor(U/2)}}else{}z(this.csx,this.csy,this.csz,this)}function m(R,U){if(d){if(R.length>0){var X=(R[0][0]-M)*128/G,V=128-(R[0][1]-C)*128/K,ab,aa,T=0,S=d.length,Z=0,Y,W,h,Q,P,w;for(P=1;P<R.length;++P){U.moveTo(X,V);Q=-Z;ab=(R[P][0]-M)*128/G;aa=128-(R[P][1]-C)*128/K;Y=ab-X;W=aa-V;h=Math.sqrt(Y*Y+W*W);Y/=h;W/=h;w=false;while(true){Q+=d[T];if(Q>h){w=true;Z=Q-h;Q=h}U[T%2?"moveTo":"lineTo"](Q*Y+X,Q*W+V);if(w){break}T=(T+1)%S}X=ab;V=aa}}}else{if(R.length>0){U.moveTo((R[0][0]-M)*128/G,128-(R[0][1]-C)*128/K);for(P=1;P<R.length;++P){U.lineTo((R[P][0]-M)*128/G,128-(R[P][1]-C)*128/K)}}}}function D(R,S){var U=null,Y={},h=S.div.offset(),W=R.pageX-h.left,V=R.pageY-h.top,T=S.csca.data||[],w,P,X,aa="";function Q(af,ag,ab){var ad,ac,ae;for(j=1;j<af.length;++j){ad=(af[j][0]-M)*128/G-W;ac=128-(af[j][1]-C)*128/K-V;ae=ad*ad+ac*ac;if((U===null||ae<U)&&("name" in ab.tags||"addr:street" in ab.tags)){U=ae;Y=ab}}}M=S.csx*60/(1<<S.csz);C=90-(((S.csy+1)*60)/(1<<S.csz));L=(S.csx+1)*60/(1<<S.csz);A=90-((S.csy*60)/(1<<S.csz));G=L-M;K=A-C;if(M>180){M-=360}for(P=0;P<T.length;++P){w=T[P];a(w,"Polygon",null,Q);if(w.geo.type=="GeometryCollection"){a(w,"Line",null,Q)}}X=Y.tags||{};if("name" in X){aa=X.name;if("loc_name" in X){aa+=' "'+X.loc_name+'"'}if("artist_name" in X){aa+=" ("+X.artist_name+")"}return aa}if("addr:street" in X){aa=X["addr:street"];if("addr:housenumber" in X){aa=X["addr:housenumber"]+" "+aa}return aa}var Z=["landuse","historic","highway","building"];for(P=0;P<Z.length;++P){if(Z[P] in X){return Z[P]+" "+X[Z[P]]}}return null}function a(h,Q,T,S){var P,w,R;switch(h.geo.type){case"Polygon":S(h.geo.coordinates[0],T,h);break;case"LineString":S(h.geo.coordinates,T,h);break;case"MultiLineString":for(P=0;P<h.geo.coordinates.length;P++){S(h.geo.coordinates[P],T,h)}break;case"MultiPolygon":for(P=0;P<h.geo.coordinates.length;P++){S(h.geo.coordinates[P][0],T,h)}break;case"GeometryCollection":R=h.geo.geometries;for(w=0;w<R.length;w++){if(Q==="Polygon"){switch(R[w].type){case"Polygon":S(R[w].coordinates[0],T,h);break;case"MultiPolygon":for(P=0;P<R[w].coordinates.length;P++){S(R[w].coordinates[P][0],T,h)}break}}else{switch(R[w].type){case"LineString":S(R[w].coordinates,T,h);break;case"MultiLineString":for(P=0;P<R[w].coordinates.length;P++){S(R[w].coordinates[P],T,h)}break}}}break}}function z(R,Q,w,ag,T){var ad=ag.ctx,Y=false,Z,W,ab,aa;M=R*60/(1<<w);C=90-(((Q+1)*60)/(1<<w));L=(R+1)*60/(1<<w);A=90-((Q*60)/(1<<w));G=L-M;K=A-C;if(M>180){M-=360}function P(ak){var am,al,aj,an,aq,ah,ao=ak.data,ai,ap;ad.lineWidth=1;ad.fillStyle="rgb(158,199,243)";ad.fillRect(0,0,128,128);for(aq in H){for(ah=0;ah<H[aq].length;ah++){ad.beginPath();if(!(H[aq][ah][0] in ak.idx)){continue}d=H[aq][ah][2][0].dash||null;ap=ak.idx[H[aq][ah][0]];for(am=0;am<ap.length;++am){ai=ao[ap[am]];if((aq!==ai.geo.type&&("Multi"+aq)!==ai.geo.type&&ai.geo.type!=="GeometryCollection")||!(H[aq][ah][1]===true||ai.tags[H[aq][ah][0]] in H[aq][ah][1])){continue}a(ai,aq,ad,m)}an=H[aq][ah][2];for(am=0;am<an.length;am++){for(al in an[am]){if(al!="dash"){ad[al]=an[am][al]}}if("strokeStyle" in an[am]){ad.stroke()}if("fillStyle" in an[am]){ad.fill()}}}}}function af(ai){var ah;if(ai===undefined){return null}ah=/^(\d+(\.\d*)?)(\s*m)?$/.exec(ai);if(ah!==null){return parseFloat(ah[1])}ah=/^((\d+(\.\d*)?)')?((\d+(\.\d*)?)")?$/.exec(ai);if(ah!==null){return parseFloat(ah[2]||"0")*0.3048+parseFloat(ah[5]||"0")*0.0254}return 0}ag.csx=R;ag.csy=Q;ag.csz=w;var ae,h=R,V=Q,X,ac,S,U;for(ae=w;ae>=e;ae--){X=n[I(h,V,ae)];if(X&&X.data&&!T){if(ag.csca){ac=ag.csca.data;if(v&&"start_date" in ag.csca.idx){U=ag.csca.idx.start_date;for(i=0;i<U.length;++i){S=ac[U[i]].tags.start_date;if(S in u){u[S]--;if(u[S]==0){delete u[S]}}}}if(q&&w>f){U=x(ag.csca.idx["building:levels"]||[],ag.csca.idx.height||[]);for(i=0;i<U.length;++i){if("osm_id" in ac[U[i]].tags){S=ac[U[i]].tags.osm_id;if(S in c){c[S]--;if(c[S]==0){delete c[S]}}}}}}P(X);ag.csca=X;ac=X.data;if(v&&"start_date" in X.idx){U=X.idx.start_date;for(i=0;i<U.length;++i){S=ac[U[i]].tags.start_date;u[S]=(u[S]||0)+1}}if(q&&w>f){U=x(X.idx["building:levels"]||[],X.idx.height||[]);for(i=0;i<U.length;++i){if("osm_id" in ac[U[i]].tags){S=ac[U[i]].tags.osm_id;c[S]=(c[S]||0)+1;if(!(S in E)){E[S]=ac[U[i]]}}}}if(k!==null){U=x(X.idx["building:levels"]||[],X.idx.height||[]);for(i=0;i<U.length;++i){if("osm_id" in ac[U[i]].tags){S=ac[U[i]].tags.osm_id;if(!(S in c)){c[S]=true;S=ac[U[i]];Z=af(S.tags.height)||(S.tags["building:levels"]*3);W=af(S.tags.min_height)||(S.tags["building:min_level"]*3)||0;if(S.geo.type==="Polygon"){ab=S.geo.coordinates}else{if(S.geo.type==="LineString"){ab=[S.geo.coordinates]}else{continue}}Y=true;if(S.tags["building:shape"]==="pyramid"){t(ab,W,Z);continue}if(("roof:shape" in S.tags)&&("roof:height" in S.tags)){aa=af(S.tags["roof:height"]);if(S.tags["roof:shape"]==="pyramidal"){if(aa<Z){g(ab,W,Z-aa,true)}t(ab,Z-aa,Z);continue}}g(ab,W,Z)}}}}ag.can.show();if(Y){B()}if(w<f||ae>=f){return}}h=Math.floor(h/2);V=Math.floor(V/2)}ag.debug.html("tiles/jsontile.php?x="+R+"&y="+Q+"&z="+w);$.ajax({url:"tiles/jsontile.php?x="+R+"&y="+Q+"&z="+w+(T===true?"&action=purge":""),dataType:"json",success:y,context:ag})}function o(h,Q,P){glArrList=[];l=[];N=h;k=Q;p=P;var R,w;b=0;O=0;R=new Float32Array(N*9);w=new Float32Array(N*9);glArrList.push({v:R,n:w});q=false}function B(){var P,w,R,h,Q;if(glArrList.length>l.length||b>O){Q=l.length-1;Q=Q<0?0:Q;for(P=Q;P<glArrList.length;++P){if(P>=l.length){R=k.createBuffer();h=k.createBuffer();l.push({v:R,n:h})}else{R=l[P].v;h=l[P].n}k.bindBuffer(k.ARRAY_BUFFER,R);k.bufferData(k.ARRAY_BUFFER,glArrList[P].v,k.STATIC_DRAW);k.bindBuffer(k.ARRAY_BUFFER,h);k.bufferData(k.ARRAY_BUFFER,glArrList[P].n,k.STATIC_DRAW)}O=b}w=l.length-1;for(P=0;P<=w;++P){k.bindBuffer(k.ARRAY_BUFFER,l[P].n);k.vertexAttribPointer(p.normalPosAttrib,3,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,l[P].v);k.vertexAttribPointer(p.vertexPosAttrib,3,k.FLOAT,false,0,0);k.drawArrays(k.TRIANGLES,0,((P==w)?O:N)*3)}}function s(P,T){var h=P.length/9,S=N,R,Q,w,T;R=glArrList.length-1;if(b+h<=S){glArrList[R].v.set(P,b*9);glArrList[R].n.set(T,b*9);b+=h}else{for(Q=0;Q<h;++Q){for(w=0;w<9;++w){glArrList[R].v[b*9+w]=P[Q*9+w]}b++;if(b==S){b=0;glArrList.push({v:new Float32Array(N*9),n:new Float32Array(N*9)});R++}}}if(b==S){b=0;glArrList.push({v:new Float32Array(N*9),n:new Float32Array(N*9)})}}function t(aa,ac,X){var ab,U,S,Q,R=0,P=0,ae,Z,ad,W,w,Y,V,T;ab=aa[0];Q=ab.length-1;area=0;if(Q<3){return}for(U=0;U<Q;U++){area+=(ab[U][0]*ab[U+1][1])-(ab[U+1][0]*ab[U][1]);R+=ab[U][0];P+=ab[U][1]}if(area>0){ab.reverse()}R/=Q;P/=Q;for(U=0;U<Q;U++){ae=ab[U][0]-ab[U+1][0];Z=ab[U][1]-ab[U+1][1];ad=R-ab[U][0];W=P-ab[U][1];w=X-ac;Y=-Z*w;V=ae*w;T=Z*ad-ae*W;r=Math.sqrt(Y*Y+V*V+T*T);Y/=r;V/=r;T/=r;s([ab[U][0],ab[U][1],ac,ab[U+1][0],ab[U+1][1],ac,R,P,X],[Y,V,T,Y,V,T,Y,V,T])}}function g(ac,ae,aa,ag){var Q,P,ad,Z,Y,X,T,ab,V,U;ag=~~ag;for(Y=0;Y<ac.length;++Y){ad=ac[Y];X=ad.length-1;ab=0;if(X<3){return}for(Z=0;Z<X;Z++){ab+=(ad[Z][0]*ad[Z+1][1])-(ad[Z+1][0]*ad[Z][1])}ab*=(Y==0)?1:-1;if(ab>0){ad.reverse()}}for(Y=0;Y<ac.length;++Y){ad=ac[Y];X=ad.length-1;for(Z=0;Z<X;Z++){V=ad[Z][0]-ad[Z+1][0];U=ad[Z][1]-ad[Z+1][1];r=Math.sqrt(V*V+U*U);V/=r;U/=r;s([ad[Z][0],ad[Z][1],ae,ad[Z+1][0],ad[Z+1][1],ae,ad[Z][0],ad[Z][1],aa],[-U,V,0,-U,V,0,-U,V,0]);s([ad[Z][0],ad[Z][1],aa,ad[Z+1][0],ad[Z+1][1],aa,ad[Z+1][0],ad[Z+1][1],ae],[-U,V,0,-U,V,0,-U,V,0])}}if(ag){return}if(ac.length===1&&ac[0].length<=5){ad=ac[0];if(ad.length==4){s([ad[0][0],ad[0][1],aa,ad[1][0],ad[1][1],aa,ad[2][0],ad[2][1],aa],[0,0,1,0,0,1,0,0,1])}else{s([ad[0][0],ad[0][1],aa,ad[1][0],ad[1][1],aa,ad[2][0],ad[2][1],aa,ad[0][0],ad[0][1],aa,ad[2][0],ad[2][1],aa,ad[3][0],ad[3][1],aa],[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])}return}var w=[],af=[];ad=ac[0];X=ad.length-1;for(Z=0;Z<X;Z++){w.push(new p2t.Point(ad[Z][0],ad[Z][1]))}var S=new p2t.SweepContext(w);for(Y=1;Y<ac.length;++Y){ad=ac[Y];X=ad.length-1;var W=[];for(Z=0;Z<X;Z++){W.push(new p2t.Point(ad[Z][0],ad[Z][1]))}S.AddHole(W)}p2t.sweep.Triangulate(S);Q=S.GetTriangles();for(Z=0;Z<Q.length;++Z){var R=[Q[Z].GetPoint(0),Q[Z].GetPoint(1),Q[Z].GetPoint(2)];s([R[0].x,R[0].y,aa,R[1].x,R[1].y,aa,R[2].x,R[2].y,aa],[0,0,1,0,0,1,0,0,1])}}return{update:z,detectPointer:D,ref_z:function(){return c},zbuild:function(){return E},registerWebGLBuildingData:o,renderWebGLBuildingData:B}})();